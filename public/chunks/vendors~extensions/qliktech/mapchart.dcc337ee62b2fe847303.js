/*!
 * sense-client@6.105.4
 * 
 * Copyright(C) 2019 Qlik International AB
 * All Rights Reserved
 * 
 */
(window["qJsonp"]=window["qJsonp"]||[]).push([[74],{1038:function(e,t,a){var i,r;!(i=[a,t],r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a;(function(e){e["INVALID_GEOMETRY"]="geo.error.invalidGeometry";e["FAILED_LOOKUP"]="geo.error.failedLookup";e["LIMITED_DATA"]="Object.Disclaimer.LimitedData";e["UNSUCCESFULL_LOOKUP"]="geo.error.unsuccessfulLookup";e["AMBIGUOUS_LOOKUP"]="geo.error.ambiguousLookup";e["INVALID_WIDTH"]="geo.error.invalidWidth";e["INVALID_WEIGHT"]="geo.error.invalidWeight";e["INVALID_URL"]="geo.error.invalidUrl";e["OFFLINE_LOOKUP"]="geo.error.offline"})(a||(a={}));t.default=a}.apply(t,i),void 0!==r&&(e.exports=r))},1056:function(e,t,a){(function(i){var r,o;!(r=[a,t],o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a;(function(e){e[e["Full"]=2]="Full";e[e["Small"]=1]="Small";e[e["None"]=0]="None"})(a=t.Mode||(t.Mode={}));var r=function(){function e(e){this.wantsToExpand=false;this.element=e.element||i("<div>").addClass("legend-object").css({flex:"1 1 auto",boxSizing:"border-box",height:"auto",position:"relative"}).appendTo(e.parent);this.layer=e.layer;this.displayMode=e.maxMode}e.prototype.remove=function(){this.element.remove()};e.prototype.updateData=function(){};e.prototype.isVisible=function(e){return e>a.None&&this.displayMode>a.None&&e>=this.displayMode};e.prototype.hide=function(){this.element.hide()};e.prototype.show=function(){this.element.show()};e.prototype.isRtl=function(){return Boolean(this.layer&&"rtl"===this.layer.map.extensionObject.options.direction)};e.prototype.getScale=function(){return this.layer&&this.layer.map.chartScale||1};e.prototype.preDraw=function(){};e.prototype.getHeight=function(){return this.element.height()||0};return e}();t.default=r}.apply(t,r),void 0!==o&&(e.exports=o))}).call(this,a(11))},1146:function(e,t,a){var i,r;!(i=[a,t],r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a;(function(e){function t(e,t,a){return{min:[e.min[0]+a,e.min[1]+t],max:[e.max[0]+a,e.max[1]+t]}}e.shiftBounds=t;function a(e,t){return{min:[Math.min(e.min[0],t.min[0]),Math.min(e.min[1],t.min[1])],max:[Math.max(e.max[0],t.max[0]),Math.max(e.max[1],t.max[1])]}}e.mergeBounds=a;function i(t,a){return e.getBoundsWidth(t)>e.getBoundsWidth(a)?a:t}e.getNarrowestBounds=i;function r(e){return e.max[1]-e.min[1]}e.getBoundsWidth=r;function o(t,a){var i=t.reduce(function(t,i){if(!i)return t;if(!t)return i;if(t.min[1]<i.min[1]){var r=t;t=i;i=r}return isNaN(a)?e.mergeBounds(t,i):e.getNarrowestBounds(e.mergeBounds(t,i),e.mergeBounds(t,e.shiftBounds(i,2*a,0)))},null);if(i&&i.max[1]-i.min[1]>=2*a*.95){i.min[1]=-a;i.max[1]=a}return i}e.mergeBoundsArray=o;function n(e){if(e.length>=2){var t=e[0];e[0]=e[1];e[1]=t}}function s(e,t){t=t||0;var a=t;if(Array.isArray(e[0]))for(var i=0;i<e.length;i++)a=Math.max(s(e[i],t+1),a);else n(e);return a}e.switchCoordinates=s;function l(t){var a=JSON.parse(t);var i=e.switchCoordinates(a);if(i>2)return[].concat.apply([],a);return a}e.parseGeometryString=l;function u(e,t){return Math.abs(e[0]-t[0])<1e-5&&Math.abs(e[1]-t[1])<1e-5}e.equalsCoord=u;function d(t,a){return e.equalsCoord(t.min,a.min)&&e.equalsCoord(t.max,a.max)}e.equalsRect=d;function p(e,t){return t.min[0]<=e.min[0]&&t.min[1]<=e.min[1]&&t.max[0]>=e.max[0]&&t.max[1]>=e.max[1]}e.inside=p})(a||(a={}));t.default=a}.apply(t,i),void 0!==r&&(e.exports=r))},1185:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(2151),a(2173),a(2174),a(2176),a(2177),a(49),a(113),a(2178),a(1761)],r=function(e,t,i,r,n,s,l,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});i=o(i);r=o(r);n=o(n);s=o(s);l=o(l);u=o(u);d=o(d);p=o(p);var c={View:n.default,definition:i.default.properties,softDefinition:!(!d.default.GEO_EXPLORATION_MENU&&!u.default.getFlag("GEO_EXPLORATION_MENU"))&&p.default.getMapSoftProperties(),template:a(1761),scope:null,BackendApi:r.default,initialProperties:i.default.applyMapConfig({gaVersion:2,gaLayers:[],layers:[]}),exportProperties:null,importProperties:null,support:{export:true,exportData:false,snapshot:true,colorBy:true,sharing:true},options:{usingDerivedProperties:true},data:{dimensions:{min:0,max:0,obsolete:true},measures:{min:0,max:0,obsolete:true}},hasError:function(e){return false},showRequirements:function(e){return false},migrate:{properties:function(e){return e},snapshot:function(e){l.default.migrateLayout(e);return e}},getDropFieldOptions:function(e,t,a,i,r){new s.default(e,t,a,i,r)},getDropDimensionOptions:function(e,t,a,i,r){new s.default(e,t,a,i,r)},getDropMeasureOptions:function(e,t,a,i,r){new s.default(e,t,a,i,r)}};t.default=c}.apply(t,i),void 0!==r&&(e.exports=r))},1186:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(1056),a(1756),a(1755),a(89),a(2158),a(2159),a(1599),a(49),a(113)],r=function(e,t,a,i,r,s,l,u,d,p,c,h){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);p=n(p);c=n(c);h=n(h);var f=function(e){o(t,e);function t(t,o){void 0===o&&(o={});var n=e.call(this,{parent:t.map.sidebar.element,layer:t,maxMode:i.Mode.Small})||this;n.isDimmed=false;n.height=0;n.options=o;n.sidebar=t.map.sidebar;n.sidebar.addComponent(n);n.element.addClass("legend").css({flexDirection:"column"});n.mainContainer=a.default("<div>").css({flexDirection:"column",flex:"1 1 auto",display:"flex"});n.errorDiv=a.default("<div>").addClass("map-error-container").append(a.default("<div>").attr({tid:"object.Error","qv-errorhandler":""}).addClass("object-error").append(a.default("<div>").addClass("object-error-content").append([a.default("<div>").addClass("object-error-title"),a.default("<div>").addClass("object-error-message")]))).hide().appendTo(n.element);n.addComponent(new u.default(n.element,t,n.options));if("getColorLegendInfo"in n.layer){n.mainContainer.appendTo(n.element);n.addComponent(new r.default(n.mainContainer,n.layer,true));if(h.default.GEO_SIZE_LEGEND||c.default.getFlag("GEO_SIZE_LEGEND")){var s=t.layout.type;"LineLayer"!==s&&"PointLayer"!==s&&"ChartLayer"!==s||n.addComponent(new d.default(n.mainContainer,n.layer,true))}}n.setDisplayMode(t.layout.displayLegend);return n}t.prototype.isExpanded=function(){return this.currentMode>i.Mode.Small&&this.components.some(function(e){return e instanceof p.default&&e.isValid()})};t.prototype.isVisible=function(t){return this.layer.layout.showLayer&&e.prototype.isVisible.call(this,t)};t.prototype.preDraw=function(){this.setDisplayMode(this.layer.layout.displayLegend);e.prototype.preDraw.call(this)};t.prototype.draw=function(t){var a=this;var r=new l.default;if(!this.sidebar||!this.isVisible(this.sidebar.currentMode)){r.resolve(this);return r.promise}t=t||this.sidebar.isHorizontal();if(this.legendContainsErrorMsg()){this.setDisplayMode("error");this.wantsToExpand=false;this.element.css("flex","0 0 auto")}else if(this.dimStatus()){this.setDisplayMode("small");this.setDimmed(true)}else{this.setDisplayMode(this.layer.layout.displayLegend);this.setDimmed(false)}var o=this.getScale();var n=this.sidebar.element;this.element.css({paddingBottom:1===this.components.filter(function(e){return e.element.is(":visible")}).length?5*o+"px":0,maxHeight:t?n.height()+"px":"none",maxWidth:t?"none":n.width()+"px"});this.mainContainer.css({flexDirection:t?"row":"column"});e.prototype.draw.call(this,t).then(function(){var e=a.isExpanded();var n=0;e&&(n=Math.max(150,a.components.filter(function(e){return e.isVisible(a.currentMode)}).reduce(function(e,a){return e+(parseInt(a.element.css("min-"+(t?"width":"height")),10)||0)},0)));a.element.css({minWidth:t&&n?n*o+"px":"auto",minHeight:!t&&n?n*o+"px":"auto"});a.wantsToExpand&&a.currentMode!==i.Mode.Small?a.element.css("flex","1 0 auto"):a.element.css("flex","0 0 auto");setTimeout(function(){return r.resolve(a)})});return r.promise};t.prototype.updateData=function(){this.components.forEach(function(e){return e.updateData()})};t.prototype.setDrawOrder=function(e){this.element.css("order",e)};t.prototype.setError=function(e,t,a){if(e&&t&&this.sidebar){this.errorDiv.find(".object-error").addClass(e);this.errorDiv.find(".object-error-message").html(t);a&&this.errorDiv.find(".object-error-title").html(a);this.errorDiv.show()}else this.errorDiv.hide()};t.prototype.legendContainsErrorMsg=function(){var e=this.layer.layout.qHyperCube&&this.layer.layout.qHyperCube.qError;return this.errorDiv.is(":visible")||e&&this.layer.map.errorHandler.hasCalcConditionFailed(e.qErrorCode)};t.prototype.remove=function(){var t=this;this.hide();if(this.sidebar){this.sidebar.components=this.sidebar.components.filter(function(e){return e!==t});this.sidebar=null}this.errorDiv&&this.errorDiv.remove();e.prototype.remove.call(this)};t.prototype.setDimmed=function(e){this.isDimmed=e;this.element.toggleClass("dim",e)};t.prototype.setDisplayMode=function(e){if(!this.sidebar)return;var t=this.layer.map.layout.mapSettings;switch(e){case"error":this.show();this.currentMode=i.Mode.None;break;case"none":this.hide();this.currentMode=i.Mode.None;break;case"small":this.layer.map.mapHasFailingCalcCond()&&!t.showLegend?this.hide():this.show();this.currentMode=i.Mode.Small;break;case"full":case"auto":default:this.layer.map.mapHasFailingCalcCond()&&!t.showLegend?this.hide():this.show();this.currentMode=i.Mode.Full;break}};t.prototype.dimStatus=function(){var e=this.layer.layout;var t=this.layer.map;var a=false;var i=t.layout.snapshotData;var r=e.cId&&i&&i.layers&&i.layers[e.cId]&&i.layers[e.cId].visible;a=t.extensionObject.backendApi.isSnapshot?!r:!this.layer.fulfillsRequirements()||!this.layer.isInVisibleRange();return a};return t}(s.default);t.default=f}.apply(t,i),void 0!==r&&(e.exports=r))},1262:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(2155),a(507),a(1321)],r=function(e,t,a,i,r){"use strict";a=n(a);i=n(i);r=n(r);var s=function(e){o(t,e);function t(t,i,r,o){var n=e.call(this,t,i,r,o)||this;n.featureTable={};n.colorElemNos=new Set;n.layout=i;n.colorMap=new a.default(n.map.extensionObject.backendApi.model.app,n.layout.color,n.layout.type);return n}t.prototype.paint=function(){var t=this;if(this.isVisible()&&this.fulfillsRequirements()){var a=this.excludeLayout.qHyperCube.qDimensionInfo[0].qStateCounts;var r=this.map.layout.snapshotData;var o=void 0;this.id&&r&&r.layers&&r.layers[this.id]&&(o=r.layers[this.id].colorSnapshotData);if(a&&a.qAlternative+a.qExcluded+a.qLockedExcluded+a.qSelectedExcluded>0){var n=i.default.getDimensionExpressionIndex("colorByAlternative",this.excludeLayout.qHyperCube);n||(n=i.default.getDimensionExpressionIndex("colorByExpression",this.excludeLayout.qHyperCube));n&&this.excludeLayout.qHyperCube.qDataPages[0].qMatrix.forEach(function(e){if("X"===e[0].qState)if(n.isDim)e[n.dimensionIndex].qAttrDims.qValues[n.index].qText="";else{e[n.dimensionIndex].qAttrExps.qValues[n.index].qNum="NaN";e[n.dimensionIndex].qAttrExps.qValues[n.index].qText=""}})}this.colorMap.getComboColorMap().setSnapshotChartData(o);this.colorMap.setData(this.excludeLayout).then(function(){e.prototype.paint.call(t)})}else{this.fulfillsRequirements()||this.clearData();this.done()}return this.deferred.promise};t.prototype.getColorValues=function(e){Array.isArray(e)&&(e=i.default.flattenData(e));var t=e.qMatrix;var a=this.layout.color;var r=a?a.mode:"";var o=[];var n=this.layout.qHyperCube.qDimensionInfo.length-1;var s=null;if("byMeasure"===r){s=i.default.getDimensionExpressionIndex("colorByAlternative",this.layout.qHyperCube);s&&s.isDim&&(s=null)}else s="byExpression"===r?i.default.getDimensionExpressionIndex("colorByExpression",this.layout.qHyperCube):i.default.getDimensionExpressionIndex("colorByAlternative",this.layout.qHyperCube);var l=s&&s.isDim;var u="byMeasure"===r&&s&&!s.isDim;var d="byExpression"===r&&s;var p=0;if(s){p=s.index;n=s.dimensionIndex}for(var c=0;c<t.length;c++){var h=t[c];var f=h[n].qAttrExps;var m=h[n].qAttrDims;try{if(l&&m){var y=m.qValues[p];o.push({elemNo:y.qElemNo,value:y.qText||""})}else(u||d)&&f?o.push({value:f.qValues[p].qNum}):o.push({value:null})}catch(e){o.push({value:null})}}return o};t.prototype.getColorLegendInfo=function(){return this.colorMap.getColorLegendInfo(this.excludeLayout.qHyperCube)};t.prototype.doRemove=function(){e.prototype.doRemove.call(this);this.colorMap.release();this.toolTip.disconnect()};t.DEFAULT_COLUMNS=["geoname","id","name","color","label","excluded"];return t}(r.default);return s}.apply(t,i),void 0!==r&&(e.exports=r))},1321:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1598),a(507),a(1038),a(89),a(1170),a(201),a(90),a(879)],r=function(e,t,a,i,r,s,l,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);p=n(p);var c=function(e){o(t,e);function t(t,a,i,r){var o=e.call(this,t,a,i,r)||this;o.hardLimit=1e4;o.featureTable={};o.colorElemNos=new Set;return o}t.prototype.clearData=function(){this.dataset&&this.dataset.removeAll()};t.prototype.updateData=function(){var e=[];var t=1e3;var a=Math.min(this.hardLimit,void 0!==this.layout.maxObjects?this.layout.maxObjects:t);if("ChartLayer"===this.layout.type){if(2===this.excludeLayout.qHyperCube.qDimensionInfo.length){e.push(this.loadData({path:"/qUndoExclude/gaLayers/"+this.index+"/locCube/qHyperCubeDef",pages:this.excludeLayout.locCube.qHyperCube.qDataPages},a));e.push(this.loadData({path:"/qUndoExclude/gaLayers/"+this.index+"/qHyperCubeDef",pages:this.excludeLayout.qHyperCube.qDataPages},this.hardLimit))}}else e.push(this.loadData({path:"/qUndoExclude/gaLayers/"+this.index+"/qHyperCubeDef",pages:this.excludeLayout.qHyperCube.qDataPages},a));return s.default.all(e)};t.prototype.handleqError=function(){var e=-1;if(this.layout.qHyperCube.qError){e=this.layout.qHyperCube.qError.qErrorCode;this.map.errorHandler.handleqError(e,this)}else this.map.errorHandler.handleqError(-1,this)};t.prototype.loadData=function(e,t){var a=this;var i=new s.default;if(this.excludeLayout.qHyperCube.qDimensionInfo.length<1){i.resolve();return i.promise}if(!this.isVisible()){this.layer.setVisible(false);i.resolve();this.clearData();this.map.errorHandler.clearqError(this);return i.promise}this.layer.setVisible(true);var o=1e3;var n=this.map.extensionObject.backendApi;n.setPath(e.path);var l=n.getSize().qcy;var u=e.pages;var d=u.length?u[0]:null;var p=null!=d?d.qArea.qHeight:0;var c=function(e){e.resolve();u.length=0;a.handleqError()};if(this.layout.qHyperCube.qError){c(i);return i.resolve()}this.map.errorHandler.clearqError(this);if(d&&(p>t||p===t&&l>t)){d.qArea.qHeight=t;d.qMatrix=d.qMatrix.slice(0,t);this.map.addError(r.default.LIMITED_DATA,this);return i.resolve()}if(l>p&&!n.isSnapshot){var h=p;var f=[{qTop:h,qLeft:0,qWidth:10,qHeight:Math.min(l,Math.min(o,t-h))}];var m=function(s){if(a.layout.qHyperCube.qError){c(i);return}a.map.errorHandler.clearqError(a);var p=s[0];h+=p.qArea.qHeight;if(d){d.qMatrix=d.qMatrix.concat(p.qMatrix);d.qArea.qHeight=h}else{d=p;u.push(d)}try{if(h>=t||h>=l){i.resolve();l>t&&a.map.addError(r.default.LIMITED_DATA,a)}else{f[0].qTop=h;f[0].qHeight=Math.min(Math.min(l,t)-h,o);n.getData(e.path,f).then(m)}}catch(e){c(i)}};n.getData(e.path,f).then(m)}else i.resolve();return i.promise};t.prototype.fulfillsRequirements=function(){return this.hyperCubeLayout.qDimensionInfo.length>0};t.prototype.prePaint=function(){e.prototype.prePaint.call(this);this.createFormatters()};t.prototype.paint=function(){var t=this.hyperCubeLayout.qDimensionInfo.length>0;if(this.isVisible()&&t){this.legend.updateData();e.prototype.paint.call(this)}else{t||this.clearData();this.done()}return this.deferred.promise};t.prototype.clear=function(){this.dataset&&this.dataset.removeAll()};t.prototype.doRemove=function(){this.layer&&this.layer.remove();this.dataset&&this.dataset.removeAll()};t.prototype.getPath=function(){var e=this.map.layers;var t=e.indexOf(this);return"/qUndoExclude/gaLayers/"+t+"/qHyperCubeDef"};t.prototype.createFormatters=function(){if(!this.hyperCubeLayout.qDimensionInfo.length)return;var e={};var t=this.createMockMeasureInfo(this.hyperCubeLayout);var a=this.map.extensionObject.backendApi.localeInfo;for(var i=0;i<t.length;i++){var r=new l.default(a,t[i]);var o=this.hyperCubeLayout.qDimensionInfo[i].qAttrExprInfo;var n=r.getFormatters();for(var s=0;s<o.length;s++)n[s]&&(e[o[s].id]=n[s])}if(this.hyperCubeLayout.qMeasureInfo&&this.hyperCubeLayout.qMeasureInfo.length>0){var r=new l.default(a,[this.hyperCubeLayout.qMeasureInfo[0]]);var n=r.getFormatters();n[0]&&(e["measure"]=n[0])}if("ChartLayer"===this.layout.type&&this.locationCubeLayout){var u=this.createMockMeasureInfo(this.locationCubeLayout);var d=this.map.extensionObject.backendApi.localeInfo;for(var i=0;i<u.length;i++){var r=new l.default(d,u[i]);var o=this.locationCubeLayout.qDimensionInfo[i].qAttrExprInfo;var n=r.getFormatters();for(var s=0;s<o.length;s++)n[s]&&(e[o[s].id]=n[s])}}this.expressionFormatters=e};t.prototype.createMockMeasureInfo=function(e){var t=[];var a;for(var i=0;i<e.qDimensionInfo.length;i++){var r=e.qDimensionInfo[i].qAttrExprInfo;var o=[];for(var n=0;n<r.length;n++){a=JSON.parse(JSON.stringify(e.qDimensionInfo[i]));a.qMax=r[n].qMax;a.qMin=r[n].qMin;a.qFallbackTitle=r[n].qFallbackTitle;o.push(a)}t.push(o)}return t};t.prototype.getGeometry=function(e,t,a){Array.isArray(e)&&(e=i.default.flattenData(e));if(!this.layout.qHyperCube.qDimensionInfo[0])return[];var r=this.layout;var o=this.excludeLayout.useDimLoc1;var n="locationOrLatitude";if(1===t&&this.layout.location2){r=this.layout.location2;o=this.excludeLayout.useDimLoc2;n="location2.locationOrLatitude"}var s=r.isLatLong;var l=!s&&r.locationOrLatitude&&(r.locationOrLatitude.key||"").trim().length>0;if(l){var u=i.default.getStringOrNumber(n,e,a);if(0===u.length){var d=void 0===o?void 0===r.locationOrLatitude.useDim?t:r.locationOrLatitude.useDim:o;return this.getLocationFromDimension(e,d)}return u}return s?this.getLatLong(e,t,a):this.getLocationFromDimension(e,t)};t.prototype.getPathGeometry=function(e,t){Array.isArray(e)&&(e=i.default.flattenData(e));if(!this.layout.qHyperCube.qDimensionInfo[0])return[];var a=this.layout;var r=a.path&&a.path.field&&(a.path.field.key||"").trim().length>0;if(r){var o=i.default.getStringOrNumber("path",e,t);if(0===o.length)return this.getLocationFromDimension(e,0);return o}return this.getLocationFromDimension(e,0)};t.prototype.getLocationFromDimension=function(e,t){Array.isArray(e)&&(e=i.default.flattenData(e));var a=e.qMatrix;var r=[];for(var o=0;o<a.length;o++)try{var n=a[o];var s=null;n[t].qText?s=n[t].qText:void 0!==n[t].qNum&&(s=n[t].qNum);r.push(s)}catch(e){r.push(null)}return r};t.prototype.getLatLong=function(e,t,a){Array.isArray(e)&&(e=i.default.flattenData(e));var r=e.qMatrix;var o=[];var n="locationOrLatitude";var s="longitude";if(1===t){n="location2.locationOrLatitude";s="location2.longitude"}var l=i.default.getDimensionExpressionIndex(n,a);var u=i.default.getDimensionExpressionIndex(s,a);if(null==l||null==u)return o;var d=l.index;var p=u.index;for(var c=0;c<r.length;c++)try{var h=0;r[c][t]&&(h=t);var f=r[c][h].qAttrExps;var m=r[c][h].qAttrDims;var y=void 0;var v=void 0;var g=0;var b=0;if(l.isDim){y=m.qValues[d].qText;if(!y){o.push(null);continue}g=parseFloat(y.replace(/,/,"."))}else g=f.qValues[d].qNum;if(u.isDim){v=m.qValues[p].qText;if(!v){o.push(null);continue}b=parseFloat(v.replace(/,/,"."))}else b=f.qValues[p].qNum;o.push([g,b])}catch(e){o.push(null)}return o};t.prototype.addLocationSuffix=function(e,t,a,r,o){if(a)return e;Array.isArray(t)&&(t=i.default.flattenData(t));o=o||"";var n=p.default.byString(this,"layout."+o+"locationType");var s=e.length;var l=i.default.getStringData(o+"country",t,r);if(l.length>0){var u=i.default.getStringData(o+"admin1",t,r);if(u.length>0){var d=i.default.getStringData(o+"admin2",t,r);if(d.length>0)for(var c=0;c<s;c++)e[c]+=","+d[c];for(var c=0;c<s;c++)e[c]+=","+u[c]}for(var c=0;c<s;c++)e[c]+=","+l[c]}if(n&&n.length>0)for(var c=0;c<s;c++)e[c]+=":"+n;return e};t.generateAttributeObject=function(e,t,a,i,r,o){return d.default.extend(true,{id:String(e),name:t,color:i,label:a,excluded:r},o||{})};t.generateAttributeArray=function(e,t,a,i,r,o,n){return[e,String(t),a,r,i,o].concat(n||[])};t.prototype.hasFeatures=function(){var e=this.dataset?this.dataset.getAll():null;return null!==e&&e.length>0};t.isLocationDataset=function(e){if(e instanceof idevio.map.RemoteServiceLocationDataset||e instanceof idevio.map.FileLocationDataset)return true;return false};t.prototype.isVisible=function(){if(!this.isDrillDownLevelVisible())return false;return e.prototype.isVisible.call(this)};t.prototype.isDrillDownLevelVisible=function(){if(this.layout.drillDown.auto)return true;if("H"===this.layout.qHyperCube.qDimensionInfo[0].qGrouping){var e=this.layout.qHyperCube.qDimensionInfo[0].qGroupPos;return!this.layout.drillDown.hasOwnProperty("showLevel"+e)||this.layout.drillDown["showLevel"+e]}return true};t.prototype.getLocationType=function(e,t){this.colorElemNos.clear();if(t)return"LATLONGS";var a=e.length;for(var i=0;i<a;i++)if(null!=e[i]&&"-"!==e[i]){if("string"===typeof e[i]){var r=e[i];return"["===r.charAt(0)?"STRINGCOORDS":"NAMES"}return"NAMES"}return"UNKNOWN"};t.prototype.makeOrChangeDataset=function(e,t,a,i){this.featureTable={};this.colorElemNos.clear();if(a){if(!this.dataset||!(this.dataset instanceof idevio.map.MemoryDataset)||this.dataset.getCrs()!==this.map.crs){this.dataset=new idevio.map.MemoryDataset({name:name,crs:this.map.crs});this.layer.setDataset(this.dataset)}return"LATLONGS"}function o(e){if(!idevio.Connection.baseUrl){e.dataset=idevio.map.LocationDataset.create("","SERVICE_POINT",{columnNames:t,name:e.id});e.layer.setDataset(e.dataset);e.map.addError(r.default.OFFLINE_LOOKUP,e);e.done();return}if(!e.dataset||!e.dataset.getAll()||!(e.dataset instanceof idevio.map.LocationDataset||e.dataset instanceof idevio.map.RemoteServiceLocationDataset)){var a={columnNames:t,name:e.id,onload:function(){var t=e.dataset.getAll();t&&t.forEach(function(t){var a=t.getAttribute("id");var i=t.getAttribute("subIds");i&&i.length?i.forEach(function(i){return e.featureTable[String([a,i])]=t}):e.featureTable[a]=t;var r=t.getAttribute("color")||{};null!=r.elemNo&&e.colorElemNos.add(r.elemNo)});e.done()},onerror:function(t){if(/error/i.test(t.level))e.map.addError(r.default.FAILED_LOOKUP,e);else{var a=t.message.trim().split(/\n/g);e.map.addError(r.default.UNSUCCESFULL_LOOKUP,e,a)}e.done()}};e.dataset=idevio.map.LocationDataset.create("Area"===i?"i:///areageom/default":"i:///pointgeom/default","SERVICE",a);e.layer.setDataset(e.dataset)}}var n=e.length;for(var s=0;s<n;s++)if(null!=e[s]&&"-"!==e[s]){if("string"===typeof e[s]){var l=e[s];if("["===l.charAt(0)){if(!this.dataset||!(this.dataset instanceof idevio.map.MemoryDataset)||this.dataset.getCrs()!==this.map.crs){this.dataset=new idevio.map.MemoryDataset({name:this.name,crs:this.map.crs});this.layer.setDataset(this.dataset)}return"STRINGCOORDS"}o(this);return"NAMES"}o(this);return"NAMES"}return"UNKNOWN"};t.prototype.getLabelStyle=function(e){void 0===e&&(e={});var t=u.default.getStyle("mapChart","label.value","color");var a=u.default.getFontSize("mapChart","label.value","fontSize");var i=this.translateZoomRange(this.layout.label.showInAllLevels,this.layout.label.visibleRange,this.map.map),r=i[0],o=i[1];return{type:"text",textAttribute:"label",color:t,haloColor:u.default.getInverse(t),font:"bold "+a+" QlikView Sans",placement:"FIXED",anchorX:"MIDDLE",anchorY:e.anchorY||"BOTTOM",pointDistanceKey:e.pointDistanceKey,minRes:r,maxRes:o}};t.DEFAULT_COLUMNS=["geoname","id","name","color","label","excluded"];return t}(a.default);t.default=c}.apply(t,i),void 0!==r&&(e.exports=r))},1322:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(1601),a(208),a(507),a(512),a(2160),a(431),a(91)],r=function(e,t,a,i,r,s,l,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);p=n(p);var c=function(e){o(t,e);function t(t,a){var i=e.call(this,a,{viewOption:"tooltips"})||this;i.tooltipService=u.default.get();i.features=null;i.position=null;i.coordinate=null;i.layer=t;i.direction=a.extensionObject.options.direction;i.connectTo(a.map);return i}t.prototype.clear=function(){this.features=null;this.position=null;this.coordinate=null};t.prototype.closeTooltip=function(){this.tooltipService.close();this.clear()};t.prototype.belongsToMyDataset=function(e){return e.getDataset()===this.layer.layer.getDataset()};t.prototype.calcGoodPosition=function(e,a){var i=this.mapChart.map.geoToDisplay(e[0].getCenter());for(var r=1;r<e.length;r++){var o=this.mapChart.map.geoToDisplay(e[r].getCenter());var n=Math.sqrt(Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2));if(n>t.MULTI_CENTER_TOLERANCE_PX){i=[a.clientX,a.clientY];break}}i[0]=Math.max(0,Math.min(this.mapChart.mapDiv.width()||0,i[0]));i[1]=Math.max(1,Math.min(this.mapChart.mapDiv.height()||0,i[1]));this.position=i;this.coordinate=this.mapChart.map.displayToGeo(this.position);var s=this.mapChart.mapDiv.offset();return[s.left+i[0],s.top+i[1]]};t.prototype.openTooltip=function(e){var a=this;if(!e.target)return;var i=this.mapChart.map.getFeaturesAt(e.clientX,e.clientY).filter(function(e){return a.belongsToMyDataset(e)});var r=this.features&&i.length===this.features.length&&i.reduce(function(e,t){return e&&-1!==a.features.indexOf(t)},true);if(r)return;this.features=i;var o=this.features.slice(0,t.MAX_FEATURES);var n=this.calcGoodPosition(o,e);this.tooltipService.open(n,this.generateContent(o),this.direction,this,"click"===e.type,i.length-t.MAX_FEATURES)};t.prototype.generateContent=function(e){var a=this;var i={};var o=e[0].getAttributes();var n=!!o.parts;var u=this.layer.colorMap.getColorProperties();var p="byExpression"===u.mode?"colorByExpression":"colorByAlternative";n?e.forEach(function(t,r){var o={total:e.length,current:r+1};var n=t.getAttributes();var s=n.name;i[s+r]=a.generateChartLayerContent(n,o)}):e.forEach(function(e){var o=e.getAttribute("name");var n={header:e.getAttribute("name"),rows:{color:{},size:{}}};var c=a.layer.colorMap.getComboColorMap();if(!d.default.isExcluded(e)){var h=e.getAttribute("color");if(-1!==t.COLOR_MODES.indexOf(c.mode)&&h&&h.color&&!(u.expressionIsColor&&c.mode===l.default.EXPRESSION)){var f=null==h.value?"-":h.value;var m=r.default.encodeForHTML(f);var y=a.layer.colorMap.getLegendTitle();if(y){var v='<span dir="'+a.direction+'">'+a.formatValue(p,m)+"</span>";var g="";if(!m){v="";g="margin-right: 0;"}n.rows.color={label:y,num:void 0,value:a.formatValue(p,m),template:'<div class="color-template-wrapper"><div class="color-dot" style="background:'+h.color+";"+g+'"></div>'+v+"</div>"}}}var b=e.getAttribute("size");if(null!=b){var y=s.default.getDimensionExpressionTitle("size",a.layer.hyperCubeLayout);var L=a.layer.layout;y&&L.size.label&&"libraryItem"!==L.size.expression.type&&""!==L.size.label&&(y=L.size.label);y&&(n.rows.size={label:r.default.encodeForHTML(y),num:b,value:a.formatValue("size",b)})}}if(i[o]){n.rows.color["value"]&&"-"!==n.rows.color["value"]&&(i[o].rows.color=n.rows.color);n.rows.size["value"]&&"-"!==n.rows.size["value"]&&(i[o].rows.size=n.rows.size);n.rows.size["value"]===n.rows.color["value"]&&n.rows.size["label"]===n.rows.color["label"]&&delete i[o].rows.size}else{n.rows.size["value"]===n.rows.color["value"]&&n.rows.size["label"]===n.rows.color["label"]&&delete n.rows.size;i[o]=n}});var c=[];var h=0;for(var f in i){var m=[];for(var y in i[f].rows)n&&i[f].rows[y].label!=={}?m.push(i[f].rows[y]):i[f].rows[y].label&&m.push(i[f].rows[y]);c.push(i[f]);c[h].rows=m;h++}return c};t.prototype.formatValue=function(e,t){try{if(!isNaN(t)&&this.layer.expressionFormatters&&this.layer.expressionFormatters[e])return this.layer.expressionFormatters[e].format(Number(t));if("NaN"===t)return"-"}catch(e){}return String(t)};t.prototype.show=function(e){var t=e.target;if(!t){this.closeTooltip();return}if(!this.belongsToMyDataset(t))return;if(!this.layer.layout.showPopUp)return;this.openTooltip(e)};t.prototype.hover=function(e){if(this.tooltipService.openedByClick)return;this.show(e)};t.prototype.generateChartLayerContent=function(e,t){var a=e.parts;var i=e.name;var r=e.colorExpression;var o=" ("+t.current+"/"+t.total+")";var n=t.total>1?i+o:i;var s={header:n,rows:{}};var l=e.size;var u=e.relSize;isNaN(l)||null==u||"pieChart"!==this.layer.layout.chartType||this.generateSizeRow(u)&&(s.rows.size=this.generateSizeRow(u));s.rows.chartTable=this.generateChartTable(a,r);return s};t.prototype.generateSizeRow=function(e){var t=this.layer;var a=this.layer.layout;var i=s.default.getDimensionExpressionTitle("size",t.locationCubeLayout);if("libraryItem"!==a.size.expression.type){var o=a.size.expression.activeMeasureIndex;i&&a.size.label&&""!==a.size.label?i=a.size.label:null!=o&&a.qHyperCube.qMeasureInfo.length>o&&(i=a.qHyperCube.qMeasureInfo[o].qFallbackTitle||i)}if(i){var n={label:r.default.encodeForHTML(i),num:e,value:this.formatValue("size",e)};return n}return};t.prototype.generateChartTable=function(e,t){var a=this;var i=this.generateTableRowTemplate(t);var r=[];var o=true;e.forEach(function(e){o&&(r=a.addTableHeaders(r,e,t));r=a.addTableRows(i,r,e);o=false});var n=this.arrayToTable(r,i.length);var s={template:n};return s};t.prototype.generateTableRowTemplate=function(e){var t=[];switch(e){case"dimensionColor":t.push("dimensionColorColumn");t.push("measureColumn");break;case"measureColor":t.push("dimensionColumn");t.push("measureColorColumn");break;case"color":case"expressionColor":t.push("dimensionColumn");t.push("measureColumn");t.push("colorColumn");break;default:t.push("dimensionColumn");t.push("measureColumn");break}"pieChart"===this.layer.layout.chartType&&t.push("shareColumn");return t};t.prototype.addTableHeaders=function(e,t,a){var i=this.layer.colorMap.getLegendTitle();e.push(t.dimension.title);e.push(t.measure.title);"color"!==a&&"expressionColor"!==a||e.push(i);"pieChart"===this.layer.layout.chartType&&e.push(p.default.get("properties.dataPoints.labelmode.share"));return e};t.prototype.addTableRows=function(e,t,a){var i=a.color.color;var r=this.layer.colorMap.getColorProperties();var o="byExpression"===r.mode?"colorByExpression":"colorByAlternative";for(var n=0;n<e.length;n++)switch(e[n]){case"dimensionColumn":t.push(a.dimension.value);break;case"dimensionColorColumn":var s=this.buildRowHtml(i,a.dimension.value);t.push(s);break;case"measureColumn":t.push(this.formatValue("measure",a.measure.value));break;case"measureColorColumn":var l=this.formatValue("measure",a.measure.value);var u=this.buildRowHtml(i,l);t.push(u);break;case"colorColumn":var d=this.formatValue(o,a.color.value);var p=this.buildRowHtml(i,d);t.push(p);break;case"shareColumn":var c=isNaN(a.share)?"-":Math.round(10*a.share)/10+"%";t.push(c);break}return t};t.prototype.buildRowHtml=function(e,t){var a="margin-right: 10px; min-width: 10px; min-height: 10px";return'<div class="color-template-wrapper" style="float:left"><div class="color-dot" style="background:'+e+";"+a+'"></div>'+t+"</div>"};t.prototype.updatePosition=function(){if(!this.coordinate||!this.position)return;var e=this.mapChart.mapDiv.width()||0;var t=this.mapChart.mapDiv.height()||0;var a=this.mapChart.map.geoToDisplay(this.coordinate),i=a[0],r=a[1];if(i<0||i>e||r<0||r>t){this.closeTooltip();return}var o=this.position,n=o[0],s=o[1];this.tooltipService.move(i-n,r-s);this.position=[i,r]};t.prototype.arrayToTable=function(e,t){if(t<1)return"";var a=Math.ceil(e.length/t);var i=0;var r;var o="";var n;var s;var l;for(n=0;n<a;n++){r="";for(s=0;s<t;s++){i=n*t+s;l=i<e.length?e[i]:"&nbsp;";l instanceof Array&&(l=l.length>1?l[0]+": "+l[1]:l[0]);r+=0===n?"<th>"+this.clipText(l)+"</th>":"<td>"+this.clipText(l)+"</td>"}o+="<tr>"+r+"</tr>"}return"<div class='qv-chart-tooltip-map-chartlayer'><table>"+o+"</table></div>"};t.prototype.clipText=function(e){var t=500;e=e||"";t>0&&e.length>t&&(e=e.substr(0,t)+"...");return e};t.prototype._connecting=function(){var e=this;this._addListener("click",this.show);this._addListener("move",this.hover);this._addListener("draw",this.updatePosition);this._addListener("out",function(t){var i=t.nativeEvent;if(i){var r=i.relatedTarget;if(r instanceof HTMLElement){var o=a.default(r);if(o.hasClass("qv-tooltip")||o.parents().hasClass("qv-tooltip"))return}}e.closeTooltip()});this._addListener("basemapchanged",this.closeTooltip)};t.prototype._disconnecting=function(){this.closeTooltip()};t.MAX_FEATURES=4;t.MULTI_CENTER_TOLERANCE_PX=5;t.COLOR_MODES=[l.default.MEASURE,l.default.DIMENSION,l.default.QUALITATIVE,l.default.EXPRESSION];return t}(i.default);t.default=c}.apply(t,i),void 0!==r&&(e.exports=r))},1324:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(91),a(13)],r=function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);var r=function(){function e(){}e.getAvailableLanguages=function(t){var a=[];a.push({value:"auto",label:e.translate("auto","maplang")});if(!t)return a;var i=t.getLayerCount();for(var r=0;r<i;r++){var o=t.getLayer(r);if(o.isBaseLayer()){var n=o.getName();if(n.length>3&&"Eng"===n.substring(n.length-3)){a.push({value:"english",label:e.translate("english","maplang")});a.push({value:"local",label:e.translate("local","maplang")});break}}}return a};e.getDefaultAvailableLanguages=function(){var t=[];t.push({value:"auto",label:e.translate("auto","maplang")});t.push({value:"english",label:e.translate("english","maplang")});t.push({value:"local",label:e.translate("local","maplang")});return t};e.setLanguage=function(e,t){var a=t.getLayerCount();for(var i=0;i<a;i++){var r=t.getLayer(i);if(r.isBaseLayer()){var o=r.getName();if(o.length>3&&"Eng"===o.substring(o.length-3)){var n=t.getLayer(o.substring(0,o.length-3));if(!n)continue;if("english"===e||"auto"===e&&"PointsEng"!==o){r.setVisible(true);n.setVisible(false)}else{r.setVisible(false);n.setVisible(true)}}}}};e.translate=function(e,t){var i="geo.properties."+t+"."+e;var r=a.default.get(i);if(r===i)return e;return r};e.getBaseMapOrEmpty=function(t){if(e.getAvailableMaps().some(function(e){return-1!==e.indexOf(t)}))return t;return"empty"};e.getAvailableBaseMapAndProjections=function(t){var a=t&&t.mapSettings;var i=a&&a.projection||"empty";var r=a&&a.baseMap||"empty";var o=e.getBasemaps(i);var n=[];var s=o.get(r);s.projections.forEach(function(t,a){n.push({value:t,label:e.translate(a,"projection")})});return n};e.getDefaultProjection=function(t,a){var i=e.getBasemaps(a);var r=null;i.forEach(function(e){e.projections.forEach(function(e,t){e===a&&(r=t)})});var o=i.get(t);var n="";o.projections.forEach(function(e,t){""!==n&&t!==r||(n=e)});return n};e.getBasemapOptions=function(t){var a=t&&t.mapSettings&&t.mapSettings.projection;var i=e.getBasemaps(a);var r=[];var o=null;i.forEach(function(t){var a=e.BASE_MAP_IMAGES[t.name]||e.UNKNOWN_MAP_IMAGE;var i={value:t.name,label:e.translate(t.name,"basemap"),src:a};"empty"===t.name?o=i:r.push(i)});o&&r.push(o);return r};e.getBasemapOptionsExplorationMenu=function(t){var a=t&&t.mapSettings&&t.mapSettings.projection;var i=a?e.getBaseMapsAfterProjection(a):e.getBasemaps(a);var r=[];var o=null;i.forEach(function(t){var a={value:t.name,label:e.translate(t.name,"basemap")};"empty"===t.name?o=a:r.push(a)});o&&r.push(o);return r};e.getBaseMapsAfterProjection=function(t){var a=e.getBasemaps();t=t.split("_").length>1?t.split("_")[1]:t.split("_")[0];"default"===t&&(t="mercator");a.forEach(function(e){var i=false;e.projections.forEach(function(e,a){-1===t.indexOf(a)&&-1===t.indexOf(e)||(i=true)});i||a.delete(e.name)});return a};e.getAvailableMaps=function(){if(!e.AVAILABLE_MAPS){e.AVAILABLE_MAPS=idevio.map.WebMap.getLoadedBaseMaps();idevio.map.WebMap.getAvailableBaseMaps(function(t){if(Array.isArray(t)&&t.length>0){t=t.slice();e.AVAILABLE_MAPS=["empty","emptymeters","emptydegreemercator"].concat(t)}})}return e.AVAILABLE_MAPS.slice()};e.getBasemaps=function(t){var a=e.getAvailableMaps().slice();t&&-1===a.indexOf(t)&&a.push(t);return e.parseMaps(a)};e.parseMapName=function(e){var t=e.split("_");var a="";var i="mercator";if(2===t.length){a=t[0];i=t[1]}else if(0===t[0].indexOf("empty")){a="empty";"empty"===t[0]?i="WGS-84":t[0].indexOf("meters")>t[0].indexOf("empty")?i="undefined meters":t[0].indexOf("degreemercator")>t[0].indexOf("empty")&&(i="mercator")}else a=t[0];return{name:a,proj:i}};e.parseMaps=function(t){var a=new Map;t.sort();t.forEach(function(t){var i=e.parseMapName(t),r=i.name,o=i.proj;if(a.has(r))a.get(r).projections.set(o,t);else{var n=new Map;n.set(o,t);a.set(r,{name:r,projections:n})}});return a};e.BASE_MAP_IMAGES={default:i.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_default.png",tiledraster:i.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_default.png",satellite:i.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_satellite.png",empty:i.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_none.png",plain:i.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_plain.png",pale:i.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_pale.png"};e.UNKNOWN_MAP_IMAGE=i.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_none.png";return e}();t.default=r}.apply(t,i),void 0!==r&&(e.exports=r))},1598:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(89),a(879)],r=function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);var r=function(){function e(e,t,i,r){this.index=-1;this.listenerIds=[];this.excludeLayout=r;this.map=e;this.layout=t;this.id=i;this.prevLayout=t;this.isFirstLayout=true;this.deferred=new a.default}e.prototype.addMapListener=function(e,t){this.listenerIds.push(this.map.map.addListener(e,t))};e.prototype.paint=function(){this.prePaint();this.hasLocationChanged()&&this.map.extensionObject.inEditState()&&(this.map.dataChanged=true);if(this.isVisible()){this.layer.setVisible(true);this.doPaint()}else{this.layer.setVisible(false);this.done()}return this.deferred.promise};e.prototype.updateData=function(){return(new a.default).resolve()};e.prototype.prePaint=function(){if(this.layout.zoomRange){var e=this.translateZoomRange(this.layout.showInAllLevels,this.layout.zoomRange,this.map.map),t=e[0],a=e[1];this.layer.setMinRes(t);this.layer.setMaxRes(a)}var r=this.map.layout.snapshotData;var o=this.layout.cId&&r&&r.layers&&r.layers[this.layout.cId]&&r.layers[this.layout.cId].visible;if(o&&this.map.extensionObject.backendApi.isSnapshot){var n=this.translateZoomRange(true,[i.default.ZOOM_RANGE_MIN,i.default.ZOOM_RANGE_MAX],this.map.map),t=n[0],a=n[1];this.layer.setMinRes(t);this.layer.setMaxRes(a)}};e.prototype.remove=function(){var e=this;this.listenerIds.forEach(function(t){try{e.map.map.removeListener(t)}catch(e){}});this.legend&&this.legend.remove();this.doRemove()};e.prototype.clear=function(){};e.prototype.done=function(){this.deferred.resolve()};e.prototype.setIndex=function(e){this.index=e;this.layer&&this.layer.setDrawOrder(100-e);this.legend&&this.legend.setDrawOrder(e)};e.prototype.hasFeatures=function(){return false};e.prototype.isVisible=function(){return this.layout.showLayer};e.prototype.isInVisibleRange=function(){if(!this.layout.showInAllLevels&&this.map.map.setMinResolution&&this.layout.zoomRange){var e=this.translateZoomRange(this.layout.showInAllLevels,this.layout.zoomRange,this.map.map),t=e[0],a=e[1];var i=this.map.map.getResolution();if(i<t||i>a)return false}return true};e.prototype.getBounds=function(){return this.isVisible()&&this.hasFeatures()?this.dataset.getAlternateBounds():null};e.prototype.translateZoomRange=function(e,t,a){var r=t[0],o=t[1];if(!a.getMinLevel)return[0,16e4];if(e)return[Math.floor(a.getZoomLevelResolution(i.default.ZOOM_RANGE_MAX)),Math.ceil(a.getZoomLevelResolution(i.default.ZOOM_RANGE_MIN))];var n=0;var s=0;if(r===i.default.ZOOM_RANGE_MIN)r=Math.ceil(a.getZoomLevelResolution(r));else{s=a.getZoomLevelResolution(r-1);n=a.getZoomLevelResolution(r);r=n+(s-n)/2}if(o===i.default.ZOOM_RANGE_MAX)o=Math.floor(a.getZoomLevelResolution(o));else{s=a.getZoomLevelResolution(o);n=a.getZoomLevelResolution(o+1);o=n+(s-n)/2}return[o,r]};e.prototype.hasLocationChanged=function(){if(this.isFirstLayout){this.isFirstLayout=false;this.prevLayout=this.layout;return true}if(this.layout.qHyperCube.qDimensionInfo[0]&&this.prevLayout.qHyperCube.qDimensionInfo[0]&&!(this.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle===this.prevLayout.qHyperCube.qDimensionInfo[0].qFallbackTitle)){this.prevLayout=this.layout;return true}if(this.layout.qHyperCube.qDimensionInfo[1]&&this.prevLayout.qHyperCube.qDimensionInfo[1]&&"LineLayer"===this.layout.type&&!(this.layout.qHyperCube.qDimensionInfo[1].qFallbackTitle===this.prevLayout.qHyperCube.qDimensionInfo[1].qFallbackTitle)){this.prevLayout=this.layout;return true}if(this.layout.locationOrLatitude&&this.prevLayout.locationOrLatitude&&this.layout.locationCountry&&this.prevLayout.locationCountry&&this.layout.locationAdmin1&&this.prevLayout.locationAdmin1&&this.layout.locationAdmin2&&this.prevLayout.locationAdmin2&&!(this.layout.locationOrLatitude.key===this.prevLayout.locationOrLatitude.key&&this.layout.locationDefault===this.prevLayout.locationDefault&&this.layout.locationNamesAuto===this.prevLayout.locationNamesAuto&&this.layout.locationType===this.prevLayout.locationType&&this.layout.locationCountry.key===this.prevLayout.locationCountry.key&&this.layout.locationAdmin1.key===this.prevLayout.locationAdmin1.key&&this.layout.locationAdmin2.key===this.prevLayout.locationAdmin2.key)){this.prevLayout=this.layout;return true}if(void 0!==this.layout.isLatLong&&void 0!==this.prevLayout.isLatLong&&!(this.layout.isLatLong===this.prevLayout.isLatLong&&this.layout.longitude===this.prevLayout.longitude)){this.prevLayout=this.layout;return true}if(this.layout.location2&&this.prevLayout.location2&&this.layout.location2.locationCountry&&this.prevLayout.location2.locationCountry&&this.layout.location2.locationAdmin1&&this.prevLayout.location2.locationAdmin1&&this.layout.location2.locationAdmin2&&this.prevLayout.location2.locationAdmin2&&!(this.layout.location2.locationOrLatitude.key===this.prevLayout.location2.locationOrLatitude.key&&this.layout.location2.locationDefault===this.prevLayout.location2.locationDefault&&this.layout.location2.locationNamesAuto===this.prevLayout.location2.locationNamesAuto&&this.layout.location2.locationType===this.prevLayout.location2.locationType&&this.layout.location2.locationCountry.key===this.prevLayout.location2.locationCountry.key&&this.layout.location2.locationAdmin1.key===this.prevLayout.location2.locationAdmin1.key&&this.layout.location2.locationAdmin2.key===this.prevLayout.location2.locationAdmin2.key)){this.prevLayout=this.layout;return true}if(this.layout.location2&&this.prevLayout.location2&&void 0!==this.layout.location2.isLatLong&&void 0!==this.prevLayout.location2.isLatLong&&!(this.layout.location2.isLatLong===this.prevLayout.location2.isLatLong&&this.layout.location2.longitude===this.prevLayout.location2.longitude)){this.prevLayout=this.layout;return true}if(this.layout.path&&this.prevLayout.path&&this.layout.path.field&&this.prevLayout.path.field&&"LineLayer"===this.layout.type&&!(this.layout.path.startEndPoint===this.prevLayout.path.startEndPoint&&this.layout.path.field.key===this.prevLayout.path.field.key)){this.prevLayout=this.layout;return true}this.prevLayout=this.layout;return false};return e}();t.default=r}.apply(t,i),void 0!==r&&(e.exports=r))},1599:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1142),a(1056),a(1056),a(89),a(2156),a(1124),a(1600),a(1308)],r=function(e,t,a,i,r,s,l,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);s=n(s);l=n(l);u=n(u);d=n(d);p=n(p);p.default();var c=function(e){o(t,e);function t(t,a,i,o){var n=e.call(this,{parent:t,layer:a,maxMode:r.Mode.Full})||this;n.deferred=new s.default;n.element.addClass("picasso-chart");n.interactable=i;n.picasso=u.default.chart({element:n.element[0],updated:function(){n.onUpdate();n.deferred.resolve(n)}});"loadData"in a&&i&&o&&(n.selectionHandler=new l.default(a,n.picasso,o));n.element.data("findShapes",n.picasso.findShapes.bind(n.picasso));return n}t.prototype.draw=function(e){this.deferred=new s.default;var t=a.default.create({chartID:"mapChart"});this.build(t,e);var i=t.getSettings();i.components.forEach(function(e){/^legend-/.test(e.type||"")&&(e.renderer="svg")});i.dockLayout.center={minWidthRatio:0,minHeightRatio:0};var r=(e,this.element.width())||0;var o=(e,this.element.height())||0;i.dockLayout.size={width:r,height:o};var n=this.getScale();1!==n?i.dockLayout.logicalSize={width:r/n,height:o/n}:1===n&&-1!==this.getMinHeight()&&(i.dockLayout.logicalSize={height:Math.max(this.getMinHeight(),o)});var l={settings:i};this.selectionHandler&&this.selectionHandler.end();this.updatePicasso(l);return this.deferred.promise};t.prototype.updateData=function(){try{var e=this.layer.map.extensionObject.backendApi;this.updatePicasso({data:{key:"qHyperCube",type:"q",data:this.getHyperCube(),config:{localeInfo:e?e.localeInfo:{}}}})}catch(e){}};t.prototype.getHyperCube=function(){return this.layer.excludeLayout.qHyperCube};t.prototype.remove=function(){e.prototype.remove.call(this);if(this.selectionHandler){this.selectionHandler.destroy();this.selectionHandler=void 0}};t.prototype.updatePicasso=function(e){try{this.picasso.update(e)}catch(e){}};t.prototype.isInteractable=function(){var e=this.layer.map.extensionObject;return this.interactable&&e.inAnalysisState()&&!d.default.isSelectionDisabled(this.layer.map)&&false!==e.options.navigation};t.prototype.onUpdate=function(){};t.prototype.getMinHeight=function(){return-1};t.prototype.isValid=function(){return true};return t}(i.default);t.default=c}.apply(t,i),void 0!==r&&(e.exports=r))},1600:function(e,t,a){var i,r;!(i=[a,t],r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=function(){function e(){}e.isPolygon=function(e){return e instanceof idevio.map.PolygonFeature&&!(e instanceof idevio.map.LineStringFeature)};e.isLine=function(e){return e instanceof idevio.map.LineStringFeature&&!(e instanceof idevio.map.PolygonFeature)};e.isPoint=function(e){return e instanceof idevio.map.PointFeature};e.isSelectionDisabled=function(e){var t=e.extensionObject.options;if("boolean"===typeof t.selections)return false===t.selections;return true===t._disableSelections};e.pointInPolygon=function(e,t,a){var i=false;for(var r=0,o=a.length-1;r<a.length;o=r++)a[r][1]>t!==a[o][1]>t&&e<(a[o][0]-a[r][0])*(t-a[r][1])/(a[o][1]-a[r][1])+a[r][0]&&(i=!i);return i};e.isLassoClosed=function(e){var t=e[0][0]===e[e.length-1][0];var a=e[0][1]===e[e.length-1][1];return t&&a};e.linesIntersect=function(e,t,a,i){var r=[a[0]-e[0],a[1]-e[1]];var o=[t[0]-e[0],t[1]-e[1]];var n=[i[0]-a[0],i[1]-a[1]];var s=r[0]*o[1]-r[1]*o[0];var l=r[0]*n[1]-r[1]*n[0];var u=o[0]*n[1]-o[1]*n[0];if(0===s)return a[0]-e[0]<0!==a[0]-t[0]<0||a[1]-e[1]<0!==a[1]-t[1]<0;if(0===u)return false;var d=1/u;var p=l*d;var c=s*d;return p>=0&&p<=1&&c>=0&&c<=1};e.distanceBetweenPoints=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))};e.lineCircleIntersect=function(e,t,a,i,r,o,n){return this.pointToLineDistance(e,t,a,i,r,o)<n};e.pointToLineDistance=function(e,t,a,i,r,o){var n=r-e;var s=o-t;var l=a-e;var u=i-t;var d=n*l+s*u;var p=l*l+u*u;var c=-1;0!==p&&(c=d/p);var h;var f;if(c<0){h=e;f=t}else if(c>1){h=a;f=i}else{h=e+c*l;f=t+c*u}var m=r-h;var y=o-f;return Math.sqrt(m*m+y*y)};e.getLayerFromFeature=function(e,t){for(var a=0;a<t.length;a++)if(t[a].dataset===e.getDataset())return t[a];return null};return e}();t.default=a}.apply(t,i),void 0!==r&&(e.exports=r))},1601:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(123)],r=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);var i=function(e){o(t,e);function t(a,i){var r=e.call(this,i)||this;r.validStates=t.DEFAULT_STATES;r.viewOption=null;r.mapChart=a;if(i){i.states&&(r.validStates=i.states);i.viewOption&&(r.viewOption=i.viewOption);i.isOff&&(r.isOff=i.isOff)}return r}t.prototype.isValidState=function(){var e=this.mapChart.extensionObject.options;var t=-1!==this.validStates.indexOf(e.interactionState);var a=!this.viewOption||false!==e[this.viewOption];var i=!this.isOff||!this.isOff();return t&&a&&i};t.prototype._addListener=function(e,t){var a=this;this._listeners.push(this._map.addListener(e,function(e){a.isActive()&&a._map&&a.isValidState()&&t.call(a,e)}))};t.patch=function(e,a,i){Object.defineProperties(e,{viewOption:{value:i?i.viewOption:null},mapChart:{value:a},validStates:{value:i&&i.states||t.DEFAULT_STATES},isValidState:{value:t.prototype.isValidState},_addListener:{value:t.prototype._addListener},isOff:{value:i&&i.isOff}});return e};t.DEFAULT_STATES=[a.default.ANALYSIS];return t}(idevio.map.Tool);t.default=i}.apply(t,i),void 0!==r&&(e.exports=r))},1754:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(431),a(1146),a(2153),a(284),a(2154),a(2162),a(2163),a(2164),a(2165),a(2166),a(2167),a(2168),a(1601),a(2169),a(1324),a(89),a(2170),a(123),a(1038),a(1758),a(1321),a(1323)],r=function(e,t,a,i,r,n,s,l,u,d,p,c,h,f,m,y,v,g,b,L,D,M,C,q){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);s=o(s);l=o(l);u=o(u);d=o(d);p=o(p);c=o(c);h=o(h);f=o(f);m=o(m);y=o(y);v=o(v);g=o(g);b=o(b);L=o(L);D=o(D);M=o(M);q=o(q);var S=function(){function e(e,t,r){var o=this;this.dataChanged=true;this.attributions={};this.limitedData=false;this.autoZoomOnce=false;this.setInitialViewOnce=false;this.listenerIds=[];this.zoomToSelection=false;this.selectionType="";this.crs="EPSG:4326";this.tools={panTool:null,zoomTool:null,scaleBar:null,debugLayer:null};this.chartScale=-1;this.mapHomeBounds={max:[0,0],min:[0,0]};this.closeLingeringToolTips=function(){for(var e=0;e<o.layers.length;e++){var t=o.layers[e];t.toolTip&&t.toolTip.closeTooltip()}};this.parentDiv=e.find(".qv-viz");this.layout=t;this.id=t.qInfo.qId;this.layers=[];this.extensionObject=r;this.mapDiv=a.default(".webmap-div",this.parentDiv).attr("id","mapdiv-"+this.id);this.errorHandler=new v.default(this);this.initialZoomLimit=[0,0];this.selectTool=new L.default(this);var s=document.body;s.addEventListener("touchstart",this.closeLingeringToolTips);e.on("click",function(e){e.target&&a.default(e.target).closest(".cell-content").focus()}.bind(this));this.removeSelectionStateListener=function(){};this.addSelectionStateListener();i.default.registerMapChart(this);this.tools={scaleBar:new idevio.map.ScaleBar,panTool:y.default.patch(new idevio.map.PanTool({allowShift:true}),this,{viewOption:"navigation",isOff:function(){return o.extensionObject.options.interactionState===D.default.ANALYSIS&&!o.extensionObject.isOn()}}),zoomTool:y.default.patch(new idevio.map.ZoomTool,this,{states:[D.default.ANALYSIS,D.default.EDIT],viewOption:"navigation"})};var l={div:this.mapDiv[0],baseMap:g.default.getBaseMapOrEmpty(this.layout.mapSettings.projection),tools:[this.tools.panTool,this.tools.zoomTool],center:[30,0],zoomLevel:3};var u=this.layout.snapshotData;var d=u&&u.viewFocus&&u.viewFocus.bounds;if(this.extensionObject.backendApi.isSnapshot&&d)l.viewBounds=d;else if(this.extensionObject.options.viewState)l.viewBounds=this.extensionObject.options.viewState.bounds;else if(!this.layout.autoZoomOnSelection)if(window.mapChartViewBounds[this.id]){l.center=window.mapChartViewBounds[this.id].center;l.resolution=window.mapChartViewBounds[this.id].resolution}else this.layout.mapSettings.initialView?this.setInitialViewOnce=true:this.autoZoomOnce=true;this.map=new idevio.map.WebMap(l);this.sidebar=new n.default(this);this.tools.debugLayer=new idevio.map.WebMapInfoLayer(this.map,{x:40,y:5,color:"red",font:"12px monospace",name:"Debug Info",drawOrder:9999,loading:false,interacting:false,ratio:false,visible:false});0===l.baseMap.indexOf("empty")&&this.map.setStyle({background:idevio.map.IconFactory.cross?"transparent":"white"});this.updateCrs();g.default.setLanguage(this.layout.mapSettings.mapLanguage,this.map);this.initialZoomLimit=[this.map.getMinResolution(),this.map.getMaxResolution()];this.selectTool.connectTo(this.map);this.zoomPanTool=new f.default(this);this.chartScale=1;this.mapHomeBounds=this.map.getGeoBounds();this.updateChartScale();this.map.repaint();this.listenerIds.push(this.map.addListener("idle",function(){o.sidebar.handleLegendsDimStatus()}))}e.prototype.updateCrs=function(){var e=g.default.getBaseMapOrEmpty(this.layout.mapSettings.projection);this.crs="emptymeters"===e?"UndefinedMeters":"EPSG:4326"};e.prototype.addSelectionStateListener=function(){var e=this;var t=s.default.currApp();if(t){var a=t.selectionState();var i=function(){e.dataChanged=true};a.OnData.bind(i);this.removeSelectionStateListener=function(){a.OnData.unbind(i)}}else this.dataChanged=true};e.prototype.updateSettings=function(){var t=this;var a=g.default.getBaseMapOrEmpty(this.layout.mapSettings.projection);if(this.map.getBaseMap()!==a){var i=this.map.getCenter();var r=this.map.getResolution();this.map.setBaseMap(a);0===a.indexOf("empty")&&this.map.setStyle({background:idevio.map.IconFactory.cross?"transparent":"white"});this.updateCrs();g.default.setLanguage(this.layout.mapSettings.mapLanguage,this.map);var o=this.layout.mapSettings.zoomLimitSwitch;var n=this.layout.mapSettings.zoomLimit.range,s=n[0],l=n[1];this.initialZoomLimit=[this.map.getZoomLevelResolution(o?l:e.ZOOM_LIMIT_MAX),this.map.getZoomLevelResolution(o?s:e.ZOOM_LIMIT_MIN)];this.map.setCenter(i);this.map.setResolution(r);setTimeout(function(){return t.extensionObject.backendApi.model.Invalidated.emit()})}if(this.map.setViewBounds&&this.layout.mapSettings.panLimitSwitch){var u=null;if(this.layout.mapSettings.panLimits)try{u=JSON.parse(this.layout.mapSettings.panLimits)}catch(e){}this.map.setViewBounds(u)}else{var u=null;this.map.setViewBounds(u)}if(this.map.setMinResolution)if(this.layout.mapSettings.zoomLimitSwitch){var d=this.layout.mapSettings.zoomLimit.range,s=d[0],l=d[1];this.map.setMinResolution(this.map.getZoomLevelResolution(l));this.map.setMaxResolution(this.map.getZoomLevelResolution(s))}else{this.map.setMinResolution(this.initialZoomLimit[0]);this.map.setMaxResolution(this.initialZoomLimit[1])}this.tools.scaleBar._useImperial=this.layout.mapSettings.useImperialUnits;this.layout.mapSettings.showScaleBar?this.tools.scaleBar.connectTo(this.map):this.tools.scaleBar.disconnect();this.setStoredBounds();this.tools.debugLayer.setVisible(this.layout.mapSettings.showDebugInfo);this.zoomPanTool.update();this.parentDiv.toggleClass("no-navigation",false===this.extensionObject.options.navigation)};e.prototype.setStoredBounds=function(){this.extensionObject.backendApi.isSnapshot?this.setSnapshotBounds():this.extensionObject.options.viewState&&this.setViewStateBounds()};e.prototype.setSnapshotBounds=function(){var e=this.layout.snapshotData;var t=e&&e.viewFocus&&e.viewFocus.bounds;var a=true;this.viewBounds(void 0,t,a)};e.prototype.setViewStateBounds=function(){var e=this.extensionObject.options.viewState;var t=e.bounds;var a=true;this.viewBounds(void 0,t,a)};e.prototype.updateData=function(e){var t=this;this.layout=e;this.errorHandler.clearErrors();var a=[];this.limitedData=false;for(var r=0;r<e.gaLayers.length;r++){var o=e.gaLayers[r];var n=e.qUndoExclude.gaLayers[r]||o;var s=o.cId||"unknown";var f=o.type;a.push(s);var y=this.findLayer(s);if(!y)if(i.default.validLayerType(f))switch(f){case"AreaLayer":y=new p.default(this,o,s,n);this.addLayer(y);break;case"ChartLayer":y=new u.default(this,o,s,n);this.addLayer(y);break;case"PointLayer":y=new l.default(this,o,s,n);this.addLayer(y);break;case"GeodataLayer":y=new d.default(this,o,s,n,r);this.addLayer(y);break;case"LineLayer":y=new c.default(this,o,s,n);this.addLayer(y);break;case"DensityLayer":y=new h.default(this,o,s,n);this.addLayer(y);break;default:break}else{y=new m.default(this,o,s,n);this.addLayer(y)}if(y){y.layout=o;y.excludeLayout=n;y instanceof q.default&&(y.hyperCubeLayout=n.qHyperCube);y instanceof u.default&&(y.locationCubeLayout=n.locCube.qHyperCube)}}this.layers.forEach(function(e){-1===a.indexOf(e.id)&&t.removeLayer(e)});var v={};this.layers.forEach(function(e){return v[e.id]=e});this.layers=this.layout.gaLayers.map(function(e,t){var a=v[e.cId];a.setIndex(t);return a});this.updateSettings();this.sidebar.setAlignment(this.mapDiv,this.layout.mapSettings.sidebarAlignment,this.layout.mapSettings.showLegend,this.mapHasFailingCalcCond());this.errorHandler.setMapReady(true);return b.default.all(this.layers.map(function(e){return e.updateData()}))};e.prototype.mapHasFailingCalcCond=function(){for(var e in this.layers){var t=this.layers[e];if(t.layout.qHyperCube.qError){var a=t.layout.qHyperCube.qError.qErrorCode;if(t.map.errorHandler.hasCalcConditionFailed(a))return true}}return false};e.prototype.paint=function(){var e=this;var t=this.registerDeferreds();this.layers.forEach(function(e){return e.paint()});this.parentDiv.hasClass("qv-mapchart-rendered")||t.promise.then(function(){e.parentDiv.addClass("qv-mapchart-rendered")});return t.promise};e.prototype.findLayer=function(e){return this.layers.filter(function(t){return t.id===e})[0]};e.prototype.registerDeferreds=function(){var e=this;var t=new b.default;var a=this.layers.map(function(e){e.deferred=new b.default;return e.deferred.promise});var i=function(){e.zoomPanTool.watch();e.extensionObject.options.viewState&&e.setSidebarScrollOffset();t.resolve()};this.extensionObject.backendApi.isSnapshot&&setTimeout(function(){t.resolve()},8e3);a.length>0?b.default.all(a).then(function(){b.default.all([e.finished(),e.sidebar.draw()]).then(i)}):b.default.all([this.sidebar.draw(),this.waitForEvent("idle")]).then(i);return t};e.prototype.setSidebarScrollOffset=function(){var e=this.extensionObject.options.viewState.sidebarScrollOffset;var t=this.sidebar.element[0].children;for(var i=0;i<t.length;i++){var r=t[i];a.default(r).css("right",e.left+"px");a.default(r).css("bottom",e.top+"px")}};e.prototype.waitForEvent=function(e){var t=new b.default;var a=this.map.addListener(e,function(e){e.source.removeListener(a);t.resolve(e)});return t.promise};e.prototype.finished=function(){if(this.dataChanged&&(this.layout.autoZoomOnSelection||this.autoZoomOnce)){this.autoZoomOnce=false;this.dataChanged=false;return this.viewBounds(true)}if(this.setInitialViewOnce){var e=this.layout.mapSettings.initialView.bounds;this.setInitialViewOnce=false;return this.viewBounds(false,e,true)}return this.waitForEvent("idle")};e.prototype.viewBounds=function(e,t,a){var i=this;t=t||this.getViewBounds();var r=new b.default;if(t){var o=Boolean(this.extensionObject.backendApi.isSnapshot)||Boolean(a);var n=function(){i.mapHomeBounds=t;i.zoomPanTool.hide();new C(i.map).promise.then(function(){return r.resolve()});i.map.viewGeoBounds(t,o)};e?setTimeout(n,0):n();return r.promise}return this.waitForEvent("idle")};e.prototype.getViewBounds=function(){if(this.extensionObject.backendApi.isSnapshot){var e=this.layout.snapshotData;var t=e&&e.viewFocus&&e.viewFocus.bounds;if(t)return t}else if(this.extensionObject.options.viewState){var a=this.extensionObject.options.viewState.bounds;return a}var i=this.mergeBounds();if(i){var o=this.map.getWrapLongitude();if(1.1*r.default.getBoundsWidth(i)>=2*o){var n=(i.min[1]+i.max[1])/2;i={min:[.91*i.min[0],.91*(n-o)],max:[.91*i.max[0],.91*(n+o)]}}}return i};e.prototype.hasSelectableLayers=function(){var e=false;for(var t=0;t<this.layers.length;t++){var a=this.layers[t];if(a.IS_SELECTABLE&&a.hasFeatures()){e=true;break}}return e};e.prototype.hasFeatures=function(){var e=false;for(var t=0;t<this.layers.length;t++)if(this.layers[t].hasFeatures()){e=true;break}return e};e.prototype.setAttribution=function(e,t){this.attributions[e]=t;this.updateAttribution()};e.prototype.updateAttribution=function(){var e=this;var t=Object.keys(this.attributions).map(function(t){return e.attributions[t]}).filter(Boolean);this.map.setAttribution(t.length?t.reduce(function(e,t){return e+", "+t}):null)};e.prototype.mergeBounds=function(){return r.default.mergeBoundsArray(this.layers.map(function(e){return e.getBounds()}),this.map.getWrapLongitude())};e.prototype.updateChartScale=function(){if(this.extensionObject.backendApi.isSnapshot&&!this.extensionObject.options.freeResize){var e=this.layout.snapshotData.object.size.w;var t=this.parentDiv[0].clientWidth;var a=this.layout.snapshotData.object.size.h;var i=this.parentDiv[0].clientHeight;this.chartScale=Math.min(t/e,i/a)}else this.chartScale=1};e.prototype.onResize=function(){var e=this;setTimeout(function(){return e.zoomPanTool.watch()});this.updateChartScale();if(this.map){this.extensionObject.backendApi.isSnapshot&&this.viewBounds();this.map.repaint();this.waitForEvent("idle").then(function(t){setTimeout(function(){var t=a.default(e.map.getDiv());var i=a.default(".idevio-map-canvas",t);t.width()===i.width()&&t.height()===i.height()||e.map.repaint()},750)})}if(this.sidebar){this.sidebar.setAlignment(this.mapDiv,this.layout.mapSettings.sidebarAlignment,this.layout.mapSettings.showLegend,this.mapHasFailingCalcCond());this.sidebar.draw()}this.dataChanged&&this.paint()};e.prototype.onStateChange=function(){this.sidebar.draw();this.zoomPanTool.update();this.errorHandler.onStateChange()};e.prototype.addLayer=function(e){-1===this.layers.indexOf(e)&&this.layers.push(e)};e.prototype.removeLayer=function(e){var t=this.layers.indexOf(e);if(-1!==t){this.layers.splice(t,1);e.remove()}delete this.attributions[e.id];this.updateAttribution()};e.prototype.addError=function(e,t,a){this.errorHandler&&this.errorHandler.handleError(v.default.createErrorEvent(e,t,a));if(e===M.default.LIMITED_DATA){this.limitedData=true;this.limitedLayout=t.layout}};e.prototype.handleqError=function(e,t){this.errorHandler&&this.errorHandler.handleqError(e,t)};e.prototype.isLimitedData=function(){return this.limitedData};e.prototype.getLimitedLayout=function(){return this.limitedLayout};e.prototype.destroy=function(){var e=this;this.selectTool.destroy();this.removeSelectionStateListener();var t=document.body;t.removeEventListener("touchstart",this.closeLingeringToolTips);this.layers.forEach(function(e){e.remove()});this.listenerIds.forEach(function(t){try{e.map.removeListener(t)}catch(e){}});i.default.unregisterMapChart(this);this.map.destroy()};e.ZOOM_LIMIT_MAX=20;e.ZOOM_LIMIT_MIN=0;return e}();t.default=S}.apply(t,i),void 0!==r&&(e.exports=r))},1755:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1056),a(1056),a(89)],r=function(e,t,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);r=n(r);var s=function(e){o(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.components=[];t.currentMode=i.Mode.Full;return t}t.prototype.addComponent=function(e){this.components.push(e)};t.prototype.getVisibleComponents=function(e){return this.components.filter(function(t){var a=t.isVisible(e);a?t.show():t.hide();return a})};t.prototype.preDraw=function(){this.components.forEach(function(e){return e.preDraw()})};t.prototype.getHeight=function(){var e=this;return this.components.reduce(function(t,a){return t+(a.isVisible(e.currentMode)?a.getHeight():0)},0)};t.prototype.draw=function(e){var t=this;var a=new r.default;var i=this.getVisibleComponents(this.currentMode);this.drawComponents(i,e).then(function(i){if(0===i.length){t.wantsToExpand=false;a.resolve(t)}else t.drawComponents(i,e).then(function(r){var o=i.length===r.length;if(0===r.length||o){t.wantsToExpand=o;a.resolve(t)}else t.drawComponents(r,e).then(function(e){t.wantsToExpand=e.length>0;a.resolve(t)})})});return a.promise};t.prototype.drawComponents=function(e,t){var a=new r.default;r.default.all(e.map(function(e){return e.draw(t)})).then(function(e){a.resolve(e.filter(function(e){return e.wantsToExpand}))});return a.promise};t.prototype.remove=function(){e.prototype.remove.call(this);this.components.forEach(function(e){return e.remove()});this.components=[]};return t}(a.default);t.default=s}.apply(t,i),void 0!==r&&(e.exports=r))},1756:function(e,t,a){(function(i){var r,o;var n=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(r=[a,t,a(512),a(164),a(1599),a(2157),a(90),a(201)],o=function(e,t,a,r,o,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=s(a);r=s(r);o=s(o);l=s(l);u=s(u);d=s(d);var p=[a.default.MEASURE,a.default.DIMENSION,a.default.QUALITATIVE,"density"];function c(e){return-1!==p.indexOf(e)}var h=function(e){n(t,e);function t(t,a,i){var o=e.call(this,t,a,i,"color.value")||this;o.isHorizontal=false;o.colorInfo=o.layer.getColorLegendInfo();if(i){o.element.on("mousewheel DOMMouseScroll",function(e){var t=a.map.extensionObject;var i=o.picasso.component("cat-legend");if(i&&t.inAnalysisState()&&false!==t.options.navigation){var n=e.originalEvent;i.emit(r.default.getMouseWheelData(e.originalEvent).delta>0?"prev":"next");n.preventDefault()}});o.element.on("touchstart",function(e){e.preventDefault()})}return o}t.prototype.preDraw=function(){this.element.css({maxHeight:"auto",minWidth:"auto"});this.element.width("auto").height("auto");this.colorInfo=this.layer.getColorLegendInfo()};t.prototype.isValid=function(){if(!c(this.colorInfo.colorMode)||!this.colorInfo.valid)return false;if("density"!==this.colorInfo.colorMode){var e=this.colorInfo.path;return Boolean(e&&u.default.getValue(this.layer.excludeLayout.qHyperCube,e.replace(/\//g,".")))}return true};t.prototype.isVisible=function(t){return e.prototype.isVisible.call(this,t)&&this.isValid()};t.prototype.build=function(e,t){var a=this;this.isHorizontal=t;var i=this.getScale();this.element.css({minWidth:t?250*i+"px":"auto",minHeight:t?"auto":250*i+"px"});if("density"===this.colorInfo.colorMode){this.addTitle(e,t);l.default.addDensityLegend(e,{colorInfo:this.colorInfo,isHorizontal:t,rtl:this.isRtl()})}else{var r={canInteract:function(){return a.isInteractable()},colorInfo:this.colorInfo,isHorizontal:t,layer:this.layer,rtl:this.isRtl(),selectionHandler:this.selectionHandler};if(this.colorInfo.discrete)l.default.addCategoricalLegend(e,r);else{this.addTitle(e,t);l.default.addSequentialLegend(e,r)}}};t.prototype.addTitle=function(e,t){var a=this;if(t){this.element.css({marginTop:5*this.getScale()+"px"});e.addComponent("text",{key:"size-label",displayOrder:1,text:function(){return a.colorInfo.title},dock:"top",settings:{paddingStart:5,paddingEnd:0,paddingLeft:5,paddingRight:0,anchor:this.isRtl()?"right":"left",maxLengthPx:t?250:150},style:{text:{fontSize:d.default.getFontSize("mapChart","legend.title","fontSize"),fontFamily:"QlikView Sans",fill:d.default.getStyle("mapChart","legend.title","color")}}})}};t.prototype.updateData=function(){if("density"===this.colorInfo.colorMode)return;if(!this.isValid())try{this.updatePicasso({settings:{components:[]}})}catch(e){}e.prototype.updateData.call(this)};t.prototype.getHeight=function(){var e=this.getScale();var t=0;this.element.children("svg").each(function(a,r){var o=i(r);var n=r.getBBox();var s=n.height+5*e;t+=s;o.height(s)});var a=this.element.children(":not(svg)");a.each(function(e,a){t+=a.clientHeight});return Math.ceil(t)};t.prototype.fitWidth=function(){var e=this.getScale();var t=0;this.element.children("svg").each(function(a,i){var r=i.getBBox();t+=r.width+5*e});this.element.width(t+10*e)};t.prototype.getMinHeight=function(){var e="density"===this.colorInfo.colorMode||!this.colorInfo.discrete;return e?50:90};t.prototype.onUpdate=function(){var e=this.getScale();if(this.colorInfo.discrete){this.element.width("auto").height("auto");var t=this.getHeight();this.wantsToExpand=this.element.find("button[data-action=next]").length>0||t>(this.element.height()||0);if(this.wantsToExpand)this.element.css({flex:"1 0 auto"});else if(this.isHorizontal){this.fitWidth();this.element.css({flex:"0 0 auto"})}else{this.element.height(t+10*e);this.element.css({flex:"0 0 auto",minHeight:t})}var a=this.element.find("button[data-component-key=cat-legend]").parent().parent();var i={transform:1===e?"":"scale("+e+")"};if(!this.isHorizontal){i.left=0;i.width="100%"}var r=parseInt(this.element.children("svg").first().css("top"),10);this.isHorizontal&&r>8*e?this.element.css("margin-top",8*e-r+"px"):this.element.css("margin-top","unset");a.css(i)}else{var o=this.element.children("svg");if(!o.length)return;var n=o[0].getBBox();if(this.isHorizontal){var s=n.width+10*e;this.element.width(s);this.element.height("auto");this.wantsToExpand=s<250*e;this.isRtl()&&this.element.find("canvas").css({left:"unset",right:"0px"})}else{var t=n.height+10*e;this.element.height(t);this.element.width("auto");this.wantsToExpand=t<250*e}this.element.css({maxHeight:300*e+"px",flex:"0 0 auto"})}};t.prototype.getLegendScrollOffset=function(){var e=this.picasso.component("cat-legend");if(e&&e._DO_NOT_USE_getInfo)return e._DO_NOT_USE_getInfo().offset;return 0};return t}(o.default);t.default=h}.apply(t,r),void 0!==o&&(e.exports=o))}).call(this,a(11))},1757:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(507),a(90),a(125)],r=function(e,t,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);var n;(function(e){var t={country:"country",admin1:"admin1",admin2:"admin2"};var o={country:"location2.country",admin1:"location2.admin1",admin2:"location2.admin2"};function n(e){switch(e.type){case"AreaLayer":return s(e);case"PointLayer":return l(e);case"LineLayer":return u(e);case"DensityLayer":return d(e);case"ChartLayer":return p(e);default:break}}e.generateHyperCube=n;function s(e){var r=i.default.extend(true,{},e.qHyperCubeDef);r.qInitialDataFetch[0]={qWidth:r.qDimensions.length,qHeight:1e3};var o=void 0;if(r.qDimensions.length>0){o=h(e,r);m(e.locationNamesAuto,e,r,t);e.label.show&&a.default.addExpr("label",e.label.expression,r)}var n={qHyperCubeDef:r,color:e.color,useDimLoc1:o};return n}function l(e){var t=i.default.extend(true,{},e.qHyperCubeDef);t.qInitialDataFetch[0]={qWidth:t.qDimensions.length,qHeight:1e3};var r=void 0;if(t.qDimensions.length>0){r=h(e,t);f(e,t);a.default.addExpr("size",e.size.expression,t,true);e.label.show&&a.default.addExpr("label",e.label.expression,t)}var o={qHyperCubeDef:t,color:e.color,useDimLoc1:r};return o}function u(e){var r=i.default.extend(true,{},e.qHyperCubeDef);r.qInitialDataFetch[0]={qWidth:r.qDimensions.length,qHeight:1e3};var n=void 0;var s=void 0;if(r.qDimensions.length>0&&e.path){if(e.path.startEndPoint){n=h(e,r);e.location2.locationOrLatitude.key===r.qDimensions[0].qLibraryId||c(e.location2.locationOrLatitude.key,r.qDimensions[0].qDef.qFieldDefs[0])||1!==r.qDimensions.length&&(e.location2.locationOrLatitude.key===r.qDimensions[1].qLibraryId||c(e.location2.locationOrLatitude.key,r.qDimensions[1].qDef.qFieldDefs[0]))?s=c(e.location2.locationOrLatitude.key,r.qDimensions[0].qDef.qFieldDefs[0])||e.location2.locationOrLatitude.key===r.qDimensions[0].qLibraryId?0:1:a.default.addExpr("location2.locationOrLatitude",e.location2.locationOrLatitude,r,false,0);e.isLatLong?e.longitude&&a.default.addExpr("longitude",e.longitude,r):m(e.locationNamesAuto,e,r,t);e.location2.isLatLong?r.qDimensions[1]&&e.location2.longitude?a.default.addExpr("location2.longitude",e.location2.longitude,r,false,1):e.location2.longitude&&a.default.addExpr("location2.longitude",e.location2.longitude,r,false,0):r.qDimensions[1]?m(e.location2.locationNamesAuto,e,r,o,1):m(e.location2.locationNamesAuto,e,r,o,0)}else e.path.field.key===r.qDimensions[0].qLibraryId||c(e.path.field.key,r.qDimensions[0].qDef.qFieldDefs[0])||a.default.addExpr("path",e.path.field,r,false,0);a.default.addExpr("size",e.size.expression,r,true);e.label.show&&a.default.addExpr("label",e.label.expression,r)}var l={qHyperCubeDef:r,color:e.color,useDimLoc1:n,useDimLoc2:s};return l}function d(e){var t=i.default.extend(true,{},e.qHyperCubeDef);t.qInitialDataFetch[0]={qWidth:t.qDimensions.length,qHeight:1e3};var r=void 0;if(t.qDimensions.length>0){r=h(e,t);f(e,t);a.default.addExpr("weight",e.weightRadius.expression,t,true)}var o={qHyperCubeDef:t,color:e.color,useDimLoc1:r};return o}function p(e){var t=i.default.extend(true,{},e.qHyperCubeDef);t.qInitialDataFetch[0]={qWidth:t.qDimensions.length+t.qMeasures.length,qHeight:1e3};var o={};var n=void 0;if(t.qDimensions.length>1){var s=i.default.extend(true,{},t);s.qDimensions.splice(1,1);r.default.indexRemoved(s.qInterColumnSortOrder,1);n=h(e,s);f(e,s);a.default.addExpr("size",e.size.expression,s,true);e.label.show&&a.default.addExpr("label",e.label.expression,s);o=s;if(e.color.auto&&t.qDimensions[1].qDef&&null!==t.qDimensions[1].qDef){var l=t.qDimensions[1];var u=l.qLibraryId?l.qLibraryId:l.qDef.qFieldDefs[0];var d=l.qLibraryId?l.qLibraryId:l.qDef.qFieldLabels[0];var p=void 0;p=l.qLibraryId?{id:"colorByAlternative",colorMapRef:u,qLibraryId:u}:{id:"colorByAlternative",label:d,qDef:u};t.qDimensions[1].qAttributeDimensions.push(p)}}var c={qHyperCubeDef:t,locCube:{qHyperCubeDef:o},color:e.color,useDimLoc1:n};return c}function c(e,t){if(e===t)return true;if(e.length>1&&"="===e.charAt(0)){e=e.substring(1);if(e===t)return true}if(e.length>2&&"["===e.charAt(0)&&"]"===e.charAt(e.length-1)&&e.substring(1,e.length-1)===t)return true;return false}e.exprAndFieldEquals=c;function h(e,t){var i=void 0;if(e.locationOrLatitude.key===t.qDimensions[0].qLibraryId||c(e.locationOrLatitude.key,t.qDimensions[0].qDef.qFieldDefs[0])||1!==t.qDimensions.length&&(e.locationOrLatitude.key===t.qDimensions[1].qLibraryId||c(e.locationOrLatitude.key,t.qDimensions[1].qDef.qFieldDefs[0]))){i=c(e.locationOrLatitude.key,t.qDimensions[0].qDef.qFieldDefs[0])||e.locationOrLatitude.key===t.qDimensions[0].qLibraryId?0:1;t.qDimensions.forEach(function(e){e.qAttributeDimensions.forEach(function(e){false!==e.qAttribute&&(e.qAttribute=false)});e.qAttributeExpressions.forEach(function(e){false!==e.qAttribute&&(e.qAttribute=false)})})}else a.default.addExpr("locationOrLatitude",e.locationOrLatitude,t);return i}function f(e,i){e.isLatLong?e.longitude&&a.default.addExpr("longitude",e.longitude,i):m(e.locationNamesAuto,e,i,t)}function m(e,t,i,r,o){var n=r.country.indexOf("location2")>-1&&t.location2?t.location2:t;if(!e){a.default.addExpr(r.country,n.locationCountry,i,false,o);if((n.locationCountry.key||"").trim().length>0){a.default.addExpr(r.admin1,n.locationAdmin1,i,false,o);(n.locationAdmin1.key||"").trim().length>0&&a.default.addExpr(r.admin2,n.locationAdmin2,i,false,o)}}}})(n||(n={}));t.default=n}.apply(t,i),void 0!==r&&(e.exports=r))},1758:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();!(i=[a,t,a(89)],r=function(e,t,a){"use strict";var i=function(e){o(t,e);function t(t){var i=e.call(this)||this;i.viewchanged=false;i.deferred=new a;i.promise=i.deferred.promise;i.connectTo(t);return i}t.prototype._connecting=function(){var e=this;this._addListener("viewchanged",function(t){return e.viewchanged=true});this._addListener("idle",function(t){if(e.viewchanged){e.deferred.resolve();e.disconnect()}})};return t}(idevio.map.Tool);return i}.apply(t,i),void 0!==r&&(e.exports=r))},1759:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11)],r=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);var i=function(){function e(e){this.mapChart=e;this.div=e.mapDiv[0];this.isActive=false;this.startY=void 0;this.startX=void 0;this.rectangle={min:[0,0],max:[0,0]}}e.prototype.activate=function(){this.canvas=this.createCanvas();this.rectangle={min:[0,0],max:[this.div.clientWidth,this.div.clientHeight]};this.isActive=true;this.start()};e.prototype.deactivate=function(){this.isActive=false;a.default("#"+e.CANVAS_ID).remove();delete this.startX;delete this.startY;this.stop()};e.prototype.release=function(){this.doneDrawing();this.deactivate()};e.prototype.move=function(e,t){void 0===this.startX&&(this.startX=e);void 0===this.startY&&(this.startY=t);this.draw(e,t)};e.prototype.createCanvas=function(){a.default("#"+e.CANVAS_ID).remove();var t=document.createElement("canvas");var i=this.div;t.id=e.CANVAS_ID;t.width=i.clientWidth;t.height=i.clientHeight;t.style.zIndex="10000";t.style.position="absolute";t.style.border="0px";t.style.top="0px";t.style.left="0px";t.style.pointerEvents="none";a.default(i).append(t);return t};e.CANVAS_ID="CANVAS_ID";return e}();t.default=i}.apply(t,i),void 0!==r&&(e.exports=r))},1760:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(879),a(91),a(483),a(431)],r=function(e,t,a,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);var s=function(){function e(){}e.migrateProperties=function(t){if(t.gaVersion===e.VERSION)return t;if(!t.layers)return t;t.gaVersion=e.VERSION;t.gaLayers=[];t.mapSettings=e.migrateMapSettings(t);for(var a=0;a<t.layers.length;a++)t.layers[a].qHyperCubeDef&&t.layers[a].qHyperCubeDef.qDimensions[0]&&t.gaLayers.push(e.migrateLayer(t.layers[a],t.color));e.migrateBackground(t);for(var a=0;a<t.gaLayers.length;a++)r.default.colorByUpdater(t,"gaLayers."+a+".qHyperCubeDef.",t.gaLayers[a].color,"gaLayers."+a+".qHyperCubeDef.");t.gaLayers.forEach(function(e){return e.qHyperCubeDef.qDimensions.forEach(function(e){e.qAttributeDimensions.forEach(function(e){return e.qAttribute=false});e.qAttributeExpressions.forEach(function(e){return e.qAttribute=false})})});return t};e.migratedBasicLayerProperties=function(e,t){var i=a.default.getInitialProperties("point"===e.type?"PointLayer":"AreaLayer");i.cId="MIGRATED";i.showLayer=e.show;i.maxObjects=3333;var r=i.color.outline;var o=i.color.opacity;i.color=this.clone(t);i.color.outline=r;i.color.opacity=void 0===e.opacity?o:e.opacity;return i};e.migrateLayer=function(e,t){var i=this.migratedBasicLayerProperties(e,t);if("point"===e.type){i.qHyperCubeDef=this.clone(e.qHyperCubeDef);i.qHyperCubeDef.qMeasures=[];i.qHyperCubeDef.qInterColumnSortOrder=[0];i.qHyperCubeDef.qSuppressZero=false;i.qHyperCubeDef.qDimensions.length>1&&(i.qHyperCubeDef.qDimensions[1].qNullSuppression=true);var r=e.qHyperCubeDef.qDimensions[1].qAttributeExpressions[0]?e.qHyperCubeDef.qDimensions[1].qAttributeExpressions[0].id:null;if({byMeasure:"colorByAlternative",byExpression:"colorByExpression"}[t.mode]===r)i.qHyperCubeDef.qDimensions[0].qAttributeExpressions=this.clone(e.qHyperCubeDef.qDimensions[1].qAttributeExpressions);else if("byMeasure"===t.mode&&!i.color.byMeasureDef&&e.qHyperCubeDef.qMeasures.length>0){var o=e.qHyperCubeDef.qMeasures[0].qLibraryId;if(o)i.color.byMeasureDef={key:e.qHyperCubeDef.qMeasures[0].qLibraryId,label:"",type:"libraryItem"};else{i.color.colorExpression=e.qHyperCubeDef.qMeasures[0].qDef.qDef;i.color.mode="byExpression"}i.color.expressionIsColor=false}else"byDimension"===t.mode&&"colorByAlternative"===(e.qHyperCubeDef.qDimensions[1].qAttributeDimensions[0]?e.qHyperCubeDef.qDimensions[1].qAttributeDimensions[0].id:null)&&(i.qHyperCubeDef.qDimensions[0].qAttributeDimensions=this.clone(e.qHyperCubeDef.qDimensions[1].qAttributeDimensions));this.updateDimensionExpressions(i);var n=i;i.locationOrLatitude=this.dimension2ExpressionProp(e.qHyperCubeDef.qDimensions[1]);if(e.qHyperCubeDef.qMeasures[0]){n.size.expression=this.measure2ExpressionProp(e.qHyperCubeDef.qMeasures[0]);n.size.radiusMin=e.rangeBubbleSizes[0];n.size.radiusMax=e.rangeBubbleSizes[1];n.size.slider=[a.default.getSliderValueFromSize(n.size.radiusMin),a.default.getSliderValueFromSize(n.size.radiusMax)];n.size.autoRadiusValueRange=e.autoMinMax;n.size.radiusValueMin=e.customMin;n.size.radiusValueMax=e.customMax}else{var s=Math.floor(e.bubbleSizes/2);n.size.radiusMin=e.bubbleSizes-s;n.size.radiusMax=e.bubbleSizes+s}}else{i.qHyperCubeDef=this.clone(e.geodata.qHyperCubeDef);i.qHyperCubeDef.qDimensions=[i.qHyperCubeDef.qDimensions[0]];i.qHyperCubeDef.qMeasures=[];i.qHyperCubeDef.qInterColumnSortOrder=[0];i.qHyperCubeDef.qSuppressZero=false;i.qHyperCubeDef.qDimensions[0].qAttributeExpressions=this.clone(e.qHyperCubeDef.qDimensions[0].qAttributeExpressions);i.locationOrLatitude=this.measure2ExpressionProp(e.geodata.qHyperCubeDef.qMeasures[0]);if("byMeasure"===t.mode&&!i.color.byMeasureDef&&e.qHyperCubeDef.qMeasures.length>0){var o=e.qHyperCubeDef.qMeasures[0].qLibraryId;if(o)i.color.byMeasureDef={key:e.qHyperCubeDef.qMeasures[0].qLibraryId,label:"",type:"libraryItem"};else{i.color.colorExpression=e.qHyperCubeDef.qMeasures[0].qDef.qDef;i.color.mode="byExpression"}i.color.expressionIsColor=false}this.updateDimensionExpressions(i)}return i};e.updateDimensionExpressions=function(e){if("byExpression"!==e.color.mode||this.haveItemWithId(e.qHyperCubeDef.qDimensions[0].qAttributeExpressions,"colorByExpression")){if("byMeasure"===e.color.mode&&!this.haveItemWithId(e.qHyperCubeDef.qDimensions[0].qAttributeExpressions,"colorByAlternative")){var t=e.color.byMeasureDef&&"libraryItem"===e.color.byMeasureDef.type;t?e.qHyperCubeDef.qDimensions[0].qAttributeExpressions.push({qLibraryId:e.color.byMeasureDef.key,id:"colorByAlternative"}):e.qHyperCubeDef.qDimensions[0].qAttributeExpressions.push({qExpression:e.color.byMeasureDef.key,id:"colorByAlternative"})}}else e.qHyperCubeDef.qDimensions[0].qAttributeExpressions.push({qExpression:e.color.colorExpression,id:"colorByExpression"})};e.haveItemWithId=function(e,t){for(var a in e)if(e[a].id&&e[a].id===t)return true;return false};e.clone=function(e){return JSON.parse(JSON.stringify(e))};e.dimension2ExpressionProp=function(e){return{key:e.qLibraryId?e.qLibraryId:n.default.bracketStringIfNeeded(e.qDef.qFieldDefs[0]),label:e.qDef.qFieldLabels[0]?e.qDef.qFieldLabels[0]:"",type:e.qLibraryId?"libraryItem":"expression"}};e.measure2ExpressionProp=function(e){return{key:e.qLibraryId?e.qLibraryId:e.qDef.qDef,label:e.qDef.qLabel?e.qDef.qLabel:"",type:e.qLibraryId?"libraryItem":"expression"}};e.migrateMapSettings=function(t){var a={baseMap:"pale",mapLanguage:"auto",panLimits:null,initialView:null,projection:"pale_mercator",selectionType:"lasso",showDebugInfo:false,showScaleBar:false,useImperialUnits:false,showLegend:t.legend.show&&e.showLegend(t),sidebarAlignment:e.showLegend(t)?t.legend.dock:"auto",zoomLimit:{range:[0,20]},zoomLimitSwitch:false,panLimitSwitch:false,_layerType:""};if(!t.background.show||!t.background.defaultMapService){a.baseMap="empty";a.projection="emptydegreemercator"}return a};e.migrateBackground=function(t){if(t.background.show&&!t.background.defaultMapService){var r=a.default.getInitialProperties("GeodataLayer");r.cId="MIGRADED_BG";r.title=i.default.get("geo.GeodataLayer");if(t.background.layers.length>0&&t.background.layers[0].urls.length>0){var o=t.background.layers[0];r.tms={url:o.urls[0],attribution:e.convertAttribution(o.attribution||""),auto:true,tileSize:256,tileWidth:40075016,tileHeight:40075016,originLeft:-20037508,originTop:20037508};t.gaLayers.push(r)}}};e.convertAttribution=function(t){return e.convertLink(e.convertImage(t))};e.convertLink=function(t){var a=t.indexOf("@[");if(a<0)return t;var i=t.indexOf("](",a);if(i<0)return t;var r=t.indexOf(")",i);if(i<0)return t;var o=t.substring(a+2,i);var n=t.substring(i+2,r);return t.substring(0,a)+"<a href='"+n+"' target='_blank'>"+o+"</a>"+e.convertLink(t.substring(r+1))};e.convertImage=function(t){var a=t.indexOf("![");if(a<0)return t;var i=t.indexOf("](",a);if(i<0)return t;var r=t.indexOf(")",i);if(i<0)return t;return t.substring(0,a)+" "+e.convertImage(t.substring(r+1))};e.showLegend=function(e){var t=e.color;var a=!t.auto&&("byDimension"===t.mode||"byMeasure"===t.mode||"byExpression"===t.mode&&!t.expressionIsColor);return a};e.VERSION=2;return e}();t.default=s}.apply(t,i),void 0!==r&&(e.exports=r))},1761:function(e,t){e.exports='<div class="qv-viz">\n    <div class="map-content">\n        <div class="webmap-div" tid="qv-object-mapchart"></div>\n        <div class="map-error-div"><div class="map-error-icon-div lui-fade-button lui-icon lui-icon--info"></div><div class="map-error-content-div"></div></div>\n        <div qva-zoom-pan-navigation style="top : 17px; right : 17px;"></div>\n    </div>\n    <div class="sidebar"></div>\n</div>\n'},2151:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(2152),a(879),a(1115),a(90),a(431),a(91),a(1187),a(101),a(1324),a(13)],r=function(e,t,a,i,r,n,s,l,u,d,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);s=o(s);l=o(l);u=o(u);d=o(d);p=o(p);c=o(c);var h="geo.dropmenu.noName";var f="geo.properties.noLayer";var m="geo.properties.noLayerText";function y(){var e={AreaLayer:{initialProperties:i.default.getInitialProperties(r.default.AREA),definition:{schemaIgnore:true,translation:"geo.AreaLayer",component:"accordion",cacheKey:"AreaLayer",title:function(e,t){var a=e.qHyperCubeDef.qDimensions;return u.default.getDimensionTitle(a,t)||l.default.get(h)},type:"items",items:{general:{show:false},metadata:{show:false},data:i.default.getDataSection(1),location:i.default.getLocationSection(r.default.AREA),color:i.default.getColorSection(r.default.AREA),sorting:{uses:"sorting"},options:i.default.getOptionsSection("AreaLayer")}}}};e["PointLayer"]={initialProperties:i.default.getInitialProperties(r.default.POINT),definition:{schemaIgnore:true,translation:"geo.PointLayer",component:"accordion",cacheKey:"PointLayer",title:function(e,t){var a=e.qHyperCubeDef.qDimensions;return u.default.getDimensionTitle(a,t)||l.default.get(h)},type:"items",items:{general:{show:false},metadata:{show:false},data:i.default.getDataSection(1),location:i.default.getLocationSection(r.default.POINT),size:i.default.getSizeSection(r.default.POINT),color:i.default.getColorSection(r.default.POINT),sorting:{uses:"sorting"},options:i.default.getOptionsSection("PointLayer")}}};e["LineLayer"]={initialProperties:i.default.getInitialProperties(r.default.LINE),definition:{schemaIgnore:true,translation:"geo.LineLayer",component:"accordion",cacheKey:"LineLayer",title:function(e,t){var a=e.qHyperCubeDef.qDimensions;return u.default.getDimensionTitle(a,t)||l.default.get(h)},type:"items",items:{general:{show:false},metadata:{show:false},data:i.default.getDataSection(2),location:i.default.getLocationSection(r.default.LINE),size:i.default.getSizeSection(r.default.LINE),color:i.default.getColorSection(r.default.LINE),sorting:{uses:"sorting"},options:i.default.getOptionsSection("LineLayer")}}};e["DensityLayer"]={initialProperties:i.default.getInitialProperties(r.default.DENSITY),definition:{schemaIgnore:true,translation:"geo.DensityLayer",component:"accordion",cacheKey:"DensityLayer",title:function(e,t){var a=e.qHyperCubeDef.qDimensions;return u.default.getDimensionTitle(a,t)||l.default.get(h)},type:"items",items:{general:{show:false},metadata:{show:false},data:i.default.getDataSection(1),location:i.default.getLocationSection(r.default.DENSITY),size:i.default.getSizeSection(r.default.DENSITY),color:i.default.getDensityColorSection(),sorting:{uses:"sorting"},options:i.default.getOptionsSection("DensityLayer")}}};e["ChartLayer"]={initialProperties:i.default.getInitialProperties(r.default.CHART),definition:{schemaIgnore:true,translation:"geo.ChartLayer",component:"accordion",cacheKey:"ChartLayer",title:function(e,t){var a=e.qHyperCubeDef.qDimensions;return u.default.getDimensionTitle(a,t)||l.default.get(h)},type:"items",items:{general:{show:false},metadata:{show:false},data:i.default.getChartLayerDataSection(),location:i.default.getLocationSection(r.default.CHART),size:i.default.getSizeAndShapeSection(),color:i.default.getColorSection(r.default.CHART),sorting:{uses:"sorting",items:{dimensions:{locked:function(e,t,a){return 0===e}}}},options:i.default.getOptionsSection("ChartLayer")}}};e["GeodataLayer"]={initialProperties:i.default.getInitialProperties(r.default.GEODATA),definition:{schemaIgnore:true,translation:"geo.GeodataLayer",component:"accordion",cacheKey:"GeodataLayer",title:function(e){return""!==e.title?e.title:l.default.get(h)},type:"items",items:{general:{show:false},metadata:{show:false},data:i.default.getGeodataSection(),options:i.default.getOptionsSection("GeodataLayer")}}};return e}var v="gaLayers";var g="items.data.items.data";var b={type:"items",component:"accordion",items:{layers:{translation:"properties.layers",component:"items",globalChange:function(e){for(var t=0;t<e.gaLayers.length;t++)s.default.updateColorDef(e,t)},items:{layers:{component:"layers",ref:v,dataPath:g,addTranslation:"properties.layers.add",noLayersHelpHeader:l.default.get(f),noLayersHelpText:l.default.get(m),showAddButton:false,deleteBtnTranslation:"geo.layer.delete",activePath:function(e){var t=d.default.getValue(e,"data.qHyperCubeDef.qDimensions",[]).length>0;var a=d.default.getValue(e,"data.tms.url","").length>0;return!t&&!a&&"data"},add:function(){console.log("add layer")},remove:function(){console.log("remove layer")},move:function(){console.log("move layer")},layers:y()},addLayer:{ref:"mapSettings._layerType",type:"string",defaultValue:"",component:"options-list",translation:"properties.layers.add",change:function(e,t,a){var i=e.mapSettings._layerType;if(i&&i.length){var r=y()[i];var o=r.initialProperties;o.cId=n.default.generateId();e.mapSettings._layerType="";s.default.insertLayer(o,e.gaLayers)}},title:"properties.layers.add",optionsLabel:"geo.properties.addOptions",optionsRadius:3,optionsSpacing:12,optionsBoldSelect:true,options:function(){var e={PointLayer:c.default.staticResourcesPath+"extensions/qliktech/mapchart/img/layer_point.png",AreaLayer:c.default.staticResourcesPath+"extensions/qliktech/mapchart/img/layer_area.png",ChartLayer:c.default.staticResourcesPath+"extensions/qliktech/mapchart/img/layer_chart.png",LineLayer:c.default.staticResourcesPath+"extensions/qliktech/mapchart/img/layer_line.png",DensityLayer:c.default.staticResourcesPath+"extensions/qliktech/mapchart/img/layer_heatmap.png",GeodataLayer:c.default.staticResourcesPath+"extensions/qliktech/mapchart/img/bg_default.png"};var t=y();var a=Object.keys(t).map(function(a){var i=t[a];i.type=a;return{src:e[a],translation:i.definition.translation,value:a}});return a}}}},mapsettings:a.default.getMapSettings(),settings:a.default.getSettings()}};t.default={properties:b,applyMapConfig:function(e){var t=idevio.Connection.mapChart||{};if(t.defaultMap){var a=t.defaultMap;if(/^(https?:)?\/\//.test(a)){var r=i.default.getInitialProperties("GeodataLayer");r.tms.url=a;t.defaultAttribution&&(r.tms.attribution=t.defaultAttribution);r.cId="DEFAULT_BG";r.title=l.default.get("geo.GeodataLayer");e.gaLayers.push(r);a="emptydegreemercator"}var o=p.default.parseMapName(a).name;e.mapSettings=e.mapSettings||{};e.mapSettings.baseMap=o;e.mapSettings.projection=a}return e}}}.apply(t,i),void 0!==r&&(e.exports=r))},2152:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1754),a(431),a(1324),a(91)],r=function(e,t,a,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);var s;(function(e){function t(e){var t=i.default.getMapChart(e.qInfo.qId);if(null==t)throw new TypeError("Map with id '"+e.qInfo.qId+"' was not found");return t}function o(){var e={type:"items",items:{basemap:{ref:"mapSettings.baseMap",type:"string",component:"options-list",translation:"geo.properties.basemap",defaultValue:"default",change:function(e){e.mapSettings.projection=r.default.getDefaultProjection(e.mapSettings.baseMap,e.mapSettings.projection);e.mapSettings.mapLanguage="auto"},labelDisclaimer:"",showValue:true,valueTranslation:"geo.properties.basemap",entryComponentDefinition:{type:"string",component:"image-item",itemBorder:true,itemInteractive:true,width:"229px",height:"103px"},title:"geo.properties.basemap",optionsLabel:"geo.properties.basemapOptions",optionsRadius:3,optionsSpacing:12,options:r.default.getBasemapOptions},projection:{ref:"mapSettings.projection",translation:"geo.properties.projection",type:"string",component:"dropdown",defaultValue:"default",change:function(e){var a=t(e).map;r.default.setLanguage(e.mapSettings.mapLanguage,a)},options:r.default.getAvailableBaseMapAndProjections},maplanguage:{ref:"mapSettings.mapLanguage",translation:"geo.properties.maplanguage",type:"string",component:"dropdown",defaultValue:"auto",change:function(e){var a=t(e);r.default.setLanguage(e.mapSettings.mapLanguage,a.map)},options:function(e){try{var a=t(e);return r.default.getAvailableLanguages(a.map)}catch(e){return r.default.getDefaultAvailableLanguages()}}},useImperialUnits:{ref:"mapSettings.useImperialUnits",translation:"geo.properties.units",type:"boolean",component:"dropdown",defaultValue:false,options:[{value:false,translation:"geo.properties.metric"},{value:true,translation:"geo.properties.imperial"}]}}};var a={ref:"mapSettings.selectionType",translation:"geo.properties.selectiontype",type:"string",component:"dropdown",defaultValue:"lasso",options:[{value:"lasso",translation:"geo.properties.lassoselection"},{value:"circle",translation:"geo.properties.circleselection"},{value:"none",translation:"Common.None"}]};var i={type:"items",items:{zoomtoselection:{ref:"autoZoomOnSelection",translation:"geo.properties.autoZoom",type:"boolean",defaultValue:true},setinitialview:{ref:"mapSettings.initialView",component:"button",label:function(e){return e.mapSettings.initialView?n.default.get("geo.properties.initialview.clear"):n.default.get("geo.properties.initialview.set")},show:function(e){return!e.autoZoomOnSelection},action:function(e){var a=t(e);var i=a.map.getGeoBounds();var r=a.map.getCenter();var o=a.map.getResolution();var n;n=e.mapSettings.initialView?null:{center:r,resolution:o,bounds:i};var s=a.extensionObject.backendApi;s.model.getProperties().then(function(e){e.mapSettings.initialView=n;s.model.setProperties(e)})}}}};return{translation:"geo.properties.mapsettings",type:"items",grouped:true,items:{mapprops:e,selectiontypeprops:a,zoompanprops:i}}}e.getMapSettings=o;function s(){return{uses:"settings",items:{general:{items:{details:{show:false}}},legend:{type:"items",translation:"properties.legend",items:{showLegend:{ref:"mapSettings.showLegend",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:true,options:[{value:true,translation:"Common.Auto"},{value:false,translation:"properties.off"}]},layerPaneAlignment:{ref:"mapSettings.sidebarAlignment",translation:"properties.legend.position",type:"string",show:function(e){return e.mapSettings.showLegend},component:"dropdown",defaultValue:"auto",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"properties.dock.top"},{value:"bottom",translation:"properties.dock.bottom"}]}}},tools:{type:"items",translation:"geo.properties.presentation",grouped:true,items:{navAndScalebar:{type:"items",items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:false,options:[{value:true,translation:"Common.Auto"},{value:false,translation:"properties.off"}]},showscalebar:{ref:"mapSettings.showScaleBar",translation:"geo.properties.showScaleBar",type:"boolean",defaultValue:true}}},zoomlevels:{type:"items",items:{zoomSwitch:{ref:"mapSettings.zoomLimitSwitch",translation:"geo.properties.zoomLimitSwitch",type:"boolean",component:"switch",defaultValue:false,options:[{value:false,translation:"Common.No"},{value:true,translation:"Common.Custom"}]},zoomlimits:{type:"array",component:"slider",ref:"mapSettings.zoomLimit.range",min:a.default.ZOOM_LIMIT_MIN,max:a.default.ZOOM_LIMIT_MAX,step:1,defaultValue:[a.default.ZOOM_LIMIT_MIN,a.default.ZOOM_LIMIT_MAX],label:function(e){var t=Math.abs(e.mapSettings.zoomLimit.range[0]);var i=Math.abs(e.mapSettings.zoomLimit.range[1]);return t===a.default.ZOOM_LIMIT_MIN&&i!==a.default.ZOOM_LIMIT_MAX?n.default.get("geo.properties.zoomRangeMin",[i]):t!==a.default.ZOOM_LIMIT_MIN&&i===a.default.ZOOM_LIMIT_MAX?n.default.get("geo.properties.zoomRangeMax",[t]):t===a.default.ZOOM_LIMIT_MIN&&i===a.default.ZOOM_LIMIT_MAX?n.default.get("geo.properties.zoomRangeMinMax"):n.default.get("geo.properties.zoomRange",[t,i])},show:function(e){return e.mapSettings.zoomLimitSwitch}}}},pan:{type:"items",items:{panSwitch:{ref:"mapSettings.panLimitSwitch",translation:"geo.properties.panLimitSwitch",type:"boolean",component:"switch",defaultValue:false,options:[{value:false,translation:"Common.No"},{value:true,translation:"Common.Custom"}]},panlimits:{ref:"mapSettings.panLimits",label:function(e){return e.mapSettings.panLimits?n.default.get("geo.properties.clearPanLimit"):n.default.get("geo.properties.setPanLimit")},component:"button",action:function(e){var a=t(e);var i=null;i=e.mapSettings.panLimits?null:a.map.getGeoBounds();var r=a.extensionObject.backendApi;r.model.getProperties().then(function(e){e.mapSettings.panLimits=null===i?i:JSON.stringify(i);r.model.setProperties(e)})},show:function(e){return e.mapSettings.panLimitSwitch}}}},debug:{type:"items",items:{showdebuginfo:{ref:"mapSettings.showDebugInfo",translation:"geo.properties.showDebugInfo",type:"boolean",defaultValue:false}}}}}}}}e.getSettings=s})(s||(s={}));t.default=s}.apply(t,i),void 0!==r&&(e.exports=r))},2153:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(89),a(1755),a(1056)],r=function(e,t,a,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);var l="sbHidden sbLeft sbRight sbTop sbBottom sbVertical sbHorizontal";var u=function(e){o(t,e);function t(i){var r=e.call(this,{parent:i.parentDiv,maxMode:s.Mode.None,element:a.default(".sidebar",i.parentDiv)})||this;r.size=t.INITIAL_HEIGHT;r.components=[];r.parent=i.parentDiv;r.mapChart=i;i.mapDiv.find("div:first-child").css({flex:"1",width:"inherit",height:"inherit"});r.setAlignment(i.mapDiv,"auto",false);return r}t.prototype.addComponent=function(t){e.prototype.addComponent.call(this,t)};t.prototype.setAlignment=function(e,a,i,r){this.alignment=a;var o=this.parent.removeClass(l);if(!i&&!r){o.addClass("sbHidden");return}switch(a){case"top":o.addClass("sbTop sbHorizontal");break;case"bottom":o.addClass("sbBottom sbHorizontal");break;case"left":o.addClass("sbLeft sbVertical");break;case"right":o.addClass("sbRight sbVertical");break;case"auto":default:var n=e.parents("article").first();var s=n.width()||0;var u=n.height()||0;s>=u?o.addClass((this.isRtl()?"sbLeft":"sbRight")+" sbVertical"):o.addClass("sbBottom sbHorizontal");break}this.isHorizontal()?this.element.css("max-height",t.HORIZONTAL_HEIGHT):this.element.css("max-height","none")};t.prototype.isHorizontal=function(){return this.parent.hasClass("sbHorizontal")};t.prototype.isRtl=function(){return Boolean("rtl"===this.mapChart.extensionObject.options.direction)};t.prototype.getSize=function(e,a){var i=this;if(e){var r=this.components.filter(function(e){return e.isVisible(i.currentMode)});if(r.some(function(e){return e.isExpanded()}))return t.HORIZONTAL_HEIGHT*a;var o=Math.max.apply(Math,[t.INITIAL_HEIGHT].concat(r.map(function(e){return e.getHeight()})));return Math.min(1.3*o,t.HORIZONTAL_HEIGHT*a)}return t.VERTICAL_WIDTH*a};t.prototype.draw=function(){var a=this;var r=new i.default;this.preDraw();var o=this.isHorizontal();var n=this.mapChart.mapDiv;var s=this.mapChart.chartScale;var l=n.parents("article").first();var u=(l.width()||0)-t.VERTICAL_WIDTH*s;var d=(l.height()||0)-t.HORIZONTAL_HEIGHT*s;var p=this.components.some(function(e){return e.isVisible(a.currentMode)});if(!p||!o&&u<t.MINIMUM_MAP_SIZE||o&&d<t.MINIMUM_MAP_SIZE){this.element.hide();setTimeout(function(){return r.resolve()});return r.promise}if(this.parent.hasClass("sbHidden")){this.mapChart.map.repaint();r.resolve(this);return r.promise}this.element.show();"auto"===this.alignment&&this.setAlignment(n,"auto",true,this.mapChart.mapHasFailingCalcCond());this.size=0|this.getSize(o,s);this.element.css("flex-basis",this.size+"px");this.mapChart.map.repaint();e.prototype.draw.call(this,o).then(function(){return r.resolve(a)});return r.promise};t.prototype.handleLegendsDimStatus=function(){var e=this.mapChart.layers;var t=false;e.forEach(function(e){if(e.legend){var a=e.legend.dimStatus();var i=e.legend.isDimmed;var r=a!==i;r&&(t=true)}});t&&this.draw()};t.VERTICAL_WIDTH=150;t.HORIZONTAL_HEIGHT=130;t.INITIAL_HEIGHT=40;t.MINIMUM_MAP_SIZE=150;return t}(r.default);t.default=u}.apply(t,i),void 0!==r&&(e.exports=r))},2154:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1262),a(1186),a(1322),a(2161),a(1038),a(507),a(1146)],r=function(e,t,a,i,r,s,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);var p=function(e){o(t,e);function t(t,a,o,n){var s=e.call(this,t,a,o,n)||this;s.IS_SELECTABLE=true;s.color="";s.layerName="geo.PointLayer";s.name=o;s.layer=new idevio.map.FeatureLayer(s.map.map,{drawOrder:1001,pickable:true});s.legend=new i.default(s,{showSizeLegend:true});s.toolTip=new r.default(s,t);s.dataset=s.layer.getDataset();s.hardLimit=5e4;s.layout=a;return s}t.prototype.fulfillsRequirements=function(){var e=this.hyperCubeLayout.qDimensionInfo.length>0;return e};t.prototype.doPaint=function(){var e=this.hyperCubeLayout.qDataPages;this.clearData();var t=u.default.getMinMax("size",this.hyperCubeLayout);var i=false===this.layout.size.autoRadiusValueRange?[this.layout.size.radiusValueMin,this.layout.size.radiusValueMax]:t||[0,0];var r=Math.max(1,Math.min(this.layout.size.radiusMax-this.layout.size.radiusMin,50));var o=new s.default(i[0],i[1],r,this.layout.size.radiusMin,this.layout.size.radiusMax,this.colorMap.getOutlineColor(),this.layout.size.shape,0);var n=Math.round((this.layout.size.radiusMin+this.layout.size.radiusMax)/2);var p=2;var c=[];var h="";var f=0;for(var m in e){var y=e[m];if(!y.qMatrix)continue;var v=u.default.getElemData(y,0);var g=this.getColorValues(y);var b=this.getGeometry(y,0,this.hyperCubeLayout);var L=u.default.getNumericData("size",y,this.hyperCubeLayout);var D=u.default.getStringOrNumber("label",y,this.hyperCubeLayout);var M=b.length;"0"===m&&(h=this.makeOrChangeDataset(b,a.default.DEFAULT_COLUMNS.concat(["key","size","labelOffset"]),this.layout.isLatLong,"Point"));switch(h){case"STRINGCOORDS":var C=b;for(var q=0;q<M;q++){if(null==C[q]){f++;continue}try{var S=v[q].id;var x="X"===v[q].state;var I=d.default.parseGeometryString(C[q]);var A=g[q];var _=this.colorMap.getColor(v[q],A.value,f);var O=x||!L.length?n:L[q];var w=D[q];var E=o.calculateSymbolSize(O).size+p;var T=new idevio.map.PointFeature(this.dataset,{coordinate:I,attributes:a.default.generateAttributeObject(S,v[q].dimValue,w,{color:_,value:A.value,elemNo:A.elemNo},x,{key:o.key(O,_),labelOffset:E,size:L.length?O:null})});null!=A.elemNo&&this.colorElemNos.add(A.elemNo);this.featureTable[String(S)]=T}catch(e){this.map.addError(l.default.INVALID_GEOMETRY,this,[C[q]])}f++}break;case"NAMES":var N=this.addLocationSuffix(b,y,this.layout.locationNamesAuto,this.hyperCubeLayout);for(var q=0;q<M;q++){if(null==N[q]){f++;continue}try{var S=v[q].id;var x="X"===v[q].state;var A=g[q];var _=this.colorMap.getColor(v[q],A.value,f);var O=x||!L.length?n:L[q];var w=D[q];var E=o.calculateSymbolSize(O).size+p;c.push(a.default.generateAttributeArray(N[q],S,v[q].dimValue,w,{color:_,value:A.value,elemNo:A.elemNo},x,[o.key(O,_),L.length?O:null,E]))}catch(e){this.map.addError(l.default.INVALID_GEOMETRY,this,[N[q]])}f++}break;case"LATLONGS":var H=b;for(var q=0;q<M;q++){if(null==H[q]){f++;continue}try{var S=v[q].id;var x="X"===v[q].state;var A=g[q];var _=this.colorMap.getColor(v[q],A.value,f);var O=x||!L.length?n:L[q];var w=D[q];var E=o.calculateSymbolSize(O).size+p;var T=new idevio.map.PointFeature(this.dataset,{coordinate:H[q],attributes:a.default.generateAttributeObject(S,v[q].dimValue,w,{color:_,value:A.value,elemNo:A.elemNo},x,{key:o.key(O,_),labelOffset:E,size:L.length?O:null})});null!=A.elemNo&&this.colorElemNos.add(A.elemNo);this.featureTable[String(S)]=T}catch(e){this.map.addError(l.default.INVALID_GEOMETRY,this,[String(H[q])])}f++}break;case"UNKNOWN":this.map.addError(l.default.INVALID_GEOMETRY,this);break}}"NAMES"===h&&this.dataset.addData(c);this.setStyle(o.getSymbols());a.default.isLocationDataset(this.dataset)&&0!==e.length||this.done()};t.prototype.setStyle=function(e){var t={type:"symbol",icons:e,iconKey:"key"};var a=this.getLabelStyle({anchorY:this.layout.label.position,pointDistanceKey:"labelOffset"});this.layer.setStyles([t,a])};return t}(a.default);t.default=p}.apply(t,i),void 0!==r&&(e.exports=r))},2155:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(512),a(109),a(507),a(431)],r=function(e,t,a,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);var s=function(){function e(e,t,i){var r="ChartLayer"===i?"qualitative":"primary";this.colorProps=t;this.comboColorMap=new a.default({autoMode:r},e)}e.prototype.setData=function(e){if("byExpression"===e.color.mode&&!e.color.auto&&e.color.measureMax<=e.color.measureMin){e.color.measureMax=10;e.color.measureMin=0}this.colorProps=e.color;return this.comboColorMap.setData(e)};e.prototype.getColor=function(e,t,a){var r;if(e.state===n.default.EXCLUDED_QSTATE)r=new i.default(this.comboColorMap.getColor(n.default.NULL_ELEMNO,t,0,a).toRGBA());else if(e.state===n.default.LOCKED_QSTATE&&e.id===n.default.OTHERS_ELEMNO)r=new i.default(this.comboColorMap.getColor(n.default.OTHERS_ELEMNO,t,0,a).toRGBA());else try{r=new i.default(this.comboColorMap.getColor(e.id,t,0,a).toRGBA())}catch(e){r=new i.default("#DDD")}r.setAlpha(this.colorProps.opacity*r.getAlpha());return r.toRGBA()};e.prototype.getComboColorMap=function(){return this.comboColorMap};e.prototype.getColorProperties=function(){return this.colorProps};e.prototype.getOutlineColor=function(){var e=new i.default(this.colorProps.outline.color);var t=isNaN(this.colorProps.outlineOpacity)?this.colorProps.opacity:this.colorProps.outlineOpacity;e.setAlpha(t);return e.toRGBA()};e.prototype.getLegendTitle=function(){try{return this.comboColorMap.getLegendTitle()}catch(e){return""}};e.prototype.getColorLegendInfo=function(e){var t=this.comboColorMap.getColorDataInfo();var i=t.legendMode;var o=t.valid;var n=void 0;if(o){var s=void 0;s=t.internalMode===a.default.EXPRESSION?"colorByExpression":"colorByAlternative";var l=r.default.getDimensionExpressionIndex(s,e);null!=l&&(n="qDimensionInfo/"+l.dimensionIndex+"/"+(l.isDim?"qAttrDimInfo/":"qAttrExprInfo/")+l.index)}return{discrete:i.discrete,valid:o,title:this.getLegendTitle(),path:n,colorMode:i.colorMode,colorMapping:o?this.comboColorMap.getColorMapping():[],persistentColors:t.persistentColors,activeScale:this.comboColorMap._sequentialMap.getActiveScale(),qualitativeScale:this.comboColorMap.getColorScale()._qualitativeScale,wrangled:t.wrangled,othersLabels:(t.othersLabels||[]).filter(Boolean),comboColorMap:this.comboColorMap}};e.prototype.release=function(){this.comboColorMap.release()};return e}();t.default=s}.apply(t,i),void 0!==r&&(e.exports=r))},2156:function(e,t,a){var i,r;!(i=[a,t],r=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=function(){function e(t,a,i){var r=this;this.listenerId="";this.mapChart=t.map;this.layer=t;var o=t.map.selectTool;var n=a.brush("itemHighlight");var s=a.brush("rangeHighlight");this.brushes=[n,s];var l=function(){this.end()}.bind(this);o.Cleared.bind(l);this.removeSelectionClearedListener=function(){o.Cleared.unbind(l)};n.on("start",function(){r.endOthers();o.activate();r.attach()}).on("end",function(){r.detach()}).on("update",function(){o.legendSelect(t,this,true,i)});n.intercept("toggle-values",function(e){return e.filter(function(e){return e.value>=0})});s.on("start",function(){r.endOthers();o.activate();r.attach()}).on("end",function(){r.detach();s.clear();var e=a.component("legendRangeBrush");e&&e.emit("rangeClear")}).on("update",function(){o.legendSelect(t,this,false,i)});this.listener=function(){this.end();o.clearSelections()}.bind(this);e.handlers.push(this)}e.prototype.sequentialCommit=function(e){if(this.brushes[1].brushes()[0]){var t=this.brushes[1].brushes()[0].brush.ranges()[0];this.mapChart.selectTool.sequentialCommit(this.layer,t,e)}};e.prototype.attach=function(){this.detach();this.listenerId=this.mapChart.map.addListener("click",this.listener);this.mapChart.selectTool.Activated.once(this.listener)};e.prototype.detach=function(){try{this.mapChart.map.removeListener(this.listenerId)}catch(e){}this.mapChart.selectTool.Activated.unbind(this.listener)};e.prototype.endOthers=function(){var t=this;e.handlers.forEach(function(e){e!==t&&e.end()})};e.prototype.end=function(){this.brushes.forEach(function(e){return e.end()})};e.prototype.destroy=function(){this.removeSelectionClearedListener();var t=e.handlers.indexOf(this);t>-1&&e.handlers.splice(t,1);this.detach()};e.handlers=[];return e}();t.default=a}.apply(t,i),void 0!==r&&(e.exports=r))},2157:function(e,t,a){(function(i){var r,o;var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(r=[a,t,a(448),a(1115),a(1174),a(91),a(431)],o=function(e,t,a,r,o,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);r=n(r);o=n(o);s=n(s);l=n(l);var u;(function(e){function t(e,t){var a=t.colorInfo;var n=t.layer;var u=void 0;var d=[];var p=n.layout.type===r.default.CHART?n.excludeLayout.qHyperCube.qDataPages[0].qMatrix:void 0;var c=function(e,t){if(p&&("L"===p[e][1].qState||"L"===p[e][0].qState))return l.default.OTHERS_ELEMNO;return t};var h=n.excludeLayout.qHyperCube.qHasOtherValues;var f=a.othersLabels[a.othersLabels.length-1]||s.default.get("properties.dimensionLimits.others");var m="measure"===a.colorMode;if(a.path)if(m){d=a.colorMapping.map(function(e){return e.color.toRGB()});d.unshift(d[0]);d.push(d[d.length-1]);u=a.colorMapping.reduce(function(e,t){t.isMax&&e.push(t.id[0]);e.push(t.id[1]);return e},[]).reverse()}else{var y=[];var v=a.wrangled.reduce(function(e,t,a){if(-1===y.indexOf(t.elemValue)&&n.colorElemNos.has(t.elemValue)&&(!p||p&&p[a]&&p[a][1]&&"X"!==p[a][1].qState)&&(h||t.elemValue>=0)){y.push(t.elemValue);e.push({index:a,text:t.text,elemValue:c(a,t.elemValue)})}return e},[]).filter(function(e){return null!=e}).sort(function(e,t){if(e.elemValue<0)return 1;if(t.elemValue<0)return-1;return(e.text||"").localeCompare(t.text||"")});h&&!v.some(function(e){return e.elemValue===l.default.OTHERS_ELEMNO})&&v.push({index:-1,text:f,elemValue:l.default.OTHERS_ELEMNO});d=v.map(function(e){return a.comboColorMap.getColor(e.elemValue,e.text||"",0,e.index).toRGB()});u=v.map(function(e){return e.elemValue})}e.addComponent("categorical-legend",{key:"cat-legend",displayOrder:0,scale:{type:m?"threshold-color":"categorical-color",range:d,domain:u,invert:true,data:{extract:{field:a.path}},label:function(e,t){return c(t,e.datum.value)<0?f:e.datum.label},value:function(e,t){return c(t,e.datum.value)}},settings:{layout:{scrollOffset:n.map.extensionObject.options.viewState?n.map.extensionObject.options.viewState.layers[n.id].legendScrollOffset:0,size:t.isHorizontal?2:1},item:{show:function(e,t){var a=c(t,e.datum.value);return m||a===l.default.OTHERS_ELEMNO||a!==l.default.NULL_ELEMNO&&n.colorElemNos.has(a)},label:{maxWidth:t.isHorizontal?void 0:120,maxLines:t.isHorizontal?1:2}},title:{show:true,anchor:"start",text:a.title,maxLines:2,wordBreak:"break-word",maxWidth:110}},brush:t.canInteract()?{trigger:[{on:"tap",action:"toggle",contexts:["itemHighlight"]}],consume:[{context:"itemHighlight",style:{inactive:{opacity:.4}}}]}:void 0},{isRtl:t.rtl,show:true,dock:t.isHorizontal?"top":"center"});if(t.canInteract()){var g=o.default.getCategoricalLegendPanGesture("cat-legend",t.isHorizontal,t.rtl);g.push({type:"Tap",options:{taps:1},events:{tap:function(e){var t=i(e.target).data("action");var a=this.chart.component("cat-legend");a&&t&&a.emit(t)}}});e.addInteraction({},{gestures:g})}}e.addCategoricalLegend=t;function n(e,t){var i=t.colorInfo;var r=i.activeScale._colorParts;var o=r[0].reduce(function(e,t,a){return e.concat(t.slice(0===a?0:1,2).map(function(e){return e.toRGB()}))},[]);var n=!t.isHorizontal||t.isHorizontal&&t.rtl;var s=i.activeScale._min;var l=i.activeScale._max;var u;if(s===l)if(0===s){l=1e-7;u=function(){return"0"}}else l+=1e-6*l;e.addComponent("sequential-legend",{key:"seq-legend",minimumLayoutMode:"SPARK",displayOrder:0,settings:{fill:{data:{field:i.path},type:"sequential-color",range:o.reverse(),min:s,max:l},major:{data:{field:i.path},invert:n,min:s,max:l},title:{show:!t.isHorizontal,text:i.title,maxLines:2,wordBreak:"break-word",anchor:t.isHorizontal?t.rtl?"right":"left":void 0},tick:{anchor:t.isHorizontal?"bottom":t.rtl?"left":"right",label:u},length:1}},{isRtl:t.rtl,show:true,showTitle:true,dock:t.isHorizontal?"top":t.rtl?"right":"left"});e.addComponent("range",{key:"legendRangeBrush",dock:"@seq-legend",settings:{target:{selector:'[id="legend-seq-target"]',fillSelector:'[id="legend-seq-ticks"]'}}},{brushKey:"rangeHighlight",brushScale:{data:{field:i.path},invert:n,min:s,max:l},isHorizontal:t.isHorizontal,multiple:false});e.addInteraction({},{gestures:[{type:"Pan",options:{direction:t.isHorizontal?a.default.DIRECTION_HORIZONTAL:a.default.DIRECTION_VERTICAL,event:"legendRange",enable:t.canInteract},events:{legendRangestart:function e(t){this.chart.component("legendRangeBrush").emit("rangeStart",t)},legendRangemove:function e(t){this.chart.component("legendRangeBrush").emit("rangeMove",t)},legendRangeend:function e(a){t.selectionHandler&&t.selectionHandler.sequentialCommit();this.chart.component("legendRangeBrush").emit("rangeEnd",a)}}}]})}e.addSequentialLegend=n;function u(e,t){var a=t.colorInfo.color;var i=t.colorInfo.domain;var r=t.colorInfo.min;var o=t.colorInfo.max;var n=function(e){return t.colorInfo.formatter.format(e)};if(r===o)if(0===r){o=1e-7;n=function(){return t.colorInfo.formatter.format(0)}}else o+=1e-6*o;e.addComponent("sequential-legend",{key:"seq-legend",minimumLayoutMode:"SPARK",displayOrder:0,formatter:{type:"d3-number",format:".2s"},settings:{fill:{type:"sequential-color",range:a,domain:i},major:{invert:!t.isHorizontal||t.isHorizontal&&t.rtl,min:r,max:o},title:{text:t.colorInfo.title,maxLines:2,wordBreak:"break-word",anchor:t.isHorizontal?t.rtl?"right":"left":void 0},tick:{label:n,anchor:t.isHorizontal?void 0:t.rtl?"left":"right"},length:1}},{isRtl:t.rtl,show:true,showTitle:!t.isHorizontal,dock:t.isHorizontal?"top":t.rtl?"right":"left"})}e.addDensityLegend=u})(u||(u={}));t.default=u}.apply(t,r),void 0!==o&&(e.exports=o))}).call(this,a(11))},2158:function(e,t,a){(function(i){var r,o;var n=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(r=[a,t,a(1056),a(1056),a(89),a(1115),a(91),a(201)],o=function(e,t,a,r,o,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=s(a);o=s(o);l=s(l);u=s(u);d=s(d);function p(e,t,a){return i.extend({},e,{color:d.default.getStyle("mapChart",t,"color"),font:d.default.getFontSize("mapChart",t,"fontSize")*a+" QlikView Sans"})}var c=function(e){n(t,e);function t(t,a,o){var n=e.call(this,{parent:t,layer:a,maxMode:r.Mode.Small})||this;n.options=o||{};n.element.css({flex:"0 0 auto"});n.titleElem=i("<div>").appendTo(n.element);n.typeElem=i("<div>").appendTo(n.element);n.setCss();return n}t.prototype.setCss=function(){var e=this.getScale();this.element.css({padding:5*e+"px",paddingBottom:0});var t={textAlign:this.isRtl()?"right":"left"};this.titleElem.css(p(t,"title.main",e));this.typeElem.css(p(t,"title.subTitle",e))};t.prototype.draw=function(e){var t=this;this.setCss();var a=new o.default;var i;if(this.options.title)i=this.options.title()||u.default.get("geo.dropmenu.noName");else{var r=this.layer.excludeLayout.qHyperCube.qDimensionInfo;i=r.length?r[0].qFallbackTitle:u.default.get("geo.dropmenu.noName");var n=Boolean(this.layer.excludeLayout.qHyperCube.qDimensionInfo[1]);n&&this.layer.layout.type===l.default.LINE&&(i+=" - "+(r.length>1?r[1].qFallbackTitle:u.default.get("geo.dropmenu.noName")))}this.titleElem.text(i);this.typeElem.text(u.default.get(this.layer.layerName));setTimeout(function(){return a.resolve(t)});return a.promise};return t}(a.default);t.default=c}.apply(t,r),void 0!==o&&(e.exports=o))}).call(this,a(11))},2159:function(e,t,a){(function(i){var r,o;var n=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(r=[a,t,a(201),a(1599),a(507),a(90),a(1115),a(448)],o=function(e,t,a,r,o,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=s(a);r=s(r);o=s(o);l=s(l);u=s(u);d=s(d);var p=150;var c=75;var h=function(e){n(t,e);function t(t,a,i){var r=e.call(this,t,a,i,"size")||this;r.path=null;r.element.css({flex:"0 0 auto",height:c,width:c});return r}t.prototype.build=function(e,t){var r=this;var n=this.getScale();var s=5;var l=(t?p:p-2*s)*n;var h=(t?c:p)*n;var f=this.layer.layout.type===u.default.LINE;var m=this.isRtl();this.element.width(l).height(h);this.element.css({flex:"0 0 auto",margin:s*n+"px",minWidth:t?l+10*n:"auto",minHeight:t?"auto":h+10*n});var y=o.default.getMinMax("size",this.getHyperCubeLayout());e.settings.scales.size={data:{key:"qHyperCube",field:this.path},ticks:{values:y},invert:!t||t&&m,min:y&&y[0],max:y&&y[1]};var v;var g=function(){var e=i("text",v);if(e){var t=e.find("title");if(0===t.length){var a=document.createElementNS("http://www.w3.org/2000/svg","title");a.textContent=r.getTitle();e.append(a)}else t.text(r.getTitle()||"")}};e.addComponent("text",{renderer:"svg",key:"size-label",text:function(){return r.getTitle()},dock:"top",displayOrder:3,settings:{paddingStart:t?0:5,paddingEnd:t?0:10,paddingLeft:0,paddingRight:0,anchor:m?"right":"left"},style:{text:{fontSize:a.default.getFontSize("mapChart","legend.title","fontSize"),fontFamily:"QlikView Sans",fill:a.default.getStyle("mapChart","legend.title","color")}},mounted:function(e){v=e;g()},updated:g});e.addComponent("point-marker",this.createPointMarkerConfig(t,m,f));e.addComponent("axis",{scale:"size",dock:"@size-legend",displayOrder:0,settings:{align:t?"top":m?"left":"right",labels:{margin:t?0:l/n/2-(m?5:15)},line:{show:false},ticks:{show:false}}});e.addComponent("range",{key:"legendRangeBrush",dock:"@size-legend",settings:{target:{component:"size-legend",fillSelector:'[id="legend-seq-ticks"]'}}},{brushKey:"rangeHighlight",brushScale:"size",isHorizontal:t,multiple:false});var b=this.selectionHandler;e.addInteraction({},{gestures:[{type:"Pan",options:{direction:t?d.default.DIRECTION_HORIZONTAL:d.default.DIRECTION_VERTICAL,event:"range",enable:function(){return r.isInteractable()}},events:{rangestart:function e(t){this.chart.component("legendRangeBrush").emit("rangeStart",t)},rangemove:function e(t){this.chart.component("legendRangeBrush").emit("rangeMove",t)},rangeend:function e(t){b&&b.sequentialCommit("size");this.chart.component("legendRangeBrush").emit("rangeEnd",t)}}}]})};t.prototype.getTitle=function(){var e=this.layer.layout;var t=this.getHyperCubeLayout();var a=t&&o.default.getDimensionExpressionTitle("size",t);if("libraryItem"!==e.size.expression.type){var i=e.size.expression.activeMeasureIndex;e.size.label?a=e.size.label:null!=i&&e.qHyperCube.qMeasureInfo.length>i&&(a=e.qHyperCube.qMeasureInfo[i].qFallbackTitle||a)}return a};t.prototype.createPointMarkerConfig=function(e,t,i){var r=[0,1,2,3];if(i&&!e){r.push(r.length);r.push(r.length)}else!i&&e&&r.push(r.length);var o=function(t){var a=i?2:1;return(a+(10-a)*(t/(r.length-1)))/(e?1:2.5)};var n=r.reduce(function(e,t){return e+o(t)},0)+o(r.length-1)/2;var s=function(a,i){var r=0;for(var s=0;s<=i;s++)r+=o(s);var l=r/n;return e&&!t?l:1-l};return{key:"size-legend",data:r,settings:{x:e?s:t?.75:.2,y:e?.4:s,strokeWidth:1,stroke:a.default.getStyle("mapChart","sizeLegend","stroke")||"#bfbfbf",size:function(e,t){return o(t)},fill:a.default.getStyle("mapChart","sizeLegend","fill")||"#d9d9d9",shape:i?"bar":"circle"}}};t.prototype.getHyperCubeLayout=function(){return this.layer.locationCubeLayout||this.layer.hyperCubeLayout};t.prototype.getHyperCube=function(){var e=this.layer.excludeLayout;return e.locCube?e.locCube.qHyperCube:e.qHyperCube};t.prototype.preDraw=function(){this.path=null;var e=o.default.getDimensionExpressionIndex("size",this.getHyperCubeLayout());null!=e&&(this.path="qDimensionInfo/"+e.dimensionIndex+"/qAttrExprInfo/"+e.index)};t.prototype.isValid=function(){return Boolean(this.layer.layout.showSizeLegend&&this.path&&l.default.getValue(this.getHyperCube(),this.path.replace(/\//g,"."))&&"barChart"!==this.layer.layout.chartType)};t.prototype.isVisible=function(t){return e.prototype.isVisible.call(this,t)&&this.isValid()};t.prototype.onUpdate=function(){this.wantsToExpand=false};return t}(r.default);t.default=h}.apply(t,r),void 0!==o&&(e.exports=o))}).call(this,a(11))},2160:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(48),a(146),a(240)],r=function(e,t,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);var n=function(){function e(){var e=this;this.opener=null;this.openedByClick=false;this.tooltipService=i.default.getService("qvChartTooltipService");this.tooltipRootElem=a.default("body > div#qs-chart-tooltip");this.tooltipService.Closed.bind(function(){e.getTooltipElem().css("pointerEvents","all");e.opener&&e.opener.clear();e.opener=null;e.openedByClick=false})}e.get=function(){e.instance||(e.instance=new e);return e.instance};e.prototype.getTooltipElem=function(){return a.default("div.qv-tooltip",this.tooltipRootElem)};e.prototype.isOpen=function(){return null!=this.opener};e.prototype.open=function(e,t,a,i,o,n){var s=e[0],l=e[1];var u=500;var d=new r.default(s,l);this.tooltipService.open({position:[d,d,d,d],content:t,direction:["top"],dir:a,template:void 0,numberInExcess:Math.max(0,n||0)},void 0,u);this.opener&&i!==this.opener&&this.opener.clear();this.openedByClick=o;this.getTooltipElem().css("pointerEvents","none");this.opener=i};e.prototype.close=function(){this.isOpen()&&this.tooltipService.close()};e.prototype.move=function(e,t){if(this.isOpen()){var a=this.getTooltipElem();var i=Number(a.css("left").replace("px",""));var r=Number(a.css("top").replace("px",""));a.css({top:r+t+"px",left:i+e+"px"})}};e.instance=null;return e}();t.default=n}.apply(t,i),void 0!==r&&(e.exports=r))},2161:function(e,t,a){var i,r;var o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);t["default"]=e;return t};!(i=[a,t,a(1296)],r=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);var i=function(){function e(e,t,a,i,r,o,n,s){this.min=e;this.max=t;this.n=a;this.minSymbol=i;this.maxSymbol=r;this.outline=o;this.shape=n;this.rotation=s;this.symbols={}}e.prototype.key=function(e,t){var a=this.calculateSymbolSize(e);var i=a.relSize+t;this.symbols[i]||(this.symbols[i]=this.makeSymbol(a.size,t));return i};e.prototype.makeSymbol=function(t,a){if(isNaN(t)||null===t)return idevio.map.IconFactory.cross?idevio.map.IconFactory.cross({radius:4,color:a,outline:this.outline,thickness:2}):idevio.map.IconFactory.circle({radius:NaN});var i=e.POLYGONS[this.shape]||e.POLYGONS["points"];return idevio.map.IconFactory.polygon({sides:i.sides,color:a,radius:t,rotation:i.rotation+this.rotation*(Math.PI/180),outline:this.outline})};e.prototype.calculateSymbolSize=function(e){return a.calculateSize(e,[this.minSymbol,this.maxSymbol],[this.min,this.max],this.n)};e.prototype.getSymbols=function(){return this.symbols};e.POLYGONS={hexagons:{sides:6,rotation:Math.PI/180*-60},pentagons:{sides:5,rotation:Math.PI/180*-90},squares:{sides:4,rotation:Math.PI/180*-45},triangles:{sides:3,rotation:Math.PI/180*-90},points:{sides:31,rotation:0},symbols:{sides:0,rotation:0}};return e}();t.default=i}.apply(t,i),void 0!==r&&(e.exports=r))},2162:function(e,t,a){(function(i){var r,o;var n=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(r=[a,t,a(1146),a(1262),a(1186),a(1038),a(1322),a(507),a(89),a(1124),a(1308),a(1296),a(1757)],o=function(e,t,a,r,o,l,u,d,p,c,h,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=s(a);r=s(r);o=s(o);l=s(l);u=s(u);d=s(d);p=s(p);c=s(c);h=s(h);f=s(f);m=s(m);h.default();var y=function(e){n(t,e);function t(t,a,i,r){var n=e.call(this,t,a,i,r)||this;n.IS_SELECTABLE=true;n.layerName="geo.ChartLayer";n.CROSS_SYMBOL_RADIUS=4;n.layout=a;n.name=i;n.legend=new o.default(n);n.layer=new idevio.map.FeatureLayer(n.map.map,{drawOrder:1001,pickable:true});n.toolTip=new u.default(n,t);n.symbols={};n.symbolElems=[];n.hardLimit=5e4;n.dataset=n.layer.getDataset();n.symbolsDeferred=new p.default;return n}t.prototype.fulfillsRequirements=function(){var e=this.hyperCubeLayout&&this.hyperCubeLayout.qDimensionInfo&&this.hyperCubeLayout.qDimensionInfo.length>1;var t=this.hyperCubeLayout&&this.hyperCubeLayout.qMeasureInfo&&this.hyperCubeLayout.qMeasureInfo.length>0;return e&&t};t.prototype.paint=function(){this.symbolsDeferred=null;return e.prototype.paint.call(this)};t.prototype.doPaint=function(){var e=this;this.clearData();this.symbolsDeferred=new p.default;if(!this.locationCubeLayout||this.layout.qHyperCube.qDimensionInfo.length<2){this.symbolsDeferred.resolve();return}var t=this.hyperCubeLayout.qDataPages;var o=this.locationCubeLayout.qDataPages;var n={};var s={};var u=[];var c=[];this.symbols={};this.symbolElems=[];var h="";var y=d.default.getMinMax("size",this.locationCubeLayout);var v=false===this.layout.size.autoRadiusValueRange?[this.layout.size.radiusValueMin,this.layout.size.radiusValueMax]:y||[0,0];var g=Math.max(1,Math.min(this.layout.size.radiusMax-this.layout.size.radiusMin,100));var b=[this.layout.size.radiusMin,this.layout.size.radiusMax];var L=Math.round((this.layout.size.radiusMin+this.layout.size.radiusMax)/2);var D=2;for(var M in o){var C=o[M];if(!C.qMatrix)continue;var q=d.default.getElemData(C,0);var S=d.default.getStringOrNumber("label",C,this.locationCubeLayout);var x=d.default.getNumericData("size",C,this.locationCubeLayout);var I=this.getGeometry(C,0,this.locationCubeLayout);"0"===M&&(h=this.makeOrChangeDataset(I,["geoname","id","name","label","excluded","parts","relSize","size","labelOffset","colorExpression","subIds"],this.layout.isLatLong,"Point"));var A=[];"NAMES"===h&&(A=this.addLocationSuffix(I,C,this.layout.locationNamesAuto,this.locationCubeLayout,""));for(var _=0;_<I.length;_++){if(null==I[_])continue;try{var O=q[_].id;if(null!==O){var w=void 0;"STRINGCOORDS"===h?w=a.default.parseGeometryString(I[_]):"NAMES"===h?w=A[_]:"LATLONGS"===h&&(w=I[_]);var E="X"===q[_].state;var T=S[_];var N=E||!x.length||null===x[_]?L:x[_];var H=0;if(E)H=L;else{var P=this.layout.size.expression.key||"";if(P.length>0){var k=x[_];H=null!==k?f.default.calculateSize(k,b,v,g).size:NaN}else H=L}var z=this.hyperCubeLayout.qMeasureInfo[0];var R=z.qMax<0?0:z.qMax;var F=z.qMin>0?0:z.qMin;R=R-F===0?1:R;var V={parts:[],label:T,labelOffset:0,excluded:E,size:H,relSize:x.length?N:null,loc:w,dimValue:q[_].dimValue,colorExpression:"",chartMeasureMax:0,chartMeasureMin:0,layerMeasureMax:R,layerMeasureMin:F,barHeightScale:0};n[_]=O;s[O]=V}}catch(e){this.map.addError(l.default.INVALID_GEOMETRY,this,[I[_]])}}}for(var M in t){var C=t[M];if(!C.qMatrix)continue;var B=d.default.getElemData(C,0);var j=d.default.getElemData(C,1);var G=d.default.getColumn(C,2);var U=this.getColorValues(C);for(var _=0;_<C.qMatrix.length;_++){var O=B[_].id;var W=j[_].id;if(null!==O&&null!==W){var Z=void 0===U[_]?{value:null}:U[_];var Y=this.colorMap.getColor(j[_],Z.value,_);var X=G[_];var K={id:W,dimension:{title:this.hyperCubeLayout.qDimensionInfo[1].qFallbackTitle,value:j[_].dimValue},measure:{title:this.hyperCubeLayout.qMeasureInfo.length>0?this.hyperCubeLayout.qMeasureInfo[0].qFallbackTitle:"",value:null==X||null==X.qNum||"NaN"===X.qNum?"-":X.qNum},color:{title:this.colorMap.getLegendTitle(),color:Y,value:null==Z.value||""===Z.value?"-":Z.value,expression:"",validColorVal:-2!==Z.elemNo},share:0};if(s.hasOwnProperty(""+O)){s[O].parts.push(K);null!=Z.elemNo?this.colorElemNos.add(Z.elemNo):this.layout.color.auto&&this.colorElemNos.add(W)}}}}var Q="";var J=this.colorMap.getColorProperties();Object.keys(s).forEach(function(t){var a=0;Q="";var i=parseInt(t,10);var r=[];var o=[];var n=s[i].parts;var l=0;var u=0;s[i].parts.forEach(function(e){r.push(e.id);var t=Number(e.measure.value);a+=isNaN(t)||t<0?0:t;J.auto||"byDimension"===J.mode&&m.default.exprAndFieldEquals(e.color.title,e.dimension.title)&&m.default.exprAndFieldEquals(String(e.color.value),String(e.dimension.value))?Q="dimensionColor":"byMeasure"===J.mode&&m.default.exprAndFieldEquals(e.color.title,e.measure.title)&&m.default.exprAndFieldEquals(String(e.color.value),String(e.measure.value))?Q="measureColor":"byExpression"===J.mode?Q=J.expressionIsColor?"dimensionColor":m.default.exprAndFieldEquals(e.color.title,e.dimension.title)&&m.default.exprAndFieldEquals(String(e.color.value),String(e.dimension.value))?"dimensionColor":m.default.exprAndFieldEquals(e.color.title,e.measure.title)&&m.default.exprAndFieldEquals(String(e.color.value),String(e.measure.value))?"measureColor":"expressionColor":"primary"!==J.mode&&e.color.validColorVal&&(Q="color");l=t>l&&t>0?t:l;u=t<u&&t<0?t:u});s[i].colorExpression=Q;s[i].chartMeasureMax=l;s[i].chartMeasureMin=u;var d=s[i].layerMeasureMax;var p=s[i].layerMeasureMin;s[i].barHeightScale=Math.abs((l-u)/(d-p));s[i].labelOffset="pieChart"===e.layout.chartType?s[i].size/2+D:s[i].barHeightScale*e.layout.size.barHeight/2+D;for(var c=0;c<r.length;c++){var h=Number(n[c].measure.value);n[c].share=isNaN(h)||h<0?"-":h/a*100;o.push(n[c])}s[i].parts=o});Object.keys(s).length>0&&("NAMES"===h?Object.keys(n).forEach(function(t){var a=n[parseInt(t,10)];var i=s[a];try{if((isNaN(i.size)||i.chartMeasureMin<0&&0===i.chartMeasureMax)&&"pieChart"===e.layout.chartType||0===i.chartMeasureMin&&0===i.chartMeasureMax){var r=i.parts[0];e.symbols[a]=e.getCrossSymbol(r.color.color);i.labelOffset=e.CROSS_SYMBOL_RADIUS+D}else Object.keys(i.parts).length>0&&c.push(e.getSymbol(a,i));var o=i.loc;var d=i.label;var p=i.excluded;var h=i.dimValue;var f=i.relSize;var m=i.size;var y=i.labelOffset;var v=i.colorExpression;if(i.parts.length>0){var g=i.parts.map(function(e){return e.id});u.push([o,String(a),h,d,p,i.parts,f,m,y,v,g])}}catch(t){e.map.addError(l.default.INVALID_GEOMETRY,e,[String(i.loc)])}}):Object.keys(n).forEach(function(t){var a=n[parseInt(t,10)];var i=s[a];try{if((isNaN(i.size)||i.chartMeasureMin<0&&0===i.chartMeasureMax)&&"pieChart"===e.layout.chartType||0===i.chartMeasureMin&&0===i.chartMeasureMax){var r=i.parts[0];e.symbols[a]=e.getCrossSymbol(r.color.color);i.labelOffset=e.CROSS_SYMBOL_RADIUS+D}else Object.keys(i.parts).length>0&&c.push(e.getSymbol(a,i));var o=new idevio.map.PointFeature(e.dataset,{coordinate:i.loc,attributes:{id:String(a),name:i.dimValue,label:i.label,excluded:i.excluded,parts:i.parts,relSize:i.relSize,size:i.size,labelOffset:i.labelOffset,colorExpression:i.colorExpression}});i.parts.forEach(function(t){return e.featureTable[String([a,t.id])]=o})}catch(t){e.map.addError(l.default.INVALID_GEOMETRY,e,[String(i.loc)])}}));"NAMES"===h&&this.dataset.addData(u);p.default.all(c).then(function(){e.symbolElems.forEach(function(e){i(e).remove()});e.setStyle()}).finally(function(){e.symbolsDeferred&&e.symbolsDeferred.resolve()});r.default.isLocationDataset(this.dataset)&&0!==t.length||this.done()};t.prototype.done=function(){var t=this;this.symbolsDeferred?this.symbolsDeferred.promise.then(function(){return e.prototype.done.call(t)}):e.prototype.done.call(this)};t.prototype.getSymbol=function(e,t){var a=this;var r=new p.default;var o=function(t){a.symbols[e]=new idevio.map.Icon({url:i(t).children("canvas")[0].toDataURL(),anchorX:"MIDDLE",anchorY:"MIDDLE"});a.symbolElems.push(t);r.resolve()};var n=document.createElement("div");i(n).appendTo("body").hide();var s={};var l=[];var u=[];t.parts.forEach(function(e){e.id<0?u.push(e):l.push(e)});l=l.concat(u);var d=[["dimValue","measure","color"]].concat(l.map(function(e){return[e.dimension.value,e.measure.value,e.color.color]}));switch(this.layout.chartType){case"pieChart":s=this.getPieChart(t.size);break;case"barChart":s=this.getBarChart(d,t.barHeightScale);break}var h={mounted:o,element:n,data:{type:"matrix",data:d},settings:s};c.default.chart(h);return r.promise};t.prototype.getPieChart=function(e){var t=this.colorMap.getOutlineColor();return{dockLayout:{size:{width:e/devicePixelRatio,height:e/devicePixelRatio}},components:[{key:"p",type:"pie",data:{extract:{field:"dimValue",props:{num:{field:"measure"},color:{field:"color"}}}},settings:{slice:{arc:{ref:"num"},fill:{ref:"color"},strokeWidth:.3,stroke:t}}}]}};t.prototype.getBarChart=function(e,t){var a=this.colorMap.getOutlineColor();var i=t*(this.layout.size.barHeight/devicePixelRatio);return{dockLayout:{size:{width:(e.length-1)*this.layout.size.barWidth/devicePixelRatio,height:i}},scales:{y:{data:{field:"measure"},invert:true,include:[0]},t:{data:{extract:{field:"dimValue"}},padding:.1}},components:[{key:"bars",type:"box",data:{extract:{field:"dimValue",props:{start:0,end:{field:"measure"},color:{field:"color"}}}},settings:{major:{scale:"t"},minor:{scale:"y"},box:{fill:{ref:"color"},stroke:a,strokeWidth:.3,maxWidthPx:this.layout.size.barWidth,maxHeightPx:i}}}]}};t.prototype.getCrossSymbol=function(e){return idevio.map.IconFactory.cross?idevio.map.IconFactory.cross({radius:this.CROSS_SYMBOL_RADIUS,color:e,outline:this.layout.color.outline.color,thickness:2}):idevio.map.IconFactory.circle({radius:NaN})};t.prototype.setStyle=function(){var e={type:"symbol",icons:this.symbols,iconKey:"id"};var t=this.getLabelStyle({pointDistanceKey:"labelOffset",anchorY:this.layout.label.position});this.layer.setStyles([e,t])};return t}(r.default);t.default=y}.apply(t,r),void 0!==o&&(e.exports=o))}).call(this,a(11))},2163:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1598),a(1186),a(431),a(1732),a(1038)],r=function(e,t,a,i,r,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);var u=function(e){o(t,e);function t(t,a,r,o,n){var s=e.call(this,t,a,r,o)||this;s.IS_SELECTABLE=false;s.layerName="geo.GeodataLayer";s.layout=a;s.index=n;s.name=r;s.legend=new i.default(s,{title:function(){return s.layout.title}});s.createLayer();s.addMapListener("basemapchanged",function(){return s.createLayer()});s.errorMessageDisplayed=false;return s}t.prototype.createLayer=function(){this.layer&&this.layer.remove();switch(this.layout.dataType){case"tms":this.oldProps=this.layout.tms;this.currentUrl=this.layout.tms.url;this.createTMSLayer();break;case"wms":this.oldProps=this.layout.wms;this.currentUrl=this.layout.wms.url;this.createWMSLayer();break;case"image":this.oldProps=this.layout.image;this.currentUrl=this.layout.image.url;this.createImageLayer();break}this.dataset=this.layer.getDataset()};t.prototype.doPaint=function(){switch(this.layout.dataType){case"tms":if(this.layout.tms.attribution!==this.currentAttribution){this.currentAttribution=this.layout.tms.attribution;this.map.setAttribution(this.id,(this.layout.tms&&this.layout.tms.attribution||"").trim())}t.havePropsChanged(this.layout.tms,this.oldProps)&&this.createLayer();break;case"wms":if(this.layout.wms&&this.layout.wms.attribution!==this.currentAttribution){this.currentAttribution=this.layout.wms.attribution;this.map.setAttribution(this.id,(this.layout.wms&&this.layout.wms.attribution||"").trim())}this.layout.wms&&t.havePropsChanged(this.layout.wms,this.oldProps)&&"https://"!==this.layout.wms.url&&this.createLayer();break;case"image":if(this.layout.image.attribution!==this.currentAttribution){this.currentAttribution=this.layout.image.attribution;this.map.setAttribution(this.id,(this.layout.image&&this.layout.image.attribution||"").trim())}this.layout.image&&t.havePropsChanged(this.layout.image,this.oldProps)&&this.createLayer();break}this.layer.setVisible(this.isVisible()&&(this.currentUrl||"").length>0);this.done()};t.prototype.createWMSLayer=function(){var e=this.layout.wms;var t=(e&&this.currentUrl||"").trim();var a=e.version||"1.1.0";var i=e.hasWmsLoaded&&e.selectedCrs||this.getMapCrs();if(e.hasWmsLoaded){var o="";var n=e.capabilities.layers.filter(function(e){return e.selected});for(var s=0;s<n.length;s++){o+=n[s].name;s+1!==n.length&&(o+=",")}var l="image/"+e.selectedFormat.toLowerCase();var u=""+e.capabilities.transparent;var d="";var p=[];p.push("service=WMS");p.push("transparent="+u);p.push("request=GetMap");p.push("layers="+o);p.push("styles="+d);p.push("format="+l);t=r.default.addUrlParameters(t,p)}var c={url:t,version:a,crs:i,crossOrigin:r.default.isWm5AtLeast("6.9.0")?"auto":null};var h={drawOrder:100-this.index,visible:this.isVisible()&&this.fulfillsRequirements(),dataset:new idevio.map.WmsDataset(c)};this.layer=new idevio.map.WmsLayer(this.map.map,h);this.dataset=this.layer.getDataset()};t.prototype.createTMSLayer=function(){var e=this;var a=(this.layout.tms&&this.layout.tms.url||"").trim();var i=this.layout.tms.auto;this.errorMessageDisplayed=false;var o=function(t,a,r,o){try{r=-(r+1);return s.default.parseUrl(t,a,r,o,i)}catch(t){if(!e.errorMessageDisplayed){e.map.addError(l.default.INVALID_URL,e,[t.message]);e.errorMessageDisplayed=true}return null}};var n={url:a,crossOrigin:r.default.isWm5AtLeast("6.9.0")?"auto":null,noTileImage:t.EMPTY_IMAGE,failedTileImage:t.FAILED_IMAGE,urlFunction:o};if(!i){var u=this.getMapCrs();n.tileSizePixels=this.layout.tms.tileSize;n.tileWidth=this.layout.tms.tileWidth;n.tileHeight=this.layout.tms.tileHeight;n.originX=this.layout.tms.originLeft;n.originY=this.layout.tms.originTop;n.levels=20;n.crs=u}this.layer=new idevio.map.TiledImageLayer(this.map.map,{drawOrder:100-this.index,visible:this.isVisible()&&this.fulfillsRequirements(),dataset:n});this.dataset=this.layer.getDataset()};t.prototype.createImageLayer=function(){var e=(this.layout.image&&this.layout.image.url||"").trim();var t=isNaN(this.layout.image.minX)?0:this.layout.image.minX;var a=isNaN(this.layout.image.minY)?0:this.layout.image.minY;var i=isNaN(this.layout.image.maxX)?5:this.layout.image.maxX;var o=isNaN(this.layout.image.maxY)?5:this.layout.image.maxY;var n={min:[t,a],max:[i,o]};this.layer=new idevio.map.StaticImageLayer(this.map.map,{dataset:new idevio.map.StaticImageDataset({url:e,crossOrigin:r.default.isWm5AtLeast("6.9.0")?"auto":null,bounds:n}),drawOrder:100-this.index,visible:this.isVisible()&&this.fulfillsRequirements()});this.dataset=this.layer.getDataset()};t.prototype.fulfillsRequirements=function(){switch(this.layout.dataType){case"tms":return(this.layout.tms&&this.layout.tms.url||"").trim().length>0;case"wms":return(this.layout.wms&&this.layout.wms.url||"").trim().length>0;case"image":return(this.layout.image&&this.layout.image.url||"").trim().length>0;default:return false}};t.havePropsChanged=function(e,t){return JSON.stringify(e)!==JSON.stringify(t)};t.prototype.getMapCrs=function(){var e=this.map.layout.mapSettings.projection.split("_");return e.length>1&&("adaptive"===e[1]||"empty"===e[0])?"EPSG:4326":"EPSG:3857"};t.prototype.doRemove=function(){this.layer.remove()};t.FAILED_IMAGE=function(){var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAgMAAAAhHED1AAAACVBMVEUAAAD/AAD/AADZP3bhAAAAA        3RSTlMAgLrqQQYHAAAAa0lEQVR42u3cMREAIAADsS44YMEVCw7wrwERnbjLC4iDNnXjVO2sDriZqZoAAAAAAAAAAAAAAAAAAAAAAAAAAAA        AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8DbTT/f48oO0BDHZ7DTLJsl8AAAAASUVORK5CYII=";return e}();t.EMPTY_IMAGE=function(){var e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";return e}();return t}(a.default);t.default=u}.apply(t,i),void 0!==r&&(e.exports=r))},2164:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1262),a(1186),a(1322),a(1038),a(1146),a(507)],r=function(e,t,a,i,r,s,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);var d=function(e){o(t,e);function t(t,a,o,n){var s=e.call(this,t,a,o,n)||this;s.IS_SELECTABLE=true;s.layerName="geo.AreaLayer";s.name=o;s.legend=new i.default(s);s.layer=new idevio.map.FeatureLayer(s.map.map,{drawOrder:1e3,pickable:true});s.toolTip=new r.default(s,t);s.dataset=s.layer.getDataset();return s}t.prototype.doPaint=function(){var e=this.hyperCubeLayout.qDataPages;this.clearData();var t={};var i=[];var r="";var o=0;for(var n in e){var d=e[n];if(!d.qMatrix)continue;var p=u.default.getElemData(d,0);var c=this.getGeometry(d,0,this.hyperCubeLayout);var h=this.getColorValues(d);var f=u.default.getStringOrNumber("label",d,this.hyperCubeLayout);"0"===n&&(r=this.makeOrChangeDataset(c,a.default.DEFAULT_COLUMNS,false,"Area"));switch(r){case"STRINGCOORDS":var m=c;for(var y=0;y<m.length;y++){if(null==m[y]){o++;continue}try{var v=l.default.parseGeometryString(m[y]);var g=p[y].id;var b=f[y];var L=h[y];var D=this.colorMap.getColor(p[y],L.value,o);t[String(g)]=D;var M=new idevio.map.PolygonFeature(this.dataset,{coordinates:v,attributes:a.default.generateAttributeObject(g,p[y].dimValue,b,{color:D,value:L.value,elemNo:L.elemNo},"X"===p[y].state)});null!=L.elemNo&&this.colorElemNos.add(L.elemNo);this.featureTable[String(g)]=M}catch(e){this.map.addError(s.default.INVALID_GEOMETRY,this,[m[y]])}o++}break;case"NAMES":var C=this.addLocationSuffix(c,d,this.layout.locationNamesAuto,this.hyperCubeLayout);for(var y=0;y<c.length;y++){if(null==C[y]){o++;continue}try{var g=p[y].id;var q=C[y]||"";var b=f[y];var L=h[y];var D=this.colorMap.getColor(p[y],L.value,o);t[String(g)]=D;i.push(a.default.generateAttributeArray(q,g,p[y].dimValue,b,{color:D,value:L.value,elemNo:L.elemNo},"X"===p[y].state))}catch(e){this.map.addError(s.default.INVALID_GEOMETRY,this,[C[y]])}o++}break;case"UNKNOWN":this.map.addError(s.default.INVALID_GEOMETRY,this);break}}"NAMES"===r&&this.dataset.setData(i);this.setStyle(t,this.colorMap.getOutlineColor());a.default.isLocationDataset(this.dataset)&&0!==e.length||this.done()};t.prototype.setStyle=function(e,t){var a={type:"polygon",color:"purple",colorKey:"id",colors:e,outline:t};this.layer.setStyles([a,this.getLabelStyle()])};return t}(a.default);t.default=d}.apply(t,i),void 0!==r&&(e.exports=r))},2165:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1262),a(1186),a(1322),a(1038),a(1146),a(507),a(1296)],r=function(e,t,a,i,r,s,l,u,d){"use strict";a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);var p=function(e){o(t,e);function t(t,a,o,n){var s=e.call(this,t,a,o,n)||this;s.IS_SELECTABLE=true;s.layerName="geo.LineLayer";s.name=o;s.legend=new i.default(s);s.layer=new idevio.map.FeatureLayer(s.map.map,{drawOrder:1001,pickable:true});s.toolTip=new r.default(s,t);s.dataset=s.layer.getDataset();s.geomTypes=["UNKNOWN","UNKNOWN"];s.geom=[];s.sizearr=[];s.colorValues=[];s.labelArr=[];s.elemData=[];s.elemData2=[];s.hardLimit=2e4;s.widthMinMax=[0,0];s.widthRange=[0,0];s.quantifyTo=1;s.layout=a;return s}t.prototype.lookupNames=function(e,t,a,i){if(!idevio.Connection.baseUrl){t.map.addError(s.default.OFFLINE_LOOKUP,t);t.done();return}var r={columnNames:["name"],name:"lookupDataset",onload:function(e){var t={};var i=e.source.getAll();for(var r=0;r<i.length;r++)t[i[r].getAttribute("name")]=i[r];a(t)},onerror:function(e){if(/error/i.test(e.level))t.map.addError(s.default.FAILED_LOOKUP,t);else{var a=e.message.trim().split(/\n/g);t.map.addError(s.default.UNSUCCESFULL_LOOKUP,t,a)}t.done()}};this.lookupDataset||(this.lookupDataset=idevio.map.LocationDataset.create("Area"===(i||"Point")?"i:///areageom/default":"i:///pointgeom/default","SERVICE",r));e.length>0?this.lookupDataset.addData(e):a({})};t.prototype.getCoordinate=function(e,t,a){var i=null;switch(e){case"NAMES":var r=a[t];r&&(i=r.getCoordinates());break;case"STRINGCOORDS":i=l.default.parseGeometryString(t);break;case"LATLONGS":i=t;break}return i};t.prototype.fulfillsRequirements=function(){var e=this.hyperCubeLayout.qDimensionInfo.length>0;return e};t.prototype.doPaint=function(){var e=this;var t=this.hyperCubeLayout.qDataPages;this.lookupDataset&&this.lookupDataset.removeAll();this.clearData();if(0===t.length){this.done();return}this.elemData=u.default.getElemData(t,0);this.elemData2=[];this.hyperCubeLayout.qDimensionInfo[1]?this.elemData2=u.default.getElemData(t,1):this.elemData2=[];this.colorValues=this.getColorValues(t);this.sizearr=u.default.getNumericData("size",t,this.hyperCubeLayout);this.labelArr=u.default.getStringOrNumber("label",t,this.hyperCubeLayout);var i=u.default.getMinMax("size",this.hyperCubeLayout);this.widthMinMax=false===this.layout.size.autoRadiusValueRange?[this.layout.size.radiusValueMin,this.layout.size.radiusValueMax]:i||[0,0];this.quantifyTo=Math.max(1,Math.min(this.layout.size.radiusMax-this.layout.size.radiusMin,100));this.widthRange=[this.layout.size.radiusMin,this.layout.size.radiusMax];var r={};var o={};this.geom=[];this.geomTypes=["UNKNOWN","UNKNOWN"];if(this.layout.path.startEndPoint){this.geom=[this.getGeometry(t,0,this.hyperCubeLayout),this.getGeometry(t,1,this.hyperCubeLayout)];this.geomTypes=[this.getLocationType(this.geom[0],this.layout.isLatLong),this.getLocationType(this.geom[1],this.layout.location2.isLatLong)]}else this.geom=[this.getPathGeometry(t,this.hyperCubeLayout)];var n=[];"NAMES"===this.geomTypes[0]&&this.addLocationSuffix(this.geom[0],t,this.layout.locationNamesAuto,this.hyperCubeLayout,"").forEach(function(e){e&&n.push([e])});"NAMES"===this.geomTypes[1]&&this.addLocationSuffix(this.geom[1],t,this.layout.location2.locationNamesAuto,this.hyperCubeLayout,"location2.").forEach(function(e){e&&n.push([e])});if(!this.dataset||!(this.dataset instanceof idevio.map.MemoryDataset)||this.dataset&&this.dataset.getCrs()!==this.map.crs){this.dataset=new idevio.map.MemoryDataset({name:this.name,crs:this.map.crs});this.layer.setDataset(this.dataset)}this.lookupNames(n,this,function(t){var i=Math.round((e.layout.size.radiusMin+e.layout.size.radiusMax)/2);for(var n=0;n<e.geom[0].length;n++){if(!e.geom[0][n])continue;var u=[];try{if(e.layout.path.startEndPoint){var p=e.getCoordinate(e.geomTypes[0],e.geom[0][n],t);var c=e.getCoordinate(e.geomTypes[1],e.geom[1][n],t);if(!p||!c)continue;u=d.default.makeLineArc(p,c,e.layout.size.curviness,"emptymeters"!==e.map.map.getBaseMap())}else u=l.default.parseGeometryString(e.geom[0][n])}catch(t){e.map.addError(s.default.INVALID_GEOMETRY,e,[e.layout.path.startEndPoint?e.geom[0][n]+" - "+e.geomTypes[1]:e.geomTypes[1]]);continue}if(u)try{var h=[e.elemData[n].id];e.elemData2&&e.elemData2[n]&&null!==e.elemData2[n].id&&void 0!==e.elemData2[n].id&&h.push(e.elemData2[n].id);var f="X"===e.elemData[n].state;var m=e.labelArr[n];var y=e.colorValues[n];var v=e.colorMap.getColor(e.elemData[n],y.value,n);var g=0;if(f)g=i;else if(e.layout.size.expression.key.length>0){var b=e.sizearr[n];g=null!==b?d.default.calculateSize(b,e.widthRange,e.widthMinMax,e.quantifyTo).size:NaN}else g=i;if(isNaN(g)){e.map.addError(s.default.INVALID_WIDTH,e);continue}o[String(h)]=g;r[String(h)]=v;var L="";L=e.elemData2[n]&&e.elemData2[n].dimValue?e.elemData[n].dimValue+" - "+e.elemData2[n].dimValue:e.elemData[n].dimValue;var D=new idevio.map.LineStringFeature(e.dataset,{coordinates:u,attributes:a.default.generateAttributeObject(String(h),L,m,{color:v,value:y.value,elemNo:y.elemNo},f,{size:e.sizearr.length?e.sizearr[n]:null})});null!=y.elemNo&&e.colorElemNos.add(y.elemNo);e.featureTable[String(h)]=D}catch(t){e.map.addError(s.default.INVALID_GEOMETRY,e,[u[n]])}}e.setStyle(r,o,i);e.done()})};t.prototype.setStyle=function(e,t,a){var i={type:"line",colorKey:"id",colors:e,widthKey:"id",widths:t,width:a};if(this.layout.size&&"none"!==this.layout.size.arrowDirection){var r={type:this.layout.size.arrowDirection,position:this.layout.size.arrowPosition/100};i.arrow=r}this.layer.setStyles([i,this.getLabelStyle()])};return t}(a.default);return p}.apply(t,i),void 0!==r&&(e.exports=r))},2166:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1321),a(1186),a(1038),a(1146),a(507),a(1341),a(109),a(91),a(511)],r=function(e,t,a,i,r,s,l,u,d,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);p=n(p);c=n(c);var h=function(e){o(t,e);function t(t,a,r,o){var n=e.call(this,t,a,r,o)||this;n.IS_SELECTABLE=false;n.layerName="geo.DensityLayer";n.name=r;n.layout=a;n.legend=new i.default(n);n.layer=new idevio.map.HeatmapLayer(n.map.map,{drawOrder:999});n.dataset=n.layer.getDataset();n.hardLimit=5e4;n.colors={color:[],dist:[]};var s=true;n.addMapListener("viewchanged",function(e){s=true});n.addMapListener("idle",function(e){if(s&&n.hyperCubeLayout&&n.isVisible()&&n.hyperCubeLayout.qDimensionInfo.length>0){n.legend.preDraw();n.legend.draw()}s=false});return n}t.prototype.doPaint=function(){var e=this.hyperCubeLayout.qDataPages;this.clearData();var t=[];var i="";for(var o in e){var n=e[o];if(!n.qMatrix)continue;var u=l.default.getElemData(n,0);var d=this.getGeometry(n,0,this.hyperCubeLayout);var p=l.default.getNumericData("weight",n,this.hyperCubeLayout);var c=d.length;"0"===o&&(i=this.makeOrChangeDataset(d,a.default.DEFAULT_COLUMNS.concat(["key","weight"]),this.layout.isLatLong,"Point"));switch(i){case"STRINGCOORDS":var h=d;for(var f=0;f<c;f++){if(null==h[f])continue;try{var m=p[f];if(null===m){this.map.addError(r.default.INVALID_WEIGHT,this);continue}var y=u[f].id;var v=s.default.parseGeometryString(h[f]);var g=new idevio.map.PointFeature(this.dataset,{coordinate:v,attributes:{weight:m}});this.featureTable[String(y)]=g}catch(e){this.map.addError(r.default.INVALID_GEOMETRY,this,[h[f]])}}break;case"NAMES":var b=this.addLocationSuffix(d,n,this.layout.locationNamesAuto,this.hyperCubeLayout);for(var f=0;f<c;f++){if(null==b[f])continue;try{var m=p[f];if(null===m){this.map.addError(r.default.INVALID_WEIGHT,this);continue}t.push([b[f],"","","","","","",m])}catch(e){this.map.addError(r.default.INVALID_GEOMETRY,this,[b[f]])}}break;case"LATLONGS":var L=d;for(var f=0;f<c;f++){if(null==L[f])continue;try{var m=p[f];if(null===m){this.map.addError(r.default.INVALID_WEIGHT,this);continue}var y=u[f].id;var g=new idevio.map.PointFeature(this.dataset,{coordinate:L[f],attributes:{weight:m}});this.featureTable[String(y)]=g}catch(e){this.map.addError(r.default.INVALID_GEOMETRY,this,[String(L[f])])}}break;case"UNKNOWN":this.map.addError(r.default.INVALID_GEOMETRY,this);break}}"NAMES"===i&&this.dataset.addData(t);this.setOptions();a.default.isLocationDataset(this.dataset)&&0!==e.length||this.done()};t.prototype.handleColor=function(e,t){var a=new d.default(e);a.setAlpha(t);return a.toRGBA()};t.prototype.getColorInfo=function(){var e=this.layout.color;return e.auto?this.getAutoColorInfo():this.getCustomColorInfo()};t.prototype.getAutoColorInfo=function(){var e=[];var t=u.default.get().scales[0].scale.filter(function(e){return"none"!==e});t.forEach(function(t){e.push(t)});e.push(t[t.length-1]);var a=[];for(var i=0;i<e.length-1;i++)a.push(i/(e.length-1));a.push(1);var r=[];var o=[];for(var i=0;i<e.length;i++){r.push(this.handleColor(e[i],i===e.length-1?0:this.layout.color.opacity));o.push(this.handleColor(e[i],i===e.length-1?0:1))}var n={color:r.reverse(),dist:a};this.colors={color:o.reverse(),dist:a};return n};t.prototype.getCustomColorInfo=function(){var e=this.layout.color;var t=e.segments.limits;var a=e.segments.colors;var i=e.segments.types;var r=[];var o=[];var n=[];var s=[];o.push(0);n.push(0,0);r.push(this.handleColor(a[0],0));s.push(this.handleColor(a[0],0));o.push(.05);r.push(this.handleColor(a[0],e.opacity));s.push(this.handleColor(a[0],1));if(1===a.length){o.push(1);n.push(1);r.push(this.handleColor(a[0],e.opacity))}else for(var l=0;l<t.length;l++){var u=l===t.length-1;var p=this.handleColor(a[l+1],e.opacity);var c=this.handleColor(a[l+1],1);var h=Math.max(t[l],.05);var f=i[l];if(u)if(f){var m=new d.default(r[r.length-1]);var y=new d.default(s[s.length-1]);var v=new d.default(a[l+1]);o.push(h);n.push(h);r.push(this.handleColor(m.blend(v,.5),e.opacity));s.push(this.handleColor(y.blend(v,.5),1))}else{o.push(h,h);n.push(h,h+.001);r.push(r[r.length-1],p);s.push(s[s.length-1],c)}else if(f){var g=h+(t[l+1]-h)/2;o.push(g);n.push(g);r.push(p);s.push(c)}else{o.push(h,h);n.push(h,h+.001);r.push(r[r.length-1],p);s.push(s[s.length-1],c)}if(u){o.push(1);n.push(1);r.push(p);s.push(c)}}this.colors={color:s,dist:n};return{color:r,dist:o}};t.prototype.setOptions=function(){var e=this.layout.weightRadius.radiusUnit;var t=this.layout.weightRadius.radius;var a=this.getColorInfo();switch(e){case"pixels":this.layer.setRadiusUnit("pixels");this.layer.setRadius(t);break;case"meters":this.layer.setRadiusUnit("meters");this.layer.setRadius(t);break;case"feet":this.layer.setRadiusUnit("meters");this.layer.setRadius(.3048*t);break}this.layer.setWeightAttribute("weight");this.layer.setAutoScale(this.layout.color.densityRangeAuto);this.layer.setCommonWeight(1);if(this.layer.setMaxDensityRange&&this.layer.setMinDensityRange)if(this.layout.color.densityRangeAuto){this.layer.setMaxDensityRange(1);this.layer.setMinDensityRange(0)}else{this.layer.setMaxDensityRange(this.layout.color.densityRangeMax);this.layer.setMinDensityRange(this.layout.color.densityRangeMin)}this.layer.setColors(a.color);this.layer.setColorDistribution(a.dist)};t.prototype.getColorLegendInfo=function(){this.getColorInfo();var e=this.layout.weightRadius.label;"libraryItem"===this.layout.weightRadius.expression.type?e=l.default.getDimensionExpressionTitle("weight",this.hyperCubeLayout)||"":""===this.layout.weightRadius.expression.key?e=p.default.get("properties.compression.density"):""===e&&""!==this.layout.weightRadius.expression.key&&(e=this.layout.weightRadius.expression.key);var t=0;var a=1;var i=this.layout.color;if(i.densityRangeAuto&&this.layer){t=0;a=this.layer.getMaxIntensity()}else{t=i.densityRangeMin;a=i.densityRangeMax}var r=this.expressionFormatters&&this.expressionFormatters["weight"];if(!r){var o=this.map.extensionObject.backendApi.localeInfo;r=new c.default(o,"",o.qThousandSep,o.qDecimalSep,"R");r.pattern=r.createPatternFromRange(t,a,true)}var n=this.colors?this.colors.dist.map(function(e){return e*Math.abs(a-t)+t}):[];return{color:this.colors?this.colors.color:[],domain:n,min:t,max:a,title:e,formatter:r,colorMode:"density",discrete:false,valid:Boolean(this.layer)}};return t}(a.default);t.default=h}.apply(t,i),void 0!==r&&(e.exports=r))},2167:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(123),a(1758),a(1146),a(1323)],r=function(e,t,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);var n=function(){function e(e){var t=this;this.on=false;this.listenerId=null;this.mapChart=e;var a=e.extensionObject.$scope;if(!a)return;var r=e.map;this.update();a.$on("navigationPressed",function(a,o){a.preventDefault();var n=Math.min(r.getDiv().offsetWidth,r.getDiv().offsetHeight)/6;switch(o){case"navRight":r.pan(n,0);break;case"navLeft":r.pan(-1*n,0);break;case"navUp":r.pan(0,n);break;case"navDown":r.pan(0,-1*n);break;case"zoomIn":r.zoomInOneLevel();break;case"zoomOut":r.zoomOutOneLevel();break;case"resetZoom":t.hide();e.layout.mapSettings.initialView&&!e.layout.autoZoomOnSelection?e.viewBounds(false,e.layout.mapSettings.initialView.bounds):e.viewBounds();new i.default(r).promise.then(function(){return t.watch()});break;default:break}})}e.prototype.update=function(){var e=this.mapChart.extensionObject.$scope;if(!e)return;var t=!this.mapChart.extensionObject.backendApi.isSnapshot&&(!!this.mapChart.layout.navigation||this.on);var i=this.mapChart.extensionObject.options;var r=false===i.navigation;e.navigationHomeOnly=!this.mapChart.layout.navigation;e.navigationDefaultPosition=!this.on;e.navigationDisabled=!t||r||i.interactionState!==a.default.ANALYSIS;e.navigationVisible=t&&!r;setTimeout(function(){return e.$apply()})};e.prototype.hide=function(){this.mapChart.map.removeListener(this.listenerId||"");this.listenerId=null;this.on=false;this.update()};e.prototype.show=function(){this.mapChart.map.removeListener(this.listenerId||"");this.listenerId=null;this.on=true;this.update()};e.prototype.watch=function(){var e=this;var t=this.mapChart.map.getGeoBounds();var a=this.mapChart.mapHomeBounds;var i=r.default.inside(a,t);var o=(t.max[0]-t.min[0])/(a.max[0]-a.min[0]);var n=(t.max[1]-t.min[1])/(a.max[1]-a.min[1]);var s=Math.min(n,o)<2;var l=this.mapChart.map.getCenter();var u=this.mapChart.map.getResolution();var d=Math.abs(u-this.mapChart.map.getMinResolution())<.1;var p=Math.abs(u-this.mapChart.map.getMaxResolution())<.1;var c=this.mapChart.map.getWrapLongitude();c&&!i&&(i=r.default.inside(a,r.default.shiftBounds(t,2*c,0)));if(!i&&!p||!s&&!(d||p)){this.show();return}if(null!=this.listenerId)return;this.listenerId=this.mapChart.map.addListener("viewchanged",function(t){r.default.equalsCoord(l,e.mapChart.map.getCenter())&&(0|u)===(0|e.mapChart.map.getResolution())||e.show()})};return e}();t.default=n}.apply(t,i),void 0!==r&&(e.exports=r))},2168:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1598)],r=function(e,t,a){"use strict";a=n(a);var i=function(e){o(t,e);function t(t,a,i,r){var o=e.call(this,t,a,i,r)||this;o.IS_SELECTABLE=false;o.layerName="geo.UnknownLayer";o.legend=null;o.name=i;return o}t.prototype.paint=function(){this.doPaint();return this.deferred.promise};t.prototype.doPaint=function(){this.done()};t.prototype.doRemove=function(){};t.prototype.fulfillsRequirements=function(){return false};return t}(a.default);return i}.apply(t,i),void 0!==r&&(e.exports=r))},2169:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(91),a(110),a(461),a(231),a(1038)],r=function(e,t,a,i,r,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);s=o(s);l=o(l);var u=function(){function e(e){var t=this;this.ready=false;this.mapChart=e;this.errorDiv=a.default(".map-error-div",e.parentDiv).attr("id","mapErrordiv-"+e.id);this.contentDiv=a.default(".map-error-content-div",this.errorDiv);this.iconDiv=a.default(".map-error-icon-div",this.errorDiv);this.errorDiv.click(function(){t.contentDiv.slideToggle("fast")});this.errorQueue=[]}e.prototype.setMapReady=function(e){this.ready=e;e&&this.errorQueue.length>0&&this.showErrors()};e.prototype.onStateChange=function(){this.mapChart.extensionObject.inEditState()?this.showErrors():this.errorDiv.hide()};e.prototype.handleError=function(e){e.errorLabel===l.default.UNSUCCESFULL_LOOKUP?this.handleUnsuccessFullLookups(e):this.pushOnErrorQueue(e);this.ready&&this.isInEditMode()&&this.showErrors()};e.prototype.pushOnErrorQueue=function(e){for(var t=0,a=this.errorQueue;t<a.length;t++){var i=a[t];if(i.errorLabel===e.errorLabel&&i.layer===e.layer){if(i.parameters&&e.parameters){i.parameters=i.parameters.concat(e.parameters);return true}return true}}this.errorQueue.push(e);return true};e.prototype.handleUnsuccessFullLookups=function(e){var t=[];var a=[];if(e.parameters)for(var i=0,r=e.parameters;i<r.length;i++){var o=r[i];o.indexOf("Unresolved:")>-1?t.push(o.slice(12)):o.indexOf("Ambiguous:")>-1?a.push(o.slice(11)):o.length>0&&t.push(o)}if(t.length>0){var n={errorLabel:l.default.UNSUCCESFULL_LOOKUP,layer:e.layer,parameters:t};this.pushOnErrorQueue(n)}if(a.length>0){var s={errorLabel:l.default.AMBIGUOUS_LOOKUP,layer:e.layer,parameters:a};this.pushOnErrorQueue(s)}};e.prototype.isInEditMode=function(){if(this.mapChart.extensionObject)return this.mapChart.extensionObject.inEditState();return false};e.prototype.showErrors=function(){this.contentDiv.empty();this.contentDiv.append("<p>&nbsp;</p>");var e=0;var t=false;for(var a=0,r=this.errorQueue;a<r.length;a++){var o=r[a];var n=this.getErrorLevel(o);var s="";if(o.parameters){var l=o.parameters.join(", ");l.length>200&&(l=l.substring(0,200)+"...");l="<span class='map-error-parameters'>"+l+"</span>";s=i.default.get(o.errorLabel,l)}else s=i.default.get(o.errorLabel);e=n>e?n:e;var u=this.getLayerDiv(o.layer);u.append("<p>"+s+"</p>");t=true}if(1===e){this.iconDiv.removeClass("map-error-error");this.iconDiv.addClass("map-error-warning")}else if(2===e){this.iconDiv.removeClass("map-error-warning");this.iconDiv.addClass("map-error-error")}!this.errorDiv.is(":visible")&&t?this.errorDiv.show():t||this.errorDiv.hide()};e.prototype.getErrorLevel=function(e){switch(e.errorLabel){case l.default.UNSUCCESFULL_LOOKUP:case l.default.LIMITED_DATA:return 0;case l.default.INVALID_GEOMETRY:return 1;case l.default.FAILED_LOOKUP:return 2}return 0};e.prototype.getLayerDiv=function(e){var t=this.contentDiv.find("#error-layer-"+e.id);if(t.length>0)return t;var r=i.default.get(e.layerName);var o="<div id='error-layer-"+e.id+"' >";e.layout&&e.layout.qHyperCube&&e.layout.qHyperCube.qDimensionInfo&&e.layout.qHyperCube.qDimensionInfo[0]&&(o=o+"<span class='map-error-layer-name'>"+e.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle+"</span>");o=o+" - "+r+"</div>";return a.default(o).appendTo(this.contentDiv)};e.prototype.clearErrors=function(){this.errorDiv.hide();this.contentDiv.empty();this.errorQueue=[]};e.prototype.clearqError=function(e){e.legend&&e.legend.setError()};e.prototype.handleqError=function(e,t){var a=this.getCustomErrorMessage(t.layout.qHyperCube)||s.default.getHyperCubeError(e);t.legend&&(e===r.default.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED?t.legend.setError("soft-error",a):t.legend.setError("hard-error",a,i.default.get("Object.Error")))};e.prototype.hasCalcConditionFailed=function(e){return e===r.default.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED};e.prototype.getCustomErrorMessage=function(e){var t=e.qError.qErrorCode;return t===r.default.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED?n.default.getLayoutMsg(e):""};e.createErrorEvent=function(e,t,a){return{errorLabel:e,layer:t,parameters:a}};e.mapScriptFailed=function(e){console.error(e.message)};return e}();t.default=u}.apply(t,i),void 0!==r&&(e.exports=r))},2170:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1321),a(2171),a(431),a(2172),a(1601),a(1600),a(96),a(225),a(232),a(102),a(1125),a(89),a(90)],r=function(e,t,a,i,r,s,l,u,d,p,c,h,f,m,y){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);p=n(p);c=n(c);h=n(h);f=n(f);m=n(m);y=n(y);var v="selection-toolbar.selectableLayers";var g=0;var b=function(e){o(t,e);function t(t){var a=e.call(this,t,{viewOption:"selections",isOff:function(){return!t.extensionObject.isOn()}})||this;a.startPressEvent=null;a.selectionMenuConfig={value:null};a.backendApi=a.mapChart.extensionObject.backendApi;a.selectionsApi=a.mapChart.extensionObject.selectionsApi;a.selectionsApi.watchDeactivated(a.deactivatedCallback.bind(a));a.selectionsApi.watchActivated(a.activatedCallback.bind(a));a.selectionsApi.clear=function(){a.clearSelections()};a.lassoToggled=false;a.circleToggled=false;a.selected=[];a.selectedLayer=null;a.shiftButtonPressed=false;a.clickSelected=false;a.lasso=new i.default(a.mapChart,a.lassoSelectCallback.bind(a));a.circle=new s.default(a.mapChart,a.circleSelectCallback.bind(a));var r=a.shiftToggle.bind(a);c.default.ShiftToggle.bind(r);a.unbindShiftToggle=function(){c.default.ShiftToggle.unbind(r)};a.keyPressed=a.keyPressedFn.bind(a);h.default.create(a,"Activated");h.default.create(a,"Cleared");return a}t.prototype.keyPressedFn=function(e){if(this.isSelectionActive()&&this.isSelectionToolbarEnabled())if(27===e)this.selectionsApi.cancel();else if(13===e){this.backendApi.endSelections(true);this.selectionsApi.deactivated()}};t.prototype.isSelectionToolbarEnabled=function(){var e=this.mapChart.extensionObject.options;return!u.default.isSelectionDisabled(this.mapChart)&&("object"!==typeof e.selections||true!==e.selections._disableSelectionActivation)};t.prototype.isSelectionActive=function(){return this.mapChart.extensionObject.inAnalysisState()&&this.mapChart.hasSelectableLayers()&&!u.default.isSelectionDisabled(this.mapChart)};t.prototype.press=function(e){(this.lassoIsActive()||this.circleIsActive())&&this.isSelectionActive()&&e.button===g&&(this.startPressEvent||(this.startPressEvent=e))};t.prototype.move=function(e){if((this.lassoIsActive()||this.circleIsActive())&&this.isSelectionActive()&&0===e.button){e.stop();if(this.startPressEvent){var t=[this.startPressEvent.clientX,this.startPressEvent.clientY];var a=[e.clientX,e.clientY];if(u.default.distanceBetweenPoints(t,a)>8){d.default.preventGestures();var i=this.getActiveSelectionTool();if(i){if(!i.isActive){i.activate();this.activate()}var r=e.clientX+this.mapChart.mapDiv.offset().left;var o=e.clientY+this.mapChart.mapDiv.offset().top;i.move(r,o)}}}}};t.prototype.setSelectOptionsValue=function(e){this.selectionMenuConfig.value=e};t.prototype.click=function(e){if(this.isSelectionActive()&&e.button===g){this.activate();e.target&&this.clickSelect(e.target)}};t.prototype.release=function(){this.startPressEvent=null;this.lasso.isActive&&this.lasso.release();this.circle.isActive&&this.circle.release()};t.prototype.destroy=function(){this.release();this.unbindShiftToggle();c.default.KeyPressed.unbind(this.keyPressed)};t.prototype.shiftToggle=function(e){this.shiftButtonPressed=e;this.selectionsApi.refreshToolbar()};t.prototype.activate=function(){var e=this;if(this.isSelectionActive()&&this.isSelectionToolbarEnabled()){this.Activated.emit();this.selectionsApi.activate();this.selectionCache=new Map;this.mapChart.layers.forEach(function(t){if(t instanceof a.default&&t.dataset&&null!=t.dataset){var i=t.dataset.getAll();i&&(i=i.filter(function(e){return!r.default.isExcluded(e)}));e.selectionCache&&e.selectionCache.set(t,i)}})}};t.prototype.legendSelect=function(e,t,a,i){var r=this;var o=f.default.selections(t,{},e.excludeLayout);var n=e.map.extensionObject.backendApi.model;if(!o.length)return;o.forEach(function(e){"selectHyperCubeValues"===e.method&&(e.params[2]=e.params[2].filter(function(e){return e>=0}))});if("selectHyperCubeValues"===o[0].method&&0===o[0].params[2].length)return;if("resetMadeSelections"===o[0].method){n.resetMadeSelections();this.clearSelections();return}e!==this.selectedLayer&&this.setSelectedLayer(e);var s=false;o.forEach(function(a){switch(a.method){case"selectHyperCubeValues":r.itemSelection(a,e,n);break;case"rangeSelectHyperCubeValues":var o=t.brushes();if(!o.length||!o[0].brush)return;var l=o[0].brush.ranges()[0];if(l){r.rangeHighlight(l,e,i);s=true}break;default:break}});s&&a&&t.brushes().length&&t.brushes()[0].brush.ranges().length&&this.sequentialCommit(e,t.brushes()[0].brush.ranges()[0])};t.prototype.itemSelection=function(e,t,a){var i=this;var r=e.params[0];e.params[0]="/qUndoExclude/gaLayers/"+t.index+r;var o=e.params[2];a[e.method].apply(a,e.params).then(function(e){if(e){i.selectionsApi.selectionsMade=true;i.legendHighlight(o,t,r)}else{a.resetMadeSelections();i.clearSelections()}}).catch(function(e){return console.error(e)})};t.prototype.rangeHighlight=function(e,t,a){this.selected=t.dataset.getAll().filter(function(i){if("ChartLayer"===t.layout.type){if("size"===a){var r=y.default.getValue(i.getAttributes(),"relSize");return null!=r&&Number(r)>=e.min&&Number(r)<=e.max}var o=i.getAttribute("parts")||[];return o.some(function(t){return t.id>=0&&Number(t.color.value)>=e.min&&Number(t.color.value)<=e.max})}var r=y.default.getValue(i.getAttributes(),a);return null!=r&&Number(r)>=e.min&&Number(r)<=e.max});this.updateHighlighting()};t.prototype.sequentialCommit=function(e,t,a){this.selectionsApi.selectionsMade=true;if(this.selected.length>0){if(this.selectedLayer===e)if("ChartLayer"===this.selectedLayer.layout.type){var i=[];this.selected.forEach(function(e){if("size"===a){var r=e.getAttribute("relSize");r>=t.min&&r<=t.max&&i.push(e.getAttribute("id"))}else{var o=e.getAttribute("parts")||[];for(var n=0;n<o.length;n++){var s=o[n];s.id>=0&&s.color.value>=t.min&&s.color.value<=t.max&&i.push(e.getAttribute("id")+","+s.id)}}});this.selectFeatures(i,e,false,true)}else{var r=[];this.selected.forEach(function(e){r.push(e.getAttribute("id"))});this.selectFeatures(r,e,false,true)}}else this.selectCache()};t.prototype.legendHighlight=function(e,t,a){var i=t.hyperCubeLayout.qDataPages;var r=Number(a.replace(/^.*\//,""));var o=a.indexOf("qAttributeDimensions")?"qAttrDims":"qAttrExps";var n=Number((/qDimensions\/(\d)\//.exec(a)||[])[1])||0;if(!i.length||!e.length||isNaN(r))return;this.selected=i[0].qMatrix.reduce(function(a,i){var s=i[n];if(!s)return a;var l=s[o];if(l&&-1!==e.indexOf(l.qValues[r].qElemNo)){var u=i[0].qElemNumber;t.layout.qHyperCube.qDimensionInfo.length>=2&&(u=[i[0].qElemNumber,i[1].qElemNumber]);a.push(t.featureTable[String(u)])}return a},[]).filter(Boolean);this.updateHighlighting()};t.prototype.clickSelect=function(e){if(e){var t=u.default.getLayerFromFeature(e,this.mapChart.layers);null==this.selectedLayer&&null!=t&&this.setSelectedLayer(t);if(t!==this.selectedLayer)return;if(u.default.isPoint(e)){var a=this._map.geoToDisplay(e.getCenter()),i=a[0],r=a[1];this._map.getFeaturesAt(i,r)}var o=e.getAttribute("id").split(",").map(function(e){return parseInt(e,10)});var n=o.every(function(e){return e<0});if(!n){var s=this.selected.indexOf(e);-1===s?this.selected.push(e):this.selected.splice(s,1)}if(this.selected.length>0){this.clickSelected=true;this.selectFilteredFeatures(this.selected,t)}else{this.clickSelected=false;this.selectCache()}}0===this.selected.length&&this.setSelectedLayer(null);this.selectionsApi.selectionsMade=this.selected.length>0;this.updateHighlighting()};t.prototype.setSelectedLayer=function(e){this.selectedLayer=e;this.setSelectOptionsValue(e&&e.id||null)};t.prototype.selectFeatures=function(e,t,a,i){var r=t.layout.qHyperCube.qDimensionInfo;var o=r.length;var n=t.getPath()||this.backendApi.path;var s=[];var l=[];for(var u=0;u<e.length;u++)if(e[u]&&e[u].length>0){var d=e[u].split(",").map(function(e){return parseInt(e,10)});!isNaN(d[0])&&d[0]>=0&&s.push(d[0]);2===o&&!isNaN(d[1])&&d[1]>=0&&l.push(d[1])}var p=[];if(o>=1){a&&0===r[0].qStateCounts.qSelected&&(s=[]);p.push(this.backendApi.selectValues(0,s,false,n))}if(o>=2&&("LineLayer"===t.layout.type||"ChartLayer"===t.layout.type&&i)){a&&0===r[1].qStateCounts.qSelected&&(l=[]);p.push(this.backendApi.selectValues(1,l,false,n))}var c=m.default.all(p).then(function(e){var t=false;for(var a=0;a<e.length;a++)if(true===e[a]){t=true;break}return t});return c};t.prototype.selectFilteredFeatures=function(e,t){var a=this;var i=e.filter(function(e){return e.getDataset()===a.selectedLayer.dataset});var r=[];i.forEach(function(e){r.push(e.getAttribute("id"))});this.selectFeatures(r,t,false,false)};t.prototype.processSelection=function(e){var t=this;if(e.length>0){this.selectedLayer||this.setSelectedLayer(u.default.getLayerFromFeature(e[0],this.mapChart.layers));this.selected=this.selected.concat(e.filter(function(e){return-1===t.selected.indexOf(e)}));this.selectionsApi.selectionsMade=this.selected.length>0;this.selected.length>0&&this.selectFilteredFeatures(this.selected,this.selectedLayer);this.updateHighlighting()}};t.prototype.selectCache=function(){if(!this.selectionCache)return;var e=this.selectionCache.keys();var t=e.next();var a=function(){if(t.value===i.selectedLayer&&i.selected.length>0||t.value.layout.qHyperCube.qDimensionInfo.length<1){t=e.next();return"continue"}var a=t.value;var r=i.selectionCache.get(a);if(r){var o=[];r.forEach(function(e){var t=e.getAttribute("id");var a=isNaN(t)&&t&&t.length>0||!isNaN(t);a&&o.push(t)});i.selectFeatures(o,a,true,false)}t=e.next()};var i=this;while(!t.done)a()};t.prototype.clearSelections=function(){this.setSelectedLayer(null);this.selectCache();this.selectionsApi.selectionsMade=false;this.reset()};t.prototype.reset=function(){this.selected=[];this.clickSelected=false;this.setSelectedLayer(null);this.updateHighlighting();this.Cleared.emit()};t.prototype.activatedCallback=function(){c.default.KeyPressed.bind(this.keyPressed)};t.prototype.deactivatedCallback=function(){this.reset();this.lassoToggled=false;this.circleToggled=false;this.lasso.deactivate();this.circle.deactivate();c.default.KeyPressed.unbind(this.keyPressed)};t.prototype.updateHighlighting=function(){var e=this;var t=this.selected.filter(function(t){var a=t.getAttribute("id").split(",").map(function(e){return parseInt(e,10)});var i=a.some(function(e){return e<0});return t.getDataset()===e.selectedLayer.dataset&&!i});this.mapChart.map.setHighlighted(t)};t.prototype._connecting=function(){var e=this;this._addListener("click",function(t){e.click(t)});this._addListener("dblclick",function(e){});this._addListener("press",function(t){e.press(t)});this._addListener("move",function(t){e.move(t)});this._addListener("release",function(t){e.release()})};t.prototype._disconnecting=function(){};t.prototype.circleSelectCallback=function(e,t,a){var i=this.mapChart.map;var r=i.getFeaturesWithin(a.min[0],a.min[1],a.max[0],a.max[1]).filter(function(a){if(u.default.isPolygon(a)){var r=a.getCoordinates();var o=[];for(var n=0;n<r.length;n++){o[n]=[];for(var s=0;s<r[n].length;s++){var l=i.geoToDisplay(r[n][s]);if(u.default.distanceBetweenPoints(e,l)<t)return true;o[n].push(l)}}for(var d=0;d<o.length;d++)if(u.default.pointInPolygon(e[0],e[1],o[d]))return true}else if(u.default.isLine(a)){var r=a.getCoordinates();var p=e[0];var c=e[1];for(var h=0;h<r.length;h++){var f=i.geoToDisplay(r[h])[0];var m=i.geoToDisplay(r[h])[1];var y=i.geoToDisplay(r[Math.min(h+1,r.length-1)])[0];var v=i.geoToDisplay(r[Math.min(h+1,r.length-1)])[1];if(u.default.lineCircleIntersect(f,m,y,v,p,c,t))return true}}else if(u.default.isPoint(a)){var g=i.geoToDisplay(a.getCoordinates());if(u.default.distanceBetweenPoints(e,g)<t)return true}return false});this.processSelection(r)};t.prototype.lassoSelectCallback=function(e,t){this.startPressEvent=null;if(!this.mapChart.hasFeatures())return;var a=u.default.isLassoClosed(e);var i=this.mapChart.map;var r=i.getFeaturesWithin(t.min[0],t.min[1],t.max[0],t.max[1]).filter(function(t){if(u.default.isPolygon(t)){var r=t.getCoordinates();var o=[];if(a)for(var n=0;n<r.length;n++){o[n]=[];for(var s=0;s<r[n].length;s++){o[n].push(i.geoToDisplay(r[n][s]));if(u.default.pointInPolygon(o[n][s][0],o[n][s][1],e))return true}}for(var l=0;l<e.length;l++)for(var d=0;d<r.length;d++){var p=i.displayToGeo(e[l]);var c=i.displayToGeo(e[Math.min(l+1,e.length-1)]);for(var h=0;h<r[d].length;h++){var f=r[d][h];var m=r[d][Math.min(h+1,r[d].length-1)];if(u.default.linesIntersect(p,c,f,m))return true}}}else if(u.default.isLine(t)){var r=t.getCoordinates();for(var n=1;n<r.length;n++){var p=i.geoToDisplay(r[n-1]);var c=i.geoToDisplay(r[n]);for(var s=1;s<e.length;s+=1){var f=e[s-1];var m=e[s];if(u.default.linesIntersect(p,c,f,m))return true}if(u.default.pointInPolygon(p[0],p[1],e))return true}}else if(u.default.isPoint(t)){var y=i.geoToDisplay(t.getCoordinates());if(a&&u.default.pointInPolygon(y[0],y[1],e))return true}return false});this.processSelection(r)};t.prototype.getActiveSelectionTool=function(){if(this.lassoIsActive())return this.lasso;if(this.circleIsActive())return this.circle;return null};t.prototype.getSelectableLayers=function(){return this.mapChart.layers.filter(function(e){return e instanceof a.default})};t.prototype.selectionsExist=function(){return!!this.mapChart.layout.qSelectionInfo.qMadeSelections};t.prototype.getSelectionMenuConfig=function(){var e=this;var t=this.getSelectableLayers();var a=t[0].id;var i=function(t){var a=t.value,i=void 0===a?"":a;if(""===i)return;var o=i;var n=r.default.getLayerFromId(o,e.mapChart.layers);if(!n)throw new Error("Layer with id: "+o+" does not exist");e.setSelectedLayer(n);e.updateHighlighting();e.selectCache();e.selectFilteredFeatures(e.selected,n)};return{name:"Tooltip.selectableLayers",tid:v,component:"select",value:this.selectedLayer?this.selectedLayer.id:a,options:t.filter(function(e){return e.layout.qHyperCube.qDimensionInfo.length>0&&e.IS_SELECTABLE}).map(function(e){return{label:e.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle+" - "+e.layout.type,value:e.id}}),items:t.filter(function(e){return e.layout.qHyperCube.qDimensionInfo.length>0}).map(function(e){return{name:e.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle+" - "+e.layout.type,action:i,value:e.id}}),show:function(a){return t.length>1&&e.selectionsExist()&&null!==a},isDisabled:function(){var t=e.mapChart.hasFeatures();var a=[];e.selected.forEach(function(t){var i=u.default.getLayerFromFeature(t,e.mapChart.layers);i&&-1===a.indexOf(i)&&a.push(i)});return e.clickSelected||!t||a.length<2},action:i,isIcon:false}};t.prototype.getSelectionToolbar=function(){var e=[];var t=this;this.selectionMenuConfig=this.getSelectionMenuConfig();e.push(this.selectionMenuConfig);e.push({name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:true,buttonClass:"sel-toolbar-icon-toggle",iconClass:"lui-icon lui-icon--lasso",action:function(){t.toggleLasso()},isActive:function(){this.name=t.lassoIsActive()?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection";return t.lassoIsActive()},isDisabled:function(){if(t.isLassoDisabled&&t.isLassoDisabled())return true;return false}});e.push({name:"Tooltip.ToggleOnCircleSelection",tid:"selection-toolbar.toggleCircle",isIcon:true,buttonClass:"sel-toolbar-icon-toggle",iconClass:"lui-icon lui-icon--radial-select",action:function(){t.toggleCircle()},isActive:function(){this.name=t.circleIsActive()?"Tooltip.ToggleOffCircleSelection":"Tooltip.ToggleOnCircleSelection";return t.circleIsActive()},isDisabled:function(){if(t.isCircleDisabled&&t.isCircleDisabled())return true;return false}});e.push({name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:true,buttonClass:"clear",iconClass:"lui-icon lui-icon--clear-selections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.selectionsApi.selectionsMade}});this.selectionToolbar=new p.default(this.backendApi,this.selectionsApi,false,false,e,[]);return this.selectionToolbar};t.prototype.lassoIsActive=function(){var e=this.mapChart.layout.mapSettings.selectionType;if(this.lassoToggled&&this.shiftButtonPressed)return false;if("lasso"===e&&this.shiftButtonPressed&&!this.lassoToggled&&!this.circleToggled)return true;return this.lassoToggled};t.prototype.toggleLasso=function(){this.lassoToggled=!this.lassoToggled;this.circleToggled=false};t.prototype.isLassoDisabled=function(){return false};t.prototype.circleIsActive=function(){var e=this.mapChart.layout.mapSettings.selectionType;if(this.circleToggled&&this.shiftButtonPressed)return false;if("circle"===e&&this.shiftButtonPressed&&!this.circleToggled&&!this.lassoToggled)return true;return this.circleToggled};t.prototype.toggleCircle=function(){this.circleToggled=!this.circleToggled;this.lassoToggled=false};t.prototype.isCircleDisabled=function(){return false};return t}(l.default);t.default=b}.apply(t,i),void 0!==r&&(e.exports=r))},2171:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(1759)],r=function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);var r=function(e){o(t,e);function t(t,a){var i=e.call(this,t)||this;i.pointsDrawn=[];i.isPolygonClosed=false;i.selectionCallback=a;return i}t.prototype.start=function(){this.pointsDrawn=[]};t.prototype.stop=function(){this.pointsDrawn=[]};t.prototype.doneDrawing=function(){this.isPolygonClosed&&this.pointsDrawn.push(this.pointsDrawn[0]);this.selectionCallback(this.pointsDrawn,this.rectangle)};t.prototype.draw=function(e,t){var i=a.default(this.canvas).offset().left;var r=a.default(this.canvas).offset().top;var o=this.canvas.getContext("2d");var n=this.startX-i;var s=this.startY-r;var l=e-i;var u=t-r;this.pointsDrawn.push([l,u]);this.rectangle.max[0]=e<this.rectangle.max[0]?this.rectangle.max[0]:e;this.rectangle.max[1]=t<this.rectangle.max[1]?this.rectangle.max[1]:t;this.rectangle.min[0]=e>this.rectangle.min[0]?this.rectangle.min[0]:e;this.rectangle.min[1]=t>this.rectangle.min[1]?this.rectangle.min[1]:t;o.clearRect(0,0,a.default(this.canvas).width()||0,a.default(this.canvas).height()||0);o.beginPath();o.strokeStyle="black";o.arc(n,s,8,0,2*Math.PI,false);o.fillStyle="#00bb00";o.fill();o.strokeStyle="#00bb00";o.stroke();o.beginPath();o.moveTo(n,s);for(var d=0;d<this.pointsDrawn.length;d++)o.lineTo(this.pointsDrawn[d][0],this.pointsDrawn[d][1]);if(this.pointsDrawn[0]){var p=Math.sqrt(Math.pow(this.pointsDrawn[0][0]-l,2)+Math.pow(this.pointsDrawn[0][1]-u,2));if(p<100){this.dashedLine(o,l,u,n,s,3);this.isPolygonClosed=true}else this.isPolygonClosed=false}o.strokeStyle="dimgray";o.lineWidth=2;o.stroke()};t.prototype.dashedLine=function(e,t,a,i,r,o){"undefined"===typeof o&&(o=2);e.moveTo(t,a);var n=i-t;var s=r-a;var l=Math.floor(Math.sqrt(n*n+s*s)/o);var u=n/l;var d=s/l;var p=0;while(p++<l){t+=u;a+=d;e[p%2===0?"moveTo":"lineTo"](t,a)}e[p%2===0?"moveTo":"lineTo"](i,r)};return t}(i.default);t.default=r}.apply(t,i),void 0!==r&&(e.exports=r))},2172:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(11),a(1759),a(1600)],r=function(e,t,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);var s=function(e){o(t,e);function t(t,a){var i=e.call(this,t)||this;i.radius=0;i.selectionCallback=a;return i}t.prototype.start=function(){};t.prototype.stop=function(){};t.prototype.doneDrawing=function(){var e=a.default(this.canvas).offset().left;var t=a.default(this.canvas).offset().top;var i=this.startX-e;var r=this.startY-t;this.rectangle.max[0]=i+this.radius;this.rectangle.max[1]=r+this.radius;this.rectangle.min[0]=i-this.radius;this.rectangle.min[1]=r-this.radius;this.selectionCallback([i,r],this.radius,this.rectangle)};t.prototype.draw=function(e,i){var o=a.default(this.canvas).offset().left;var n=a.default(this.canvas).offset().top;var s=this.canvas.getContext("2d");var l=this.startX-o;var u=this.startY-n;var d=e-o;var p=i-n;var c=Math.sqrt(Math.pow(l-d,2)+Math.pow(u-p,2));s.clearRect(0,0,a.default(this.canvas).width()||0,a.default(this.canvas).height()||0);s.beginPath();s.strokeStyle="black";s.arc(l,u,c,0,2*Math.PI,false);s.stroke();var h=Math.round(this.mapChart.map.getDistanceInMeters([l,u],[d,p]));var f=h.toFixed(0);var m="m";if(this.mapChart.layout.mapSettings.useImperialUnits){h*=t.FEET_IN_METER;m="ft";if(h>t.FEET_IN_MILE){h/=t.FEET_IN_MILE;m="mi"}f=h.toFixed(h<10?1:0)}else if(h>1e3){h/=1e3;m="km";f=h.toFixed(h<10?1:0)}this.radius=r.default.distanceBetweenPoints([this.startX,this.startY],[e,i]);var y=f+m;s.fillStyle="black";s.font="bold 11pt sans-serif";s.textAlign="center";s.textBaseline="middle";s.strokeStyle="white";s.lineWidth=1.5;s.strokeText(y,l,u);s.fillText(y,l,u)};t.FEET_IN_METER=3.28084;t.FEET_IN_MILE=5280;return t}(i.default);t.default=s}.apply(t,i),void 0!==r&&(e.exports=r))},2173:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(198),a(101)],r=function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);var r=function(e){o(t,e);function t(t){return e.call(this,t)||this}t.prototype.init=function(t){e.prototype.init.call(this,t)};t.prototype.getSize=function(){return i.default.getValue(this.model.layout,this.dataPath.replace(new RegExp("/","g"),".")).qSize};t.prototype.getRowCount=function(){return i.default.getValue(this.model.layout,this.dataPath.replace(new RegExp("/","g"),".")).qSize.qcy};t.prototype.getData=function(e,t){return this.model.getHyperCubeData(e,t)};t.prototype.beginSelections=function(){var e=this.model;var t=[];for(var a=0;a<e.layout.gaLayers.length;++a)t.push("/qUndoExclude/gaLayers/"+a+"/qHyperCubeDef");return e.app.switchModalSelection(e,t)};t.prototype.selectValues=function(e,t,a,i){return this.model.selectHyperCubeValues(i||this.path,e,t,a)};return t}(a.default);t.default=r}.apply(t,i),void 0!==r&&(e.exports=r))},2174:function(e,t,a){var i,r;var o=this&&this.__extends||function(){var e=function(t,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return e(t,a)};return function(t,a){e(t,a);function i(){this.constructor=t}t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(421),a(1754),a(123),a(1045),a(1760),a(1463),a(1522),a(89),a(1262),a(1757),a(2175)],r=function(e,t,a,i,r,s,l,u,d,p,c,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=n(a);i=n(i);r=n(r);s=n(s);l=n(l);u=n(u);d=n(d);p=n(p);c=n(c);h=n(h);f=n(f);var m=function(e){o(t,e);function t(t,a,i,r,o){var n=e.call(this,t,a,i,r,o)||this;n._on=false;n._inAnalysisState=false;n._inEditState=false;n._derivedProperties=new s.default;n.generateDerivedProperties=function(e,t){t.gaVersion!==l.default.VERSION&&l.default.migrateProperties(t);t.qUndoExclude.gaLayers=t.gaLayers.map(function(e){return h.default.generateHyperCube(e)});return p.default.resolve()};n.backendApi=r;n.selectionsApi=o;n.element=a;window.mapChartViewBounds||(window.mapChartViewBounds={});n._disclaimer=new d.default(i);return n}t.prototype.init=function(t,a,i,r,o){e.prototype.init.call(this,t,a,i,r,o);this.selectionsApi=o;this.element=a};t.prototype.setInteractionState=function(t){e.prototype.setInteractionState.call(this,t);this._inEditState=t===r.default.EDIT;this._inAnalysisState=t===r.default.ANALYSIS;this._inEditState&&u.default.load();this._inAnalysisState&&!this._on?this.on():!this._inAnalysisState&&this._on&&this.off();this.mapChart&&this.mapChart.onStateChange()};t.prototype.inAnalysisState=function(){return this._inAnalysisState};t.prototype.inEditState=function(){return this._inEditState};t.prototype.destroy=function(){if(this.mapChart){window.mapChartViewBounds[this.mapChart.id]={center:this.mapChart.map.getCenter(),resolution:this.mapChart.map.getResolution()};this.mapChart.destroy()}};t.prototype.updateData=function(e){this.mapChart||(this.mapChart=new i.default(this.element,e,this));this._inEditState&&u.default.load();return this.mapChart.updateData(e)};t.prototype.getDisclaimerAttributes=function(){var e=this.mapChart&&this.mapChart.isLimitedData()?this.mapChart.getLimitedLayout():null;return{data:e,supportedDisclaimers:{DataRangeIncludingZero:false,LimitedData:true,NegativeOrZeroValues:false,NoDataExist:false,OnlyNanColor:false,OnlyNanData:false,OnlyNegativeOrZeroValues:false},options:{bottom:true,paddingBottom:true,supportNegative:true,explicitOnlyNanData:false,explicitNoDataExist:false,explicitLimitedData:null!=e}}};t.prototype.paint=function(e,t){var a=this;if(!this.mapChart)return;var i=this.mapChart.paint();var r=this.getDisclaimerAttributes();this._disclaimer.set(r);this._disclaimer.display(this.mapChart.mapDiv);this.mapChart.parentDiv.find(".disclaimer").toggleClass("showing",Boolean(r.data));setTimeout(function(){a.mapChart&&a.mapChart.map.repaint()},150);return i};t.prototype.resize=function(){this.mapChart&&this.mapChart.onResize()};t.prototype.setSnapshotData=function(e){if(!this.mapChart)return;var t=this.mapChart.layout.snapshotData;if(t&&t.viewFocus&&t.viewFocus.bounds&&t.layers)return;var a=this.mapChart.map.getGeoBounds();a&&(e.snapshotData.viewFocus={bounds:{min:[a.min[0],a.min[1]],max:[a.max[0],a.max[1]]}});var i=this.mapChart.layers;var r={};var o=function(e){var t=i[e];r[t.id]={visible:t.isInVisibleRange(),colorSnapshotData:{}};if(t instanceof c.default){var a=t.colorMap.getComboColorMap();var o=a.getSnapshotChartData();o.forEach(function(e){r[t.id].colorSnapshotData[e.key]=e.data})}};for(var n=0;n<i.length;n++)o(n);e.snapshotData.layers=r};t.prototype.getViewState=function(){if(!this.mapChart)return;return f.default.getViewState(this.mapChart)};t.prototype.on=function(){this._on=true};t.prototype.off=function(){this._on=false};t.prototype.isOn=function(){return this._on};t.prototype.getSelectionToolbar=function(){if(this.mapChart&&this.mapChart.selectTool)return this.mapChart.selectTool.getSelectionToolbar()};t.prototype.suppressOnPaint=function(e){return e.qSelectionInfo&&e.qSelectionInfo.qInSelections};t.prototype.initialize=function(){};t.prototype.refreshSelections=function(){};t.prototype.updateDerivedProperties=function(e,t){var a=this.backendApi.model;var i=e.gaLayers?{gaVersion:e.gaVersion,layersData:e.gaLayers.map(function(e){if("GeodataLayer"===e.type)return{};var t={dimension:e.qHyperCubeDef,location:e.locationOrLatitude,locationType:e.locationType,isLatLong:e.isLatLong,locationNamesAuto:e.locationNamesAuto,locationCountry:e.locationCountry,locationAdmin1:e.locationAdmin1,locationAdmin2:e.locationAdmin2,label:e.label,color:e.color};if("PointLayer"===e.type){var a=e;t.isLatLong=a.isLatLong;t.longitude=a.longitude;t.size=a.size.expression;2===e.qHyperCubeDef.qDimensions.length&&(t.reuseDim2Fix=true);isNaN(a.color.outlineOpacity)&&(t.color.outlineOpacity=a.color.opacity)}if("LineLayer"===e.type){var a=e;t.isLatLong=a.isLatLong;t.longitude=a.longitude;t.size=a.size.expression;t.path=a.path;t.location2=a.location2}if("DensityLayer"===e.type){var a=e;t.isLatLong=a.isLatLong;t.longitude=a.longitude;t.weightRadius=a.weightRadius}if("AreaLayer"===e.type){var a=e;isNaN(a.color.outlineOpacity)&&(t.color.outlineOpacity=a.color.opacity)}if("ChartLayer"===e.type){var a=e;t.isLatLong=a.isLatLong;t.longitude=a.longitude;t.size=a.size.expression;isNaN(a.color.outlineOpacity)&&(t.color.outlineOpacity=a.color.opacity)}return t})}:"migrated map, will generate";var r=this.generateDerivedProperties;var o={layout:t,properties:e,model:a,hashData:i,generateDerivedProperties:r};return this._derivedProperties.updateDerivedProperties(o)};return t}(a.default);t.default=m}.apply(t,i),void 0!==r&&(e.exports=r))},2175:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1756)],r=function(e,t,a){"use strict";a=o(a);var i;(function(e){function t(e){var t=i(e);var a=r(e);var n=o(e);return{bounds:t,sidebarScrollOffset:a,layers:n}}e.getViewState=t;function i(e){return e.map.getGeoBounds()}function r(e){var t=e.sidebar.element.scrollTop();var a=e.sidebar.element.scrollLeft();return{top:t||0,left:a||0}}function o(e){var t={};for(var a=0;a<e.layers.length;a++){var i=e.layers[a];t[i.id]={legendScrollOffset:i.legend?n(i.legend):void 0}}return t}function n(e){for(var t=0;t<e.components.length;t++){var i=e.components[t];if(i instanceof a.default&&void 0!==i.getLegendScrollOffset())return i.getLegendScrollOffset()}return 0}})(i||(i={}));return i}.apply(t,i),void 0!==r&&(e.exports=r))},2176:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(91),a(879),a(1115),a(90),a(431),a(1463)],r=function(e,t,a,i,r,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);s=o(s);l=o(l);var u=function(){function e(e,t,a,i,r){this.builder=e;this.mapChartHandler=t;this.model=a;this.showMenu=i;this.object=r;this.field={name:"",label:"",isMasterItem:false,type:"",id:""};this.init();this.createDropMenu()}e.prototype.init=function(){if("field"===this.builder.item.type){this.field.isMasterItem=false;this.field.name=this.builder.item.id;this.field.label=this.builder.item.name;this.field.type=this.builder.item.type}else{this.field.isMasterItem=true;this.field.name=this.builder.item.id;this.field.label=this.builder.item.name;this.field.id=this.builder.item.id;this.field.type=this.builder.item.type}};e.prototype.createDropMenu=function(){this.model+this.object;if("measure"!==this.field.type&&"expression"!==this.field.type){var e=l.default.getRecommendedLayerTypeByTags(this.field.name);var t=this.builder.menu.addItem({translation:"geo.dropmenu.newLayer"});for(var i in e){if(!s.default.validLayerType(i))continue;e[i]&&this.addMenuItem(t,["geo.dropmenu.addRecommended"+i,[]],"add",this.addNewLayer,[i])}for(var i in e){if(!s.default.validLayerType(i))continue;e[i]||this.addMenuItem(t,["geo.dropmenu.add"+i,[]],"add",this.addNewLayer,[i])}}var r=this.builder.menu;var o=this.mapChartHandler.properties.gaLayers;for(var n in o){var u=o[n];if("GeodataLayer"===u.type)continue;var d=this.mapChartHandler.layout.gaLayers[n].qHyperCube.qDimensionInfo[0];var p="";var c=[];if(d){p="H"===d.qGrouping?d.title:d.qFallbackTitle;c[0]=p;var h=this.mapChartHandler.layout.gaLayers[n].qHyperCube.qDimensionInfo[1];if(h)if("H"===h.qGrouping){p=p+" - "+h.title;c[1]=h.title}else{p=p+" - "+h.qFallbackTitle;c[1]=h.qFallbackTitle}}else p=a.default.get("geo.dropmenu.noName");var f=void 0;if(s.default.validLayerType(u.type)){f=this.addSubMenu(r,["geo.dropmenu.useInLayer",[p,a.default.get("geo."+u.type)]],"submenu");switch(u.type){case"PointLayer":this.addPointLayerMenu(f,u,c);break;case"AreaLayer":this.addAreaLayerMenu(f,u,c);break;case"LineLayer":this.addLineLayerMenu(f,u,c);break;case"DensityLayer":this.addDensityLayerMenu(f,u,c);break;case"ChartLayer":this.addChartLayerMenu(f,u,c);break}}}this.showMenu()};e.prototype.addPointLayerMenu=function(e,t,a){var i=this.field.label;var r=t.qHyperCubeDef.qDimensions[0];switch(this.field.type){case"field":r?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[0]]],"replace",this.addDimensionFieldOption,[t,0]):this.addMenuItem(e,["geo.dropmenu.addDimension",[i]],"add",this.addDimensionFieldOption,[t,0]);this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);var o=this.addSubMenu(e,["geo.dropmenu.sizeBy",[]],"size-by");this.addExpressionFieldOptionMenu(o,"size-by",t);var n=this.addSubMenu(e,["contextMenu.colorByFieldMenu",[]],"add");this.addMenuItem(n,["contextMenu.colorByDimension",[i]],"color-by",this.addColorByDimension,[t]);var s=this.addSubMenu(n,["contextMenu.colorByMeasure",[]],"color-by");this.addMeasureFieldOptionMenu(s,"color-by",t);break;case"dimension":r?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[0]]],"replace",this.addDimensionFieldOption,[t,0]):this.addMenuItem(e,["geo.dropmenu.addDimension",[i]],"add",this.addDimensionFieldOption,[t,0]);this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addColorByDimension,[t]);break;case"measure":this.addMenuItem(e,["geo.dropmenu.sizeByLibraryItem",[i]],"size-by",this.addMeasureFieldOptionMasterItem,["size-by",t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break;case"expression":this.addMenuItem(e,["geo.dropmenu.sizeByLibraryItem",[i]],"size-by",this.addMeasureFieldOptionMasterItem,["size-by",t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break}};e.prototype.addAreaLayerMenu=function(e,t,a){var i=this.field.label;var r=t.qHyperCubeDef.qDimensions[0];switch(this.field.type){case"field":r?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[0]]],"replace",this.addDimensionFieldOption,[t,0]):this.addMenuItem(e,["geo.dropmenu.addDimension",[i]],"add",this.addDimensionFieldOption,[t,0]);this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);var o=this.addSubMenu(e,["contextMenu.colorByFieldMenu",[]],"add");this.addMenuItem(o,["contextMenu.colorByDimension",[i]],"color-by",this.addColorByDimension,[t]);var n=this.addSubMenu(o,["contextMenu.colorByMeasure",[]],"color-by");this.addMeasureFieldOptionMenu(n,"color-by",t);break;case"dimension":r?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[0]]],"replace",this.addDimensionFieldOption,[t,0]):this.addMenuItem(e,["geo.dropmenu.addDimension",[i]],"add",this.addDimensionFieldOption,[t,0]);this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addColorByDimension,[t]);break;case"measure":this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break;case"expression":this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break}};e.prototype.addLineLayerMenu=function(e,t,a){var i=this.field.label;var r=0;switch(this.field.type){case"field":r=t.qHyperCubeDef.qDimensions.length<1?1:2;for(var o=0;o<r;o++){var n=t.qHyperCubeDef.qDimensions[o];var s="";s=0===o?"geo.dropmenu.addDimension":"geo.dropmenu.addDimension2";n?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[o]]],"replace",this.addDimensionFieldOption,[t,o]):this.addMenuItem(e,[s,[i]],"add",this.addDimensionFieldOption,[t,o])}this.addMenuItem(e,["geo.dropmenu.addStartPoint",[i]],"add",this.addLocationFieldOption,[t,t]);this.addMenuItem(e,["geo.dropmenu.addEndPoint",[i]],"add",this.addLocationFieldOption,[t.location2,t]);this.addMenuItem(e,["geo.dropmenu.addLineGeometry",[i]],"add",this.addLocationPathFieldOption,[t]);var l=this.addSubMenu(e,["geo.dropmenu.widthBy",[]],"size-by");this.addExpressionFieldOptionMenu(l,"size-by",t);var u=this.addSubMenu(e,["contextMenu.colorByFieldMenu",[]],"add");this.addMenuItem(u,["contextMenu.colorByDimension",[i]],"color-by",this.addColorByDimension,[t]);var d=this.addSubMenu(u,["contextMenu.colorByMeasure",[]],"color-by");this.addMeasureFieldOptionMenu(d,"color-by",t);break;case"dimension":r=t.qHyperCubeDef.qDimensions.length<1?1:2;for(var o=0;o<r;o++){var n=t.qHyperCubeDef.qDimensions[o];var s="";s=0===o?"geo.dropmenu.addDimension":"geo.dropmenu.addDimension2";n?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[o]]],"replace",this.addDimensionFieldOption,[t,o]):this.addMenuItem(e,[s,[i]],"add",this.addDimensionFieldOption,[t,o])}this.addMenuItem(e,["geo.dropmenu.addStartPoint",[i]],"add",this.addLocationFieldOption,[t,t]);this.addMenuItem(e,["geo.dropmenu.addEndPoint",[i]],"add",this.addLocationFieldOption,[t.location2,t]);this.addMenuItem(e,["geo.dropmenu.addLineGeometry",[i]],"add",this.addLocationPathFieldOption,[t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addColorByDimension,[t]);break;case"measure":this.addMenuItem(e,["geo.dropmenu.widthByLibraryItem",[i]],"size-by",this.addMeasureFieldOptionMasterItem,["size-by",t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break;case"expression":this.addMenuItem(e,["geo.dropmenu.widthByLibraryItem",[i]],"size-by",this.addMeasureFieldOptionMasterItem,["size-by",t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break}};e.prototype.addDensityLayerMenu=function(e,t,a){var i=this.field.label;var r=t.qHyperCubeDef.qDimensions[0];switch(this.field.type){case"field":r?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[0]]],"replace",this.addDimensionFieldOption,[t,0]):this.addMenuItem(e,["geo.dropmenu.addDimension",[i]],"add",this.addDimensionFieldOption,[t,0]);this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);var o=this.addSubMenu(e,["geo.properties.weightField",[]],"weight-by");this.addExpressionFieldOptionMenu(o,"weight-by",t);break;case"dimension":r?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[0]]],"replace",this.addDimensionFieldOption,[t,0]):this.addMenuItem(e,["geo.dropmenu.addDimension",[i]],"add",this.addDimensionFieldOption,[t,0]);this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);break;case"measure":this.addMenuItem(e,["geo.dropmenu.weightByLibraryItem",[i]],"weight-by",this.addMeasureFieldOptionMasterItem,["weight-by",t]);break;case"expression":this.addMenuItem(e,["geo.dropmenu.weightByLibraryItem",[i]],"weight-by",this.addMeasureFieldOptionMasterItem,["weight-by",t]);break}};e.prototype.addChartLayerMenu=function(e,t,a){var i=this.field.label;var r=0;switch(this.field.type){case"field":r=t.qHyperCubeDef.qDimensions.length<1?1:2;for(var o=0;o<r;o++){var n=t.qHyperCubeDef.qDimensions[o];var s="";s=0===o?"geo.dropmenu.addDimension":"geo.dropmenu.addDimension2";n?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[o]]],"replace",this.addDimensionFieldOption,[t,o]):this.addMenuItem(e,[s,[i]],"add",this.addDimensionFieldOption,[t,o])}this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);var l=this.addSubMenu(e,["contextMenu.addFieldAsMeasure",[]],"measure-by");this.addExpressionFieldOptionMenu(l,"measure-by",t);var u=this.addSubMenu(e,["geo.dropmenu.sizeBy",[]],"size-by");this.addExpressionFieldOptionMenu(u,"size-by",t);var d=this.addSubMenu(e,["contextMenu.colorByFieldMenu",[]],"add");this.addMenuItem(d,["contextMenu.colorByDimension",[i]],"color-by",this.addColorByDimension,[t]);var p=this.addSubMenu(d,["contextMenu.colorByMeasure",[]],"color-by");this.addMeasureFieldOptionMenu(p,"color-by",t);break;case"dimension":r=t.qHyperCubeDef.qDimensions.length<1?1:2;for(var o=0;o<r;o++){var n=t.qHyperCubeDef.qDimensions[o];var s="";s=0===o?"geo.dropmenu.addDimension":"geo.dropmenu.addDimension2";n?this.addMenuItem(e,["geo.dropmenu.replaceDimension",[a[o]]],"replace",this.addDimensionFieldOption,[t,o]):this.addMenuItem(e,[s,[i]],"add",this.addDimensionFieldOption,[t,o])}this.addMenuItem(e,["geo.dropmenu.addLocation",[i]],"add",this.addLocationFieldOption,[t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addColorByDimension,[t]);break;case"measure":this.addMenuItem(e,["contextMenu.add",[i]],"measure-by",this.addMeasureFieldOptionMasterItem,["measure-by",t]);this.addMenuItem(e,["geo.dropmenu.sizeByLibraryItem",[i]],"size-by",this.addMeasureFieldOptionMasterItem,["size-by",t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break;case"expression":this.addMenuItem(e,["geo.dropmenu.sizeByLibraryItem",[i]],"size-by",this.addMeasureFieldOptionMasterItem,["size-by",t]);this.addMenuItem(e,["contextMenu.colorBy",[i]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",t]);break}};e.prototype.addSubMenu=function(e,t,i){e.addItem({translation:a.default.get(t[0],t[1]),tid:i});var r=e.items.length-1;return e.items[r]};e.prototype.addMenuItem=function(e,t,i,r,o){var n=this;e.addItem({translation:a.default.get(t[0],t[1]),tid:i,select:function(){r.apply(n,o)}})};e.prototype.createNewItem=function(){var e;switch(this.field.type){case"field":e=this.mapChartHandler.createFieldDimension(this.field.name,this.field.label);break;case"dimension":e=this.mapChartHandler.createLibraryDimension(this.field.id);break;case"measure":e=this.mapChartHandler.createLibraryMeasure(this.field.id);break;case"expression":e=this.mapChartHandler.createExpressionMeasure(this.field.name,this.field.label);break}return e};e.prototype.addColorByDimension=function(e){this.field.isMasterItem?e.color.byDimDef={label:this.field.label,key:this.field.name,type:"libraryItem"}:e.color.byDimDef={label:this.field.label,key:this.field.name,type:"expression"};e.color.altLabel=this.field.label;e.color.auto=false;e.color.colorExpression="";e.color.expressionIsColor=true;e.color.mode="byDimension";e.color.useDimColVal=false;this.saveModel()};e.prototype.addNewLayer=function(e){var t=this.createNewItem();var a=this.mapChartHandler.properties;var o={PointLayer:r.default.POINT,AreaLayer:r.default.AREA,LineLayer:r.default.LINE,DensityLayer:r.default.DENSITY,ChartLayer:r.default.CHART}[e];var l=i.default.getInitialProperties(o);l.cId=n.default.generateId();l.qHyperCubeDef.qInterColumnSortOrder=[0];s.default.insertLayer(l,a.gaLayers);t.qDef.cId=n.default.generateId();l.qHyperCubeDef.qDimensions[0]=t;var u;u="ChartLayer"===l.type?i.default.getChartLayerDataSection():"LineLayer"===l.type?i.default.getDataSection(2):i.default.getDataSection(1);u.items.data.dimension.add(t,l,this.mapChartHandler);this.saveModel()};e.prototype.addDimensionFieldOption=function(e,t){var a=this.createNewItem();a.qDef.cId=n.default.generateId();e.qHyperCubeDef.qDimensions[t]=a;var r=e.qHyperCubeDef.qDimensions.length;var o=e.qHyperCubeDef.qMeasures.length;e.qHyperCubeDef.qInterColumnSortOrder=this.calcInterSortOrder(r,o);var s;s="ChartLayer"===e.type?i.default.getChartLayerDataSection():"LineLayer"===e.type?i.default.getDataSection(2):i.default.getDataSection(1);s.items.data.dimension.add(a,e,this.mapChartHandler);this.saveModel()};e.prototype.addLocationFieldOption=function(e,t){var a=n.default.escapeField(this.field.name);if(this.field.isMasterItem){e.locationOrLatitude.key=a;e.locationOrLatitude.label="";e.locationOrLatitude.type="libraryItem";e.locationDefault=a}else{e.locationOrLatitude.key=a;e.locationOrLatitude.label=a;e.locationOrLatitude.type="expression";e.locationDefault=a}t&&t.path&&(t.path.startEndPoint=true);void 0!==e.isLatLong&&(e.isLatLong=l.default.fieldHasOneOfTags(this.field.name,["$numeric","$geolatitude"]));this.saveModel()};e.prototype.addLocationPathFieldOption=function(e){var t=n.default.escapeField(this.field.name);if(e.path){e.path.startEndPoint=false;if(this.field.isMasterItem){e.path.field.key=t;e.path.field.label="";e.path.field.type="libraryItem";e.path.locationDefault=t}else{e.path.field.key=t;e.path.field.label=t;e.path.field.type="expression";e.path.locationDefault=t}}this.saveModel()};e.prototype.addMeasureFieldOptionMasterItem=function(e,t){var a="";var r;a=this.field.isMasterItem?"libraryItem":"expression";r={key:this.field.id,type:a};switch(e){case"size-by":this.field.isMasterItem||(r["label"]=this.field.label);t.size.expression=r;break;case"color-by":t.color.auto=false;t.color.byMeasureDef=r;t.color.mode="byMeasure";break;case"weight-by":t.weightRadius.expression=r;break;case"measure-by":var o=this.createNewItem();o.qDef.cId=n.default.generateId();o.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1};t.qHyperCubeDef.qMeasures[0]=o;var s=t.qHyperCubeDef.qDimensions.length;var l=t.qHyperCubeDef.qMeasures.length;t.qHyperCubeDef.qInterColumnSortOrder=this.calcInterSortOrder(s,l);var u=i.default.getChartLayerDataSection();u.items.data.measure.add(o,t,this.mapChartHandler);break;default:return}this.saveModel()};e.prototype.addMeasureFieldOptionMenu=function(e,t,a){var i=this;var r=n.default.escapeField(this.field.name);var o=["Sum","Count","Avg","Min","Max"];var s=function(n){var s=o[n]+"("+r+")";e.addItem({label:s,tid:o[n].toLowerCase(),select:function(){switch(t){case"color-by":a.color.auto=false;a.color.byMeasureDef={label:s,key:s,type:"expression"};a.color.mode="byMeasure";break;default:return}i.saveModel()}})};for(var l=0;l<o.length;l++)s(l)};e.prototype.addExpressionFieldOptionMenu=function(e,t,a){var r=this;var o=n.default.escapeField(this.field.name);var s=["Sum","Count","Avg","Min","Max"];var l=function(l){var u=s[l]+"("+o+")";e.addItem({label:u,tid:s[l].toLowerCase(),select:function(){switch(t){case"size-by":a.size.expression={label:u,key:u,type:"expression"};break;case"weight-by":a.weightRadius.expression={label:u,key:u,type:"expression"};break;case"measure-by":var e=r.mapChartHandler.createExpressionMeasure(u);e.qDef.cId=n.default.generateId();e.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1};a.qHyperCubeDef.qMeasures[0]=e;var o=a.qHyperCubeDef.qDimensions.length;var s=a.qHyperCubeDef.qMeasures.length;a.qHyperCubeDef.qInterColumnSortOrder=r.calcInterSortOrder(o,s);var l=i.default.getChartLayerDataSection();l.items.data.measure.add(e,a,r.mapChartHandler);break;default:return}r.saveModel()}})};for(var u=0;u<s.length;u++)l(u)};e.prototype.saveModel=function(){this.mapChartHandler.updateGlobalChangeListeners();this.model.setProperties(this.mapChartHandler.properties)};e.prototype.calcInterSortOrder=function(e,t){if(t<1)switch(e){case 0:return[0];case 1:return[0];case 2:return[0,1]}else switch(e){case 0:return[0];case 1:return[0,1];case 2:return[0,2,1];case 3:return[0,2,1]}return[]};return e}();t.default=u}.apply(t,i),void 0!==r&&(e.exports=r))},2177:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(1760),a(879)],r=function(e,t,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);var r=function(){function e(){}e.migrateLayout=function(t){if(t.gaVersion===a.default.VERSION){t.snapshotData&&!t.snapshotData.viewFocus&&this.migrateSnapshotData(t);return}if(!t.layers)return;t.gaVersion=a.default.VERSION;t.gaLayers=[];t.mapSettings=a.default.migrateMapSettings(t);this.migrateSnapshotData(t);for(var i=0;i<t.layers.length;i++)if(t.layers[i].qHyperCube&&t.layers[i].qHyperCube.qDimensionInfo[0]){var r=e.migrateLayer(t.layers[i],t);r&&t.gaLayers.push(r)}t.qUndoExclude||(t.qUndoExclude={});t.qUndoExclude.gaLayers=t.gaLayers;a.default.migrateBackground(t)};e.mercatorY2Lat=function(e){var t=2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2;return 180*t/Math.PI};e.migrateSnapshotData=function(t){if(!t.snapshotData)return;var a=t.snapshotData;var i=a.content&&a.content.chartData&&a.content.chartData.mapRect;if(i){var r=e.mercatorY2Lat(i.y);var o=e.mercatorY2Lat(i.y+i.height);a.viewFocus={bounds:{min:[r,i.x],max:[o,i.x+i.width]}}}};e.migrateLayer=function(e,t){var r=a.default.migratedBasicLayerProperties(e,t.color);if(!e.qHyperCube)return null;if("point"===e.type){if(e.qHyperCube.qDimensionInfo.length<2)return null;var o=r;o.qHyperCube=e.qHyperCube;this.column2ExpressionProp(o.qHyperCube,1);var n=o.qHyperCube.qDimensionInfo[1];var s={qMin:n.qMin,qMax:n.qMax,qContinuousAxes:true,qIsCyclic:false,qIsAutoFormat:true,label:n.qFallbackTitle,qFallbackTitle:n.qFallbackTitle,id:"locationOrLatitude"};o.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(s);o.locationOrLatitude.key=o.qHyperCube.qDimensionInfo[0].qFallbackTitle;var l=e.qHyperCube;var u=l.qMeasureInfo.length>0;if(u){this.column2ExpressionProp(o.qHyperCube,2);var d=o.qHyperCube.qMeasureInfo[0];var p={qMin:d.qMin,qMax:d.qMax,qContinuousAxes:true,qIsCyclic:false,qIsAutoFormat:true,label:d.qFallbackTitle,qFallbackTitle:d.qFallbackTitle,id:"size"};o.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(p);o.size.expression.key=o.qHyperCube.qMeasureInfo[0].qFallbackTitle;o.size.radiusMin=e.rangeBubbleSizes[0];o.size.radiusMax=e.rangeBubbleSizes[1];o.size.slider=[i.default.getSliderValueFromSize(o.size.radiusMin),i.default.getSliderValueFromSize(o.size.radiusMax)];o.size.autoRadiusValueRange=e.autoMinMax;o.size.radiusValueMin=e.customMin;o.size.radiusValueMax=e.customMax}else{var c=Math.floor(e.bubbleSizes/2);o.size.radiusMin=e.bubbleSizes-c;o.size.radiusMax=e.bubbleSizes+c}}else{if(0===e.qHyperCube.qDimensionInfo.length||!e.geodata||0===e.geodata.qHyperCube.qDimensionInfo.length)return null;var h=r;h.qHyperCube=e.geodata.qHyperCube;this.column2ExpressionProp(h.qHyperCube,1);var d=h.qHyperCube.qMeasureInfo[0];var s={qMin:d.qMin,qMax:d.qMax,qContinuousAxes:true,qIsCyclic:false,qIsAutoFormat:true,label:d.qFallbackTitle,qFallbackTitle:d.qFallbackTitle,id:"locationOrLatitude"};h.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(s);h.locationOrLatitude.key=h.qHyperCube.qMeasureInfo[0].qFallbackTitle;var l=e.qHyperCube;var u=l.qMeasureInfo.length>0;u&&(h.qHyperCube.qMeasureInfo[0]=l.qMeasureInfo[0]);var f=l.qDimensionInfo[0].qAttrExprInfo.length>0;f&&h.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(l.qDimensionInfo[0].qAttrExprInfo[0]);var m=l.qDimensionInfo[0].qAttrDimInfo.length>0;m&&h.qHyperCube.qDimensionInfo[0].qAttrDimInfo.push(l.qDimensionInfo[0].qAttrDimInfo[0]);var y={};for(var v in l.qDataPages[0].qMatrix){var g=l.qDataPages[0].qMatrix[v];var b=g[0];y[b.qText]=g}for(var v in h.qHyperCube.qDataPages[0].qMatrix){var g=h.qHyperCube.qDataPages[0].qMatrix[v];var L=g[0];if(L.qText){var D=y[L.qText];if(void 0!==D){u&&(g[1]=D[1]);f&&g[0].qAttrExps.qValues.push(D[0].qAttrExps.qValues[0]);if(m){g[0].qAttrDims||(g[0].qAttrDims={qValues:[]});g[0].qAttrDims.qValues.push(D[0].qAttrDims.qValues[0])}}else{u&&(g[1]={qElemNumber:0,qNum:"NaN",qState:"X",qAttrExps:null});if(f){g[0].qAttrDims||(g[0].qAttrDims={qValues:[]});g[0].qAttrExps.qValues.push({qNum:"NaN"})}m&&g[0].qAttrDims.qValues.push({qElemNo:0})}}}}return r};e.column2ExpressionProp=function(e,t){for(var a in e.qDataPages){var i=e.qDataPages[a];for(var r in i.qMatrix){var o=i.qMatrix[r];var n=o[t];var s=o[0];s.qAttrExps||(s.qAttrExps={qValues:[]});void 0===n.qNum&&(n.qNum="NaN");s.qAttrExps.qValues.push(n)}}};return e}();t.default=r}.apply(t,i),void 0!==r&&(e.exports=r))},2178:function(e,t,a){var i,r;var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};!(i=[a,t,a(431),a(1324),a(1187),a(91),a(879)],r=function(e,t,a,i,r,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});a=o(a);i=o(i);r=o(r);n=o(n);s=o(s);var l;(function(e){var t="geo.dropmenu.noName";function o(){var e="gaLayers";return{type:"items",component:"accordion",items:{layers:{translation:"properties.layers",component:"layers",ref:e,layers:l()},map:{translation:"geo.properties.mapsettings",type:"items",icon:"map",grouped:true,items:u()}}}}e.getMapSoftProperties=o;function l(){var e={AreaLayer:{definition:{translation:"geo.AreaLayer",type:"items",grouped:true,title:function(e,a){var i=e.qHyperCubeDef.qDimensions;return r.default.getDimensionTitle(i,a)||n.default.get(t)},items:{showLayer:s.default.getShowLayerOption(),showLabel:s.default.getShowLabelOption()}}},PointLayer:{definition:{translation:"geo.PointLayer",type:"items",grouped:true,title:function(e,a){var i=e.qHyperCubeDef.qDimensions;return r.default.getDimensionTitle(i,a)||n.default.get(t)},items:{showLayer:s.default.getShowLayerOption(),showLabel:s.default.getShowLabelOption(),sizeSlider:s.default.sizeLayout.sizeSlider("PointLayer",1,100,[4,12]),sizeSingleSlider:s.default.sizeLayout.sizeSingleSlider("PointLayer",1,50,8)}}},LineLayer:{definition:{translation:"geo.LineLayer",type:"items",grouped:true,title:function(e,a){var i=e.qHyperCubeDef.qDimensions;return r.default.getDimensionTitle(i,a)||n.default.get(t)},items:{showLayer:s.default.getShowLayerOption(),showLabel:s.default.getShowLabelOption(),sizeSlider:s.default.sizeLayout.sizeSlider("LineLayer",1,70,[4,12]),sizeSingleSlider:s.default.sizeLayout.sizeSingleSlider("LineLayer",1,50,8)}}},DensityLayer:{definition:{translation:"geo.DensityLayer",type:"items",grouped:true,title:function(e,a){var i=e.qHyperCubeDef.qDimensions;return r.default.getDimensionTitle(i,a)||n.default.get(t)},items:{showLayer:s.default.getShowLayerOption(),radiusSlider:s.default.densityLayout.radiusSlider()}}},ChartLayer:{definition:{translation:"geo.ChartLayer",type:"items",grouped:true,title:function(e,a){var i=e.qHyperCubeDef.qDimensions;return r.default.getDimensionTitle(i,a)||n.default.get(t)},items:{showLayer:s.default.getShowLayerOption(),showLabel:s.default.getShowLabelOption(),pieChart:{component:"items",grouped:true,items:{sizeSlider:s.default.sizeLayout.sizeSlider("ChartLayer",20,100,[30,80]),sizeSingleSlider:s.default.sizeLayout.sizeSingleSlider("ChartLayer",20,100,60)},show:function(e){return"pieChart"===e.chartType}},barChart:{component:"items",grouped:true,items:{barHeight:s.default.sizeLayout.barHeight(10,150,100),barWidth:s.default.sizeLayout.barWidth(5,40,20)},show:function(e){return"barChart"===e.chartType}}}}},GeodataLayer:{definition:{translation:"geo.GeodataLayer",type:"items",grouped:true,title:function(e){return""!==e.title?e.title:n.default.get(t)},items:{showLayer:s.default.getShowLayerOption()}}}};return e}function u(){return{baseMaps:{ref:"mapSettings.baseMap",translation:"geo.properties.basemap",type:"string",component:"radio-list",defaultValue:"default",change:function(e){e.mapSettings.projection=i.default.getDefaultProjection(e.mapSettings.baseMap,e.mapSettings.projection);e.mapSettings.mapLanguage="auto"},options:function(e){return i.default.getBasemapOptionsExplorationMenu(e)}},mapLanguage:{ref:"mapSettings.mapLanguage",translation:"geo.properties.maplanguage",type:"string",component:"radio-list",defaultValue:"auto",change:function(e){var t=d(e);i.default.setLanguage(e.mapSettings.mapLanguage,t.map)},options:function(e){try{var t=d(e);return i.default.getAvailableLanguages(t.map)}catch(e){return i.default.getDefaultAvailableLanguages()}}},zoomToSelection:{ref:"autoZoomOnSelection",translation:"geo.properties.autoZoom",type:"boolean",defaultValue:true},showLegend:{ref:"mapSettings.showLegend",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:true,options:[{value:true,translation:"Common.Auto"},{value:false,translation:"properties.off"}]}}}function d(e){var t=a.default.getMapChart(e.qInfo.qId);if(null==t)throw new TypeError("Map with id '"+e.qInfo.qId+"' was not found");return t}})(l||(l={}));t.default=l}.apply(t,i),void 0!==r&&(e.exports=r))}}]);