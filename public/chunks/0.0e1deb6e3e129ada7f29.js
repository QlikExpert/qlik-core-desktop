/*!
 * sense-client@6.105.4
 * 
 * Copyright(C) 2019 Qlik International AB
 * All Rights Reserved
 * 
 */
(window["qJsonp"]=window["qJsonp"]||[]).push([[0],{1162:function(e,t,r){"use strict";var a,i;!(a=[r(109),r(395)],i=function(e,t){function r(t,r){return e.toHex(e.blend(t,r,.5))}function a(e,t,a){if(e.length!==t.length+1||t.length!==a.length)return false;var i=[e[0]];var n=[];var o=t.length;var s;for(s=0;s<o;s++)if(t[s]){i.push(r(e[s],e[s+1]));i.push(r(e[s],e[s+1]));n.push(a[s]);if(s!==o-1){i.push(e[s+1]);i.push(e[s+1]);n.push((a[s]+a[s+1])/2)}}else{i.push(e[s]);i.push(e[s+1]);n.push(a[s]);if(s!==o-1&&t[s+1]){i.push(e[s+1]);i.push(e[s+1]);n.push((a[s]+a[s+1])/2)}}i.push(e[s]);return{colors:i.reverse(),limits:n}}function i(e,t,r,a){var i=e.getLegendParts(0);var n=[];var o=t.max-t.min;if(Number.isNaN(+o))return n;var s;var l;var u=t.max;var h;for(var c=0;c<i.length;c++){s=i[c];if(a)h=c===i.length-1?t.min:a[i.length-1-c-1];else{l=(s.limits[1]-s.limits[0])*o;h=u-l}s.isMax=0===c;s.max=r.formatValue(s.isMax?t.max:u);s.min=r.formatValue(c+1===i.length?t.min:h);s.id=[];s.id[0]=s.isMax?t.max:u;s.id[1]=c===i.length-1?t.min:h;s.type="range";u=h;n.push(s)}return n}function n(e,r){var a,i,n=new t,o;if(r)for(i=0;i<e.length;i++){o=e[i];if(o)for(a=0;a<o.length;a+=2)n.addColorPart(o[a],o[a+1],i)}else for(a=0;a<e.length;a+=2)n.addColorPart(e[a],e[a+1]);return n}return{setupColors:a,setupLegend:i,createColorScale:n}}.apply(t,a),void 0!==i&&(e.exports=i))},1227:function(e,t,r){"use strict";var a,i;!(a=[],i=function(){var e=-3,t=-2;function r(e,t,a){if(t===a)return[e];var i=[];"U"!==e.qType&&"O"!==e.qType&&"T"!==e.qType&&e.qSubNodes.forEach(function(e){i=i.concat(r(e,t+1,a))});return i}function a(r){return r.some(function(r){return r.qElemNumber===t||r.qElemNumber===e})}function i(e,t,r,a){e[t]={};e[t].elemValue=r[a];e[t].text=r.qText}function n(e,t,n,o,s,l){t=t||0;n=n||0;l=l||n;var u;var h=0;var c=[];var f=[];if(e){if(e.qDataPages[0]){var m=e.qDataPages[0].qMatrix;h=e.qDataPages[0].qArea.qTop||h;m.forEach(function(e,t){!s&&a(e)||(f[t]=e[n])});u=s?o?"qElemNo":"qElemNumber":"qNum"}else if(e.qStackedDataPages[0]){var d=e.qStackedDataPages[0].qData[0];f=r(d,0,n+1);var p=[];if(l>n)f.forEach(function(e){var t=r(e,0,l-n);t.forEach(function(t){p[t.qRow]=e})});else{p=[];f.forEach(function(e){p[e.qRow]=e})}f=p;u=s?"qElemNo":o?"qNum":"qValue"}o?f.forEach(function(e,r){i(c,h+r,e[o].qValues[t],u)}):f.forEach(function(e,t){i(c,h+t,e,u)})}return c}return{wrangleData:n}}.apply(t,a),void 0!==i&&(e.exports=i))},1297:function(e,t,r){"use strict";var a,i;!(a=[],i=function(){return{isByNthDimension:t,useFallback:r};function e(e){return void 0!==e&&-1!==e}function t(t){return"byDimension"===t.mode&&t.byDimDef&&e(t.byDimDef.activeDimensionIndex)}function r(e,r){var a=true;var i=r.auto||t(r);return a&&i}}.apply(t,a),void 0!==i&&(e.exports=i))},1464:function(e,t,r){"use strict";var a,i;!(a=[r(91),r(92),r(344)],i=function(e,t,r){var a,i=-3,n=-2;function o(t,a){var o=[],s={},l,u,h,c,f,m=this._qDataObject,d=this._legendMarker?this._legendMarker:"rect",p=m?m.qDimensionInfo instanceof Array?m.qDimensionInfo:[m.qDimensionInfo]:null,_,g=this._colorMap,M;a=void 0===a?p.length-1:a[0];l=this._dimensionTree;if(t){f=m.qMeasureInfo;_=f.length;for(h=0;h<_;h++)o.push({label:f[h].qFallbackTitle,color:g.getColor(0,0,h),id:[-1],type:"measure",marker:this._legendMarker?this._legendMarker:this._measureLegendTypes&&this._measureLegendTypes[h]||"box"})}else r.each.call(l,function(t){M=r.getLevel.call(t);if(M-1===a&&t.data.qElemNo!==n&&void 0!==t.data.qText&&void 0===s[t.data.qElemNo]){c=[];c[a]=t.data.qElemNo;u={label:t.data.qElemNo!==i||void 0!==t.data.qText?t.data.qText:e.get("properties.dimensionLimits.others"),color:g.getColorFromPreScaledValue(t.data.qElemNo),id:[t.data.qElemNo],index:t.data.rowIndex,type:t.data.qElemNo!==i?"dimension":"others",marker:d};o.push(u);s[t.data.qElemNo]=u}});return o}function s(e,t){var r=[],a={},o=this._data.qListObject.qDataPages[0].qMatrix,s,l,u=this._qDataObject,h=u?u.qDimensionInfo instanceof Array?u.qDimensionInfo:[u.qDimensionInfo]:null,c,f,m,d,p,_=this._colorMap;t=void 0===t?h.length-1:t[0];if(e){s=this._data.qListObject.qMeasureInfo;l=s.length;for(f=0;f<l;f++)r.push({label:s[f].qFallbackTitle,color:_.getColor(0,0,f),id:[-1],type:"measure"})}else for(c=0;c<o.length;c++){m=o[c][t];if(m.qElemNumber!==i&&m.qElemNumbero!==n&&void 0===a[m.qText]){d=[];d[t]=m.qElemNumber;p={label:m.qText,color:_.getColor(d,0,0,c),id:[m.qElemNumber],type:"dimension"};r.push(p);a[m.qText]=p}}return r}function l(e){return e.discrete+","+e.boxType+","+e.colorMode}a=t.extend({init:function e(t){this._data=t;this._colorMappings={}},setColorMap:function e(t){this._colorMap=t},getColorMap:function e(){return this._colorMap},getColorMapping:function e(){if(!this._colorMap||!this._data)return[];var t,r=this._colorMap.getColorDataInfo().legendMode;if("primary"===r.colorMode)return[];if(this._colorMappings[l(r)])return this._colorMappings[l(r)];t=r.discrete&&"range"===r.boxType||!r.discrete?this._colorMap.generateScaleBasedMapping():this._data.qListObject?s.apply(this,["measure"===r.colorMode,this._colorMap.getDimensionIndex()]):o.apply(this,["measure"===r.colorMode,this._colorMap.getDimensionIndex()]);this._colorMappings[l(r)]=t;return t},setData:function e(t){var r=t.qHyperCube?t.qHyperCube:t.qListObject,a=t.qHyperCube?t.qHyperCube.qDimensionInfo:[t.qListObject.qDimensionInfo];this._qDataObject=r;this._data=t;t&&r.qDataPages.length?this._others=r.qDataPages[0].qMatrix.some(function(e){return a&&a.length&&true===e[a.length-1].qIsOtherCell}):this._others=false;this._colorMappings={}},setDimensionTree:function e(t){this._dimensionTree=t;this._colorMappings={}},setMeasureLegendTypes:function e(t){this._measureLegendTypes=t},setLegendMarker:function e(t){this._legendMarker=t},getLegendMarker:function e(){return this._legendMarker},release:function e(){this._colorMap=null;this._dimensionTree=null;this._data=null;this._qDataObject=null}});return a}.apply(t,a),void 0!==i&&(e.exports=i))},1465:function(e,t,r){"use strict";var a,i;!(a=[r(100),r(252),r(1466),r(1227),r(160),r(511),r(91)],i=function(e,t,r,a,i,n,o){var s;function l(e,t){var r=-Number.MAX_VALUE,a=Number.MAX_VALUE,i,n=true;if(false===t.color.autoMinMax)return{min:t.color.measureMin||0,max:t.color.measureMax||0};if(e){e.forEach(function(e){i=e.value;if(!Number.isNaN(+i)){r=Math.max(r,i);a=Math.min(a,i);n=false}});if(n)return null;return{min:a,max:r}}return null}function u(e){var r=[];e.forEach(function(e,a){r[a]={color:t.retriveColor(Number.isNaN(+e.elemValue)?e.text:e.elemValue,"argb"),value:e.elemValue}});return r}s=r.extend({init:function e(t,r,a){this._formatter=new n(null);this._super(t,r,a)},setData:function e(t,r,a){this._precalculate(t);var i=this._super(t,r,a?{content:{chartData:a}}:t?t.snapshotData:null);if(t)if(this._byExpression){if(!this._wrangledMapping.length||!this._minMax)return;var n=this._wrangledMapping;this._numUsedColors=[this.calculateNumberOfUsedColors(this._minMax.max,this._minMax.min,n.map(function(e){return e.value}),1,this.getLargestScaleSize())];this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,true);this._formatter.prepare();this._activeScale.setMaxMinValues(this._minMax.max,this._minMax.min)}else{this._minMax=null;this._mapping=null;this._formatter.pattern=this._formatter.createPatternFromRange(0,1,true);this._formatter.prepare()}return i},getColor:function r(a,i,n,o){if(!this._byExpression)return this._super(a,i,n,o);var s;var l=this._wrangledMapping?this._wrangledMapping[i]:null;if(!l||l.color.isInvalid()&&this._isColorExpression)return t.retriveColor(e.dataColors.nullColor);s=this._isColorExpression?l.color:this._super(a,i,0,l.value);return s},getExpressionValue:function e(t){return!this._wrangledMapping[t]||this._isColorExpression?void 0:this._wrangledMapping[t].value},getLegendTitle:function e(){return this._byExpression?this._expressionLabel:this._super()},getLegendMode:function e(){return this._byExpression?this._isColorExpression?["box","item","primary",true]:[this._classes?"box":"scale",this._classes?"range":"item","measure",true]:this._super()},getValueFormatter:function e(){return this._colorDataInfo&&this._colorDataInfo.altMode&&void 0!==this._colorDataInfo.matchingDataMeasure?this._measureFormatters&&this._measureFormatters[this._colorDataInfo.matchingDataMeasure]?this._measureFormatters[this._colorDataInfo.matchingDataMeasure]:this._formatter:this._byExpression||this._colorDataInfo&&this._colorDataInfo.altMode?this._formatter:this._measureFormatters&&this._measureFormatters[0]?this._measureFormatters[0]:this._formatter},setGenericFormatter:function e(t){this._super(t);if(this._byExpression&&this._minMax){this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,true);this._formatter.prepare()}else this._formatter.pattern=this._formatter.createPatternFromRange(0,1,true);this._formatter.prepare()},getGenericFormatter:function e(){return this._formatter},_getMinMax:function e(t,r){return this._byExpression?this._minMax?{min:this._minMax.min,max:this._minMax.max}:null:this._super(t,r)},_precalculate:function e(t){this._wrangledMapping=[];if(t){var r=t.color||{},n=t.qHyperCube?t.qHyperCube:t.qListObject;this._qDataObject=n;this._data=t;this._isColorExpression=false!==r.expressionIsColor;this._byExpression="byExpression"===r.mode;this._expressionLabel=r.expressionLabel&&""!==r.expressionLabel?r.expressionLabel:o.get("Object.ChartTooltip.ColorExpression");if(this._byExpression){var s=-1;var h=-1;var c=false;n.qDimensionInfo.concat(n.qMeasureInfo).forEach(function(e,t){e.qAttrExprInfo&&e.qAttrExprInfo.every(function(e,r){if(e.id===i.IDMAP.COLOR_BY_EXPRESSION&&!c){s=t;h=r;c=true;return false}return true})});if(s>=0&&h>=0){var f=a.wrangleData(n,h,s,"qAttrExps",false,n.qDimensionInfo.length-1,false);this._wrangledMapping=u(f);this._minMax=l(this._wrangledMapping,t)}}}}});return s}.apply(t,a),void 0!==i&&(e.exports=i))},1466:function(e,t,r){"use strict";var a,i;!(a=[r(11),r(48),r(100),r(252),r(92),r(1162),r(89),r(174)],i=function(e,t,r,a,i,n,o){var s;function l(e,t,r,a,i){var n,o=0,s=[],u,h,c;n=(e-t)/(a+1);if(0===n)return 1;for(u=0;u<r.length;u++){h=.99*(r[u]-t);c=r[u]>e?Math.floor(e/n):r[u]<t?0:Math.floor(h/n);if(Number.isNaN(+c))continue;s[c]?s[c]++:s[c]=1}for(u=0;u<s.length;u++)s[u]&&o++;return o<=a||o>=i?Math.max(o,a):l(e,t,r,++a,i)}function u(e){var t=[],r;for(r=0;r<e.length;r++)e[r]?t.push(h(e[r],false)):t.push(null);return t}function h(e,t){var r=1,a=[];a.push(e[0]);t||a.push(e[0]);for(;r<e.length-1;r++){a.push(e[r]);a.push(e[r])}if(r<e.length){a.push(e[r]);t||a.push(e[r])}return a}function c(e,t,r){var a={limits:[],colors:[]};var i=false;e.forEach(function(n,o){if(n>r.min&&!i)if(n<r.max){a.limits.push(n);a.colors.push(t[o]);o===e.length-1&&(i=true)}else if(n>r.max){if(e.indexOf(n)==o){a.colors.push(t[o]);i=true}}else if(n==r.max&&e.indexOf(n)==o){a.colors.push(t[o]);a.limits.push(n);i=true}i&&r.max>=n&&a.colors.push(t[o+1]);o!=e.length-1||i||a.colors.push(t[o+1])});0===e.length&&a.colors.push(t[0]);return a}function f(e){this._sequentialScales={};var t=this._sequentialScales;var r=0;e.scales.forEach(function(e){t[e.propertyValue]={type:e.type,scale:n.createColorScale("class-pyramid"===e.type?u(e.scale):h(e.scale,"gradient"===e.type),"class-pyramid"===e.type)};r=Math.max(e.scale.length,r)});this._largestScaleSize=r;this._wrangled=[];this._defaultScaleObj=this._sequentialScales[e.scales[0].propertyValue];this._activeScale=this._defaultScaleObj.scale}s=i.extend({init:function e(t,a,i){f.call(this,r);this.app=i;this._themeChangeWatcher=function(){f.call(this,r)}.bind(this);r.ThemeChanged.bind(this._themeChangeWatcher);this._measure=0;this.minMax={min:null,max:null};this.setData(t)},release:function e(){r.ThemeChanged.unbind(this._themeChangeWatcher)},setData:function e(a,i,s){this._data=a;this._colorDataInfo=i;this._customScale=false;this._invalidSpan=false;var u=this;var h;var f;u._unscaledLimits=null;function m(){u._activeScale.setMaxMinValues(h.max,h.min);void 0!==f.reverseScheme&&u._activeScale.setReverse(true===f.reverseScheme)}function d(e){return e.some(function(e){return e})}function p(e){e&&(d(e.breakTypes)?g(e):_(e))}function _(e){if(e){var t=e.colors.map(function(e){return r.resolveColor(e)});var a=e.limits;var i=null;var o;var s;var l={min:h.min,max:h.max};if("absolute"===e.limitType){i=c(a,t,l);a=i.limits;var f=l.max-l.min;var m=.001*f;u._unscaledLimits=a.concat();a.length&&a[0]===l.min&&(h.min=l.min-m);a.length&&a[a.length-1]===l.max&&(h.max=l.max+m);var d=h.max-h.min;a=l.min===l.max?a.map(function(e){return(e-l.min)/l.min}):a.map(function(e){return(e-l.min)/(l.max-l.min)});for(var p=0;p<a.length;p++)0!==d&&d!==f&&(a[p]*=f/(d+m*(1-(p+1)/a.length)));o=a.map(function(){return false})||a.map(function(){return 0});s=n.setupColors(i.colors,o,a)}else if("percent"===e.limitType)if(l.min===l.max)s=n.setupColors([t[0]],[],[]);else{a=a.map(function(e){return Math.max(Math.min(e,1),0)});o=e.breakTypes||a.map(function(){return 0});s=n.setupColors(t,o,a)}if(s){u._activeScale=n.createColorScale(s.colors,false);u._activeScale.setLimits(s.limits);u._customScale=true;u._classes=true}}u._measureGradient=e}function g(e){if(e){var t=e.colors.map(function(e){return r.resolveColor(e)});var a=e.limits;if("absolute"===e.limitType){h.max=Math.max(h.max,a[a.length-1]);h.min=Math.min(h.min,a[0]);a=h.max===h.min?a.map(function(e){return(e-h.min)/h.max}):a.map(function(e){return(e-h.min)/(h.max-h.min)})}var i=e.breakTypes||a.map(function(){return 0});var o=n.setupColors(t,i,a);if(o){u._activeScale=n.createColorScale(o.colors,false);u._activeScale.setLimits(o.limits);u._customScale=true;u._classes=false}}u._measureGradient=e}if(a){if(!i.valid){this._legendTitle="";this._wrangled=[];return}f=a.color||{};var M=a.qHyperCube?a.qHyperCube:a.qListObject;this._qDataObject=M;this._validColorInformation=this._colorDataInfo.valid&&!this._colorDataInfo.allNaN;this._byExpression="byExpression"===f.mode;this._legendTitle=this._colorDataInfo.legendTitle;if(void 0!==f.measureScheme){var v=this._sequentialScales[f.measureScheme]||this._defaultScaleObj;this._activeScale=v.scale;this._classes="class-pyramid"===v.type;h=this._getMinMax();this._invalidSpan=!h;if(!this._invalidSpan&&this._validColorInformation){this._wrangled=this._colorDataInfo.wrangled.map(function(e){return e.elemValue});this._numUsedColors=this._colorDataInfo.persistentColors?[Math.min(this.getLargestScaleSize(),this._colorDataInfo.dimSize)]:[l(h.max,h.min,this._wrangled,1,this.getLargestScaleSize())];if(i.attrInfo&&i.useMeasureGradient)return s&&s.content&&s.content.chartData?o.resolve(s.content.chartData.measureGradient).then(p).then(m):t.getService("qvColorMapService").getMeasureGradient(i.attrInfo.colorMapRef,this.app).then(p).then(m);m()}}}},getColor:function e(t,i,n,o){o=this._byExpression||void 0===this._wrangled[i]?o:this._wrangled[i];return this._byExpression||!this._invalidSpan&&!Number.isNaN(+o)&&this._validColorInformation?this._activeScale.getColor(o,this._getNumUsedColors(0)):a.retriveColor(r.dataColors.nullColor)},getColorFromPreScaledValue:function e(t){return this._activeScale.getColor(t,this._getNumUsedColors(0))},getActiveScale:function e(){return this._activeScale},getLargestScaleSize:function e(){return this._largestScaleSize||0},generateScaleBasedMapping:function t(){var r,a,i,o,s,l,u,h,c,f,m=this.getValueFormatter();f=this._activeScale;this.minMax=this._getMinMax();r=this.minMax;if(this._customScale)return n.setupLegend(f,r,m,this._unscaledLimits);c=[];u=f.getLegendParts(this._getNumUsedColors(0));if(!r)return c;a=r.max-r.min;if(Number.isNaN(+a))return c;s=u.length;o=a/s;l=r.max;if(!Number.isNaN(+r.measureMax)&&this._classes){h=e.extend(true,{},u[0]);h.isMax=true;h.min=m.formatValue(l);h.id=[r.measureMax,l];h.type="range";c.push(h)}for(i=0;i<s-1;i++){h=u[i];h.isMax=0===i;h.max=m.formatValue(l);h.min=m.formatValue(l-o);h.id=[l,l-o];h.type="range";l-=o;c.push(h)}h=u[i];h.isMax=0===i;h.max=m.formatValue(l);h.min=m.formatValue(r.min);h.id=[l,r.min];h.type="range";c.push(h);if(!Number.isNaN(+r.measureMin)&&this._classes){h=e.extend(true,{},u[i]);h.isMax=0===i;h.max=m.formatValue(r.min);h.min=void 0;h.id=[r.min,r.measureMin];h.type="range";c.push(h)}return c},getColorMapping:function e(){return this.generateScaleBasedMapping()},getLegendMode:function e(){return[this._classes?"box":"scale",this._classes?"range":"item","measure"]},getLegendTitle:function e(){return this._legendTitle},setMeasureFormatters:function e(t){this._measureFormatters=t},setGenericFormatter:function e(t){this._formatter=t},getValueFormatter:function e(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:{formatValue:function e(t){return t}}},_getMinMax:function e(){var t;if(false===this._data.color.autoMinMax){t={min:this._data.color.measureMin||0,max:this._data.color.measureMax||0};return t.max>=t.min?t:null}if(this._validColorInformation&&this._colorDataInfo.minMax){t=this._colorDataInfo.minMax;return t}return null},_getNumUsedColors:function e(t){return this._numUsedColors?this._numUsedColors[t]:0},calculateNumberOfUsedColors:l,filterLimitsAndColorsBasedOnMinMax:c,getMeasureGradient:function e(){return this._measureGradient}});return s}.apply(t,a),void 0!==i&&(e.exports=i))},1467:function(e,t,r){"use strict";var a,i;!(a=[r(91),r(100),r(252),r(92)],i=function(e,t,r,a){var i,n="auto",o="primary",s="measure",l="dim_master",u="meas_master",h="multiple",c=-2,f,m;function d(e,r){return t.resolveColor(r||e)}function p(e,t){var r=t||0;var a=[];e.forEach(function(e){if(void 0===a[e]&&e>=0){a[e]=r;r++}});return a}function _(e){return this._persistColors||this._measureMode?e:this._reMappedIndeces[e]}function g(){f={};t.dataPalettes.forEach(function(e){f[e.propertyValue]={type:e.type,scale:e.scale}});m=f[t.dataPalettes[0].propertyValue]}i=a.extend({init:function e(r,a){a=a||{};this._primaryColorMode=a.colorBy||n;this._autoMode=a.autoMode||n;this._primaryColor=t.dataColors.primaryColor;this._persistColors=true;this._wrangled=[];this._dimIndex=0;g();this._themeChangeWatcher=function(){g()};t.ThemeChanged.bind(this._themeChangeWatcher);r&&this.setData(r)},release:function e(){t.ThemeChanged.unbind(this._themeChangeWatcher)},setData:function t(r,a){this._data=r;this._colorDataInfo=a;if(!a.valid){this._dimLabel="";this._wrangled=[];return}var i=r.color||{},s=r.qHyperCube?r.qHyperCube:r.qListObject,c=s&&s.qMeasureInfo?s.qMeasureInfo.length:0;this._colorMode=i.auto?n:i.mode||o;this._internalMode=this._colorDataInfo.internalMode;this._measureMode=this._internalMode===h||"byMultiple"===this._colorMode||this._internalMode===u||this._internalMode===l;this._persistColors=this._colorDataInfo.persistentColors;this._dimIndex=this._colorDataInfo.dimIndex||0;this._measureMode?this._dimLabel=e.get("Common.Measures"):this._dimLabel=this._colorDataInfo.legendTitle;this._wrangled=this._colorDataInfo.wrangled.map(function(e){return e.elemValue});this._dimSize=this._measureMode?c:this._colorDataInfo.dimSize;this._persistColors||(this._reMappedIndeces=p(this._wrangled,this._colorDataInfo.top));this._primaryColor=d(i.singleColor,i.paletteColor);"none"===this._primaryColor&&(this._primaryColor="rgba(0,0,0,0)");var _=this._colorDataInfo.dimensionScheme&&f[this._colorDataInfo.dimensionScheme]||m;this._colorMode===n&&(_=m);if("pyramid"===_.type){var g=Math.max(Math.min(_.scale.length-1,this._dimSize-1)%_.scale.length,0);this._qualitativeScale=_.scale[g]}else this._qualitativeScale=_.scale},getColor:function e(a,i,s){var l=this._measureMode?s:this._wrangled[i];if(this._internalMode===o&&this._colorMode===n)return r.retriveColor(t.dataColors.primaryColor);if(this._internalMode===o)return r.retriveColor(this._primaryColor);if(Number.isNaN(+l)||l===c)return r.retriveColor(t.dataColors.nullColor);l=_.call(this,l);return r.retriveColor(this._qualitativeScale[l%this._qualitativeScale.length])},getLegendMode:function e(){var t=this._internalMode===o||this._internalMode===l?o:this._autoMode===s||this._measureMode?"measure":"dimension";return["box","item",t,"measure"===t]},getColorFromPreScaledValue:function e(t){t=_.call(this,t);return r.retriveColor(this._qualitativeScale[t%this._qualitativeScale.length])},getDimensionIndex:function e(){return this._colorDataInfo?this._dimIndex:0},getLegendTitle:function e(){return this._dimLabel}});return i}.apply(t,a),void 0!==i&&(e.exports=i))},1468:function(e,t,r){"use strict";var a,i;!(a=[r(208)],i=function(e){function t(t,r){return'<div class="color-template-wrapper"><div class="color-dot" style="background:'+r+'"></div><span dir="ltr">'+e.encodeForHTML(t)+"</span></div>"}return{createLegendTemplate:t}}.apply(t,a),void 0!==i&&(e.exports=i))},1469:function(e,t,r){"use strict";var a,i;!(a=[r(252),r(100)],i=function(e,t){var r=-3,a=-2;function i(){this._colors={others:e.retriveColor(t.dataColors.othersColor),null:e.retriveColor(t.dataColors.nullColor),error:e.retriveColor(t.dataColors.errorColor)};this._wrangled=[]}i.prototype.setProperties=function(r,a){this._dimIndex=r.dimIndex||0;this._wrangled=r.wrangled||[];this._colorMode=r.internalMode;this._colors={others:e.retriveColor(t.dataColors.othersColor),null:e.retriveColor(t.dataColors.nullColor),error:e.retriveColor(t.dataColors.errorColor)};if(a&&"dimension"===r.internalMode&&r.useDimColVal){var i;if(a.oth){i=e.retriveColor(t.resolveColor(a.oth));i.isInvalid()||(this._colors.others=i)}if(a.nul){i=e.retriveColor(t.resolveColor(a.nul));i.isInvalid()||(this._colors.null=i)}}};i.prototype.getColor=function(e,t){var i=Array.isArray(e)?this._dimIndex>=0?e[this._dimIndex]:void 0:e;var n="measure"!==this._colorMode&&this._wrangled[t]?this._wrangled[t].elemValue:void 0;if(!Array.isArray(e)&&Number.isNaN(+e))return this._colors.error;if(i===r||Array.isArray(e)&&-1!==e.indexOf(r))return this._colors.others;if(i===a||n===a)return this._colors.null;return false};return i}.apply(t,a),void 0!==i&&(e.exports=i))},1470:function(e,t,r){"use strict";var a,i;!(a=[r(92),r(48),r(100),r(89),r(174)],i=function(e,t,r,a){var i;function n(e){var t={};e&&e.forEach(function(e){t[e.value]=e.baseColor});return t}function o(e,t){var r={};t.forEach(function(e){r[e.text]||(r[e.text]=[]);r[e.text].push(e)});e.forEach(function(e){r[e.value]&&r[e.value].forEach(function(t){t.baseColor=e.baseColor})});return t.map(function(e){return e.baseColor})}function s(e){var t=[];e.forEach(function(e,r){var a=l(e);t[a]=r});return t}function l(e){return e.elemValue}function u(e,t,a,i,n){if(i){if(true===n){var o=h();return o[l(i)%o.length]}if(e&&a){var s=l(i);return a[s%a.length]}}var u=r.resolveColor(t);return"none"===u?r.dataColors.primaryColor:u}function h(e,t){return r.getPaletteScale(e||"",t)}i=e.extend({init:function e(t){this.colors={};this.filler={};this.reverseMapping=[];this.fieldValueMap={};this.app=t},release:function e(){this.colors=null;this.filler=null},setData:function e(r,i,l,u){var c=this;this.wrangled=i.wrangled;var f=i.altMode?i.attrInfo.colorMapRef:l&&l.coloring?l.coloring.colorMapRef:"";function m(e){var t=e||{};c.fieldValueMap=n(t.colors);c.colors=o(t.colors||[],i.wrangled||[]);c.filler=t.single;c.palette=h(t.pal);c.usePalette=t.usePal;c.reverseMapping=s(i.wrangled||[]);c._dimValCols=e;c.autoFill=t.autoFill;return e}return u?a.resolve(u.dimValsData).then(m):t.getService("qvColorMapService").getColorMap(f,this.app).then(m)},getColor:function e(t){return this.colors[t]?r.resolveColor(this.colors[t]):u(this.usePalette,this.filler,this.palette,this.wrangled[t],this.autoFill)},getColorFromPreScaledValue:function e(t,a){var i=this.reverseMapping[t];if(this.colors[i])return r.resolveColor(this.colors[i]);if(this.fieldValueMap[a])return r.resolveColor(this.fieldValueMap[a]);return this.usePalette||this.autoFill?u(this.usePalette,this.filler,this.palette,{elemValue:t},this.autoFill):"none"},getDimValsData:function e(){return this._dimValCols}});return i}.apply(t,a),void 0!==i&&(e.exports=i))},1471:function(e,t,r){"use strict";var a,i;!(a=[r(195),r(100)],i=function(e,t){var r="primary",a="dimension",i="measure",n="expression",o="multiple",s="master",l="dim_master",u="meas_master",h="auto";var c=e.baseColor;function f(e,t,f,m,p){var _=Array.isArray(f.qDimensionInfo)?f.qDimensionInfo.length:1,g=f.qMeasureInfo?f.qMeasureInfo.length:0;var M,v,b;v="measure"===m&&d(f.qMeasureInfo);b="dimension"===m&&d(f.qDimensionInfo);M=v||b;e&&e!==h?"byMultiple"===e?e=M?s:o:"byDimension"===e?e=a:"byMeasure"===e?e=i:"byExpression"===e?e=n:e===r&&(b?e=l:v&&c.isSupported(p)&&(e=u)):e=_>1&&t!==r||t===a?a:d(f.qDimensionInfo)&&(1===_||t===r)&&(g<=1||t===r)?l:d(f.qMeasureInfo)&&(_<=1||t===r)&&c.isSupported(p)?u:t===r||t===h&&_<=1&&g<=1?r:g>1?o:a;e===s&&(e=v?u:l);return e}function m(e){var r=false;if(!e)return false;e.coloring&&e.coloring.baseColor&&e.coloring.baseColor.color?r=e.coloring.baseColor:e.baseColor&&e.baseColor.color&&(r=e.baseColor);if(r){"none"===r.color&&(r=t.dataColors.primaryColor);return r}return false}function d(e){return e.filter(function(e){return m(e)}).length>0}return{determineInternalMode:f,getBaseColor:m}}.apply(t,a),void 0!==i&&(e.exports=i))},246:function(e,t,r){"use strict";var a,i;!(a=[r(92),r(90),r(405)],i=function(e,t,r){var a,i={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"μ","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},n=/%$/,o=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,s=/^\(oct\)/i,l=/^\(dec\)/i,u=/^\(hex\)/i,h=/^\(bin\)/i,c=/^\(rom\)/i,f=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i;function m(e,t,r,a){e=e.toString(t);r[1]===r[1].toUpperCase()&&(e=e.toUpperCase());e.length-e.indexOf(".")>10&&(e=e.slice(0,e.indexOf(".")+11));return e.replace(".",a||".")}function d(e,t,r){var a;if(o.test(t))e=m(e,Number(/\d{2}/.exec(t)[0]),t,r);else if(s.test(t))e=m(e,8,t,r);else if(l.test(t))e=m(e,10,t,r);else if(u.test(t))e=m(e,16,t,r);else if(h.test(t))e=m(e,2,t,r);else if(c.test(t)){a="";if(e<0){a="-";e=-e}e=Math.floor(e);if(0===e)e="0";else if(e<=5e5){e=p(e,t);e=a+e}else e=t+a+e.toExponential(0)}return e}function p(e,t){var r,a="",i=Number(String(e).slice(-3)),n=(e-i)/1e3,o=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),s=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();while(i>0)for(r=0;r<o.length;r++)if(o[r]<=i){a+=s[r];i-=o[r];break}for(r=0;r<n;r++)a="M"+a;t[1]!==t[1].toUpperCase()&&(a=a.toLowerCase());return a}function _(e){if(!e||!e.qNumericalAbbreviation)return i;var t={};var r=e.qNumericalAbbreviation.split(";");r.forEach(function(e){var r=e.split(":");2===r.length&&(t[r[0]]=r[1])});return t}a=e.extend("NumberFormatter",{init:function e(t,r,a,i,n){this.localeInfo=t;this.pattern=r;this.thousandDelimiter=a||",";this.decimalDelimiter=i||".";this.type=n||"numeric";this.abbreviations=_(t);this.prepare()},clone:function e(){var t=new a(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);t.subtype=this.subtype;return t},format:function e(t,r,a,i){this.prepare(r,a,i);return this.formatValue(t)},prepare:function e(t,r,a){var i,n;"undefined"===typeof t&&(t=this.pattern);"undefined"===typeof r&&(r=this.thousandDelimiter);"undefined"===typeof a&&(a=this.decimalDelimiter);if(!t){this._prepared={pattern:false};return}this._prepared={positive:{d:a,t:r,abbreviate:false,isFunctional:false,prefix:"",postfix:""},negative:{d:a,t:r,abbreviate:false,isFunctional:false,prefix:"",postfix:""}};i=this._prepared;t=t.split(";");i.positive.pattern=t[0];i.negative.pattern=t[1];f.test(t[0])&&(i.positive.isFunctional=true);t[1]?f.test(t[1])&&(i.negative.isFunctional=true):i.negative=false;n=i.positive.isFunctional&&(!i.negative||i.negative&&i.negative.isFunctional);if(!n){g(i.positive,r,a);i.negative&&g(i.negative,r,a)}},formatValue:function e(t){var a=this._prepared,i,n,o="",s,l,u="",h,c,f,m,p;if(Number.isNaN(+t))return t;if(false===a.pattern)return t.toString();if(t<0&&a.negative){a=a.negative;t=-t}else a=a.positive;h=a.d;c=a.t;if(a.isFunctional)t=d(t,a.pattern,h);else{a.percentage&&(t*=100);if(a.abbreviate){var _=this.abbreviations;var g=Object.keys(_).map(function(e){return parseInt(e)}).sort(function(e,t){return e>t?1:-1});var M;var v=g[0];f=0;n=Number(Number(t).toExponential().split("e")[1]);while(v<=n&&f<g.length){f++;v=g[f]}f>0&&(M=g[f-1]);var b;M&&n>0&&M>0?b=M:(n<0&&M<0||!M)&&(v<0&&v-n<=a.maxPrecision?b=v:M<=n&&!(v>0&&-n<=a.maxPrecision)&&(b=M));if(b){o=_[b];t/=Math.pow(10,b)}}s=Math.abs(t);i=a.temp;m=a.numericPattern;p=m.split(h)[1];"I"===this.type&&(t=Math.round(t));l=t;if(p||"#"!==m.slice(-1)[0])if(s>=1e15||s>0&&s<=1e-14)t=s?s.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var q=Number(t.toFixed(Math.min(20,p?p.length:0)).split(".")[0]);var x=m.split(h)[0];x+=h;t=r(x,q)||"0";if(p){var D=Math.max(0,Math.min(14,p.length));var C=p.replace(/#+$/,"").length;var I=Number((s%1).toPrecision(D)).toFixed(D);I=I.slice(2).replace(/0+$/,"");for(f=I.length;f<C;f++)I+="0";I&&(t+=h+I)}else 0===q&&(l=0)}else if(s>=Math.pow(10,i)||s<1||s<1e-4)if(0===t)t="0";else if(s<1e-4||s>=1e20){t=l.toExponential(Math.max(1,Math.min(14,i))-1);t=t.replace(/\.?0+(?=e)/,"");u=""}else{t=t.toPrecision(Math.max(1,Math.min(14,i)));if(t.indexOf(".")>=0){t=t.replace(t.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,"");t=t.replace(".",h)}}else{m+=h;i=Math.max(0,Math.min(20,i-Math.ceil(Math.log(s)/Math.log(10))));for(f=0;f<i;f++)m+="#";t=r(m,t)}t=t.replace(a.numericRegex,function(e){if(e===c)return a.groupTemp;if(e===h)return a.decTemp;return""});l<0&&!/^-/.test(t)&&(t="-"+t)}return a.prefix+t+u+o+a.postfix}});function g(e,t,r){var a,i,o=e.pattern,s,l,u,h,c,f,m;if(o.indexOf("A")>=0){o=o.replace("A","");e.abbreviate=true}m=v(t,r);s=o.match(m);s=s?s[0]:"";l=s?o.substr(0,o.indexOf(s)):o;u=s?o.substring(o.indexOf(s)+s.length):"";s||(s=o?"#":"##########");if(t&&t===r){a=s.split(r);i=a.pop();s=a.join("")+r+i;t=""}h=t;t=/,/.test(r)?"¤":",";h&&(s=s.replace(M(h,"g"),t));c=r;r=".";c&&(s=s.replace(M(c,"g"),r));f=s.match(/#/g);f=f?f.length:0;var d=o.split(c);var p;d[1]&&(p=d[1].match(/#|0/g));e.prefix=l||"";e.postfix=u||"";e.pattern=o;e.maxPrecision=p?p.length:2;e.percentage=n.test(o);e.numericPattern=s||"";e.numericRegex=new RegExp(M(t,null,true)+"|"+M(r,null,true),"g");e.groupTemp=h;e.decTemp=c;e.t=t;e.d=r;e.temp=f}function M(e,r,a){var i=t.escapeRegExp(e);if(a)return i;return new RegExp(i||"",r)}function v(e,r){r&&(r=t.escapeRegExp(r));e&&(e=t.escapeRegExp(e));return new RegExp("(?:[#0]+"+e+")?[#0]+(?:"+r+"[#0]+)?")}window.NumberFormatter=a;a.getStaticFormatter=function(){return{prepare:function e(){},formatValue:function e(t){return t+""}}};return a}.apply(t,a),void 0!==i&&(e.exports=i))},405:function(e,t,r){var a;!(a=function(){return function(e,t){if(!e||isNaN(+t))return t;var t="-"==e.charAt(0)?-t:+t;var r=t<0?t=-t:0;var a=e.match(/[^\d\-\+#]/g);var i=a&&a[a.length-1]||".";var n=a&&a[1]&&a[0]||",";var e=e.split(i);t=t.toFixed(e[1]&&e[1].length);t=+t+"";var o=e[1]&&e[1].lastIndexOf("0");var s=t.split(".");(!s[1]||s[1]&&s[1].length<=o)&&(t=(+t).toFixed(o+1));var l=e[0].split(n);e[0]=l.join("");var u=e[0]&&e[0].indexOf("0");if(u>-1)while(s[0].length<e[0].length-u)s[0]="0"+s[0];else 0==+s[0]&&(s[0]="");t=t.split(".");t[0]=s[0];var h=l[1]&&l[l.length-1].length;if(h){var c=t[0];var f="";var m=c.length%h;for(var d=0,p=c.length;d<p;d++){f+=c.charAt(d);!((d-m+1)%h)&&d<p-h&&(f+=n)}t[0]=f}t[1]=e[1]&&t[1]?i+t[1]:"";return(r?"-":"")+t[0]+t[1]}}.call(t,r,t,e),void 0!==a&&(e.exports=a))},511:function(e,t,r){"use strict";var a,i;!(a=[r(246),r(326)],i=function(e,t){var r,a={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"};r=e.extend("QFormatter",{init:function r(i,n,o,s,l){var u=i||{};this.localeInfo=u;this.pattern=n||"";this.decimalDelimiter="string"===typeof s?s:"string"===typeof u.qDecimalSep?u.qDecimalSep:".";this.thousandDelimiter="string"===typeof o?o:"string"===typeof u.qThousandSep&&this.decimalDelimiter!==u.qThousandSep?u.qThousandSep:"";this.type=l||a.AUTO;l===a.AUTO&&(this.pattern="#"+this.decimalDelimiter+"##A");this._numberFormatter=new e(i);this._dateFormatter=new t(i);this.prepare()},clone:function e(){return new r(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type)},prepare:function e(t,r,i){t||(t=this.pattern);if(!t)switch(this.type){case a.INTEGER:t="##############";break;case a.NUMBER:t=Array(this.localeInfo.qnDec||11).join("#");break;case a.FIXED_TO:t="#"+this.localeInfo.qDecimalSep||false;break;case a.MONEY:t=this.localeInfo.qMoneyFmt;i||(i=this.localeInfo.qMoneyDecimalSep||".");r||i===this.localeInfo.qMoneyThousandSep||(r=this.localeInfo.qMoneyThousandSep);break;case a.DATE:t=this.localeInfo.qDateFmt||"YYYY-MM-DD";break;case a.DATE_TIME:t=this.localeInfo.qTimestampFmt||"YYYY-MM-DD hh:mm:ss";break;case a.TIME:case a.INTERVAL:t=this.localeInfo.qTimeFmt||"hh:mm:ss";break;default:t="##########";break}this._numberFormatter.pattern=this.pattern;this._dateFormatter.pattern=this.pattern;this._numberFormatter.thousandDelimiter=this.thousandDelimiter;this._numberFormatter.decimalDelimiter=this.decimalDelimiter;this._numberFormatter.type=this.type;this._numberFormatter.prepare(t,r,i);this._prepared={pattern:t,t:r,d:i}},formatValue:function e(t,r){var i,n=this._prepared;if("NaN"===t||"number"===typeof t&&Number.isNaN(+t))return"-";if(Number.isNaN(+t)||"number"!==typeof t)return t+"";switch(this.type){case a.DATE:case a.TIME:case a.DATE_TIME:i=new Date(1899,11,30+Math.floor(t),0,0,86400*(t-Math.floor(t)));if(Number.isNaN(+i.getTime()))return this._numberFormatter.format(t,"0",n.t,n.d);return this._dateFormatter.format(i,r||n.pattern);case a.INTERVAL:return this._dateFormatter.format(t,n.pattern);default:return this._numberFormatter.formatValue(t)}},format:function e(t,r,a,i){if("NaN"===t||"number"===typeof t&&Number.isNaN(+t))return"-";if(Number.isNaN(+t)||"number"!==typeof t)return t+"";this.prepare(r,a,i);return this.formatValue(t)},createPatternFromRange:function e(t,r,a){var i="",n,o=Number(Number(t).toExponential().split("e")[1]),s=Number(Number(r).toExponential().split("e")[1]),l=Math.min(Math.abs(o),Math.abs(s)),u=Math.abs(r-t),h,c=Number(Number(u/50).toExponential().split("e")[1]),f;f=Math.abs(c);if(0===u)return"0"+this.decimalDelimiter+"##"+(a?"A":"");if(c>=0)f=a?Math.max(2,l-c):0;else{h=(a?l-l%3:0)*(s<0?1:-1);f-=h}this.thousandDelimiter?i+="#"+this.thousandDelimiter+"##0":i+="0";if(f){i+=this.decimalDelimiter;for(n=0;n<f;n++)i+="#"}return i+(a?"A":"")}});r.getSignificantIntegers=function(e){return i(e)};r.getSignificantDecimals=function(e){return n(e)};function i(e){if(Number.isNaN(+e)||!Number.isFinite(+e))return 1;var t=Number(e).toExponential(),r=t.split("e"),a=1;"+"===r[1][0]&&(a+=Number(r[1]));return a}function n(e){if(Number.isNaN(+e)||!Number.isFinite(+e))return 0;var t=Number(e).toExponential(),r=t.split("e"),a=0,i;if("-"===r[1][0]){a=Math.abs(Number(r[1]));r=r[0].split(".");r[1]&&(a+=r[1].length)}else{i=Number(r[1]);r=r[0].split(".");a=r[1]?r[1].length-i:0}return a}return r}.apply(t,a),void 0!==i&&(e.exports=i))},512:function(e,t,r){"use strict";var a,i;!(a=[r(91),r(92),r(89),r(1464),r(1465),r(1467),r(1468),r(1227),r(1469),r(1470),r(1297),r(160),r(252),r(100),r(195),r(1471),r(90),r(130)],i=function(e,t,r,a,i,n,o,s,l,u,h,c,f,m,d,p,_,g){var M,v="auto",b="qualitative",q="primary",x="expression",D="measure",C="auto",I="primary",y="dimension",N="measure",S="expression",E="dim_master",T="meas_master",V="error",F="first",w="last",L=-3,A=-2;var P=d.baseColor;function O(e){var t=-Number.MAX_VALUE,r=Number.MAX_VALUE,a=true;e.forEach(function(e){if(!Number.isNaN(+e.elemValue)){t=Math.max(e.elemValue,t);r=Math.min(e.elemValue,r);a=false}});return{min:a?0:r,max:a?10:t}}function k(e){if(!e||!e.length)return 0;e=e.filter(function(e){return"N"===e.qType});if(1===e.length&&"V"!==e[0].qSubNodes[0].qType)return 1+k(e[0].qSubNodes);return 0}function R(e,t,r,a){var i=e.auto;var n=e.dimensionID;if(!i&&h.isByNthDimension(e))return e.byDimDef.activeDimensionIndex;var o=0,s=Array.isArray(t),l=s?t.length:1,u;if(n&&!i)for(o;o<l;++o){u=s?t[o].cId:t.cId;if(u===n)return o}var c=a.qStackedDataPages&&a.qStackedDataPages.length&&a.qStackedDataPages[0].qData&&a.qStackedDataPages[0].qData.length?a.qStackedDataPages[0].qData[0].qSubNodes:null;return r===F?k(c):l-1}function H(e,t,r,a,i){if(t===y)return e||r.qDimensionInfo.length>1||i&&r.qSize.qcy>a.qArea.qHeight;if(t===N)return"K"===r.qMode||r.qSize.qcy>a.qMatrix.length;return false}function U(e,t,r){var a=0;if(0===r){while(e&&e.parent)e=e.parent;return e}while(t){if(e.getDimensions().length-1===r)return e;if(e.getDimensions().length-1-a===r)return t;t=t.parent;a++}}function j(e,t,r){r=Array.isArray(r)?r:[r];var a=e.qHyperCube.qMeasureInfo,i=-1!==r.indexOf(L)||-1!==r.indexOf(A);return!i&&P.isSupported(e.visualization)&&!!p.getBaseColor(a[t])}function z(e,t){t=Array.isArray(t)?t:[t];var r=-1!==t.indexOf(L)||-1!==t.indexOf(A),a=e.qHyperCube.qDimensionInfo.filter(function(e){return!!p.getBaseColor(e)}).length>0;return!r&&a}function B(e){return p.getBaseColor(e.filter(function(e){return!!p.getBaseColor(e)})[0])}function G(){return{dimIndex:0,wrangled:[],valid:false,legendMode:{}}}function Y(e,t){if(!t.enigmaModel||!e.colorMapRef)return r.when(e.qFallbackTitle);return t.enigmaModel.getMeasureList().then(function(t){var r=g.findLibraryMeasure(e.colorMapRef,t);return r.qData.labelExpression?r.qData.labelExpression:r.qData.title})}function X(e,t){if(!t.enigmaModel||!e.colorMapRef)return r.when(e.qFallbackTitle);return t.enigmaModel.getDimensionList().then(function(t){var r=g.findLibraryDimension(e.colorMapRef,t);return r.qData.labelExpression?r.qData.labelExpression:r.qData.title})}function W(e){return e.qFallbackTitle&&"="===e.qFallbackTitle.charAt(0)?e.qFallbackTitle.substr(1):e.qFallbackTitle}M=t.extend({init:function e(t,r){t=t||{};this._app=r;this._autoMode=t.autoMode||C;this._multiDimScheme=t.multiDimScheme||w;this._qualitativeMap=new n(null,t);this._sequentialMap=new i(null,t,r);this._legendDataProvider=new a;this._legendDataProvider.setColorMap(this);this._specialColorMap=new l;this._dimValsMap=new u(r);this._enableAltMode=true;this._colorDataInfo=G();this._title="DEBUG"},getColor:function e(t,r,a,i){var n=this._specialColorMap.getColor(t,i);if(n)return n;if(this._colorDataInfo.internalMode===y&&this._colorDataInfo.useDimColVal)return f.retriveColor(this._dimValsMap.getColor(i));if(this._colorDataInfo.internalMode===V)return this._qualitativeMap.getColor(A);if(this._colorMode===D||this._colorMode===x)return this._sequentialMap.getColor(t,i,a,r);if(this._colorDataInfo.internalMode===T&&j(this._data,a,t))return f.retriveColor(m.resolveColor(p.getBaseColor(this._data.qHyperCube.qMeasureInfo[a])));if(this._colorDataInfo.internalMode===E&&z(this._data,t))return f.retriveColor(m.resolveColor(B(this._data.qHyperCube.qDimensionInfo)));return this._qualitativeMap.getColor(t,i,a,r)},getColorScale:function e(){return this._qualitativeMap},getColorFromPreScaledValue:function e(t,r){if(this._colorMode===D||this._colorMode===x)return this._sequentialMap.getColorFromPreScaledValue(t);var a=this._specialColorMap.getColor(t);if(a)return a;if(this._colorDataInfo.internalMode===y&&this._colorDataInfo.useDimColVal)return f.retriveColor(this._dimValsMap.getColorFromPreScaledValue(t,r));return this._qualitativeMap.getColorFromPreScaledValue(t)},getTooltipContent:function t(r,a){var i=null,n,s,l,u,h;if(this._colorDataInfo.valid){if(this._colorMode===x){n=this._sequentialMap.getExpressionValue(void 0===a?r.row:a);s=n;if(void 0!==n){this._sequentialMap.getValueFormatter&&(l=this._sequentialMap.getValueFormatter())&&(n=l.formatValue(n));i={label:this.getLegendTitle(),template:o.createLegendTemplate(n,this._sequentialMap.getColor(r.id,void 0===a?r.row:a,0,n)),num:s}}}if(this._colorDataInfo.altMode){var c=true;if("dimension"===this._colorDataInfo.internalMode){var f=r._attrDims[this._colorDataInfo.attrIndex];if(!f)return;if(r.id===L){h=r.id===L?e.get("properties.dimensionLimits.others"):f.label?f.label:"";u=this.getColorFromPreScaledValue(L)}else if(f.value===A){h=f.value===A?"-":f.label?f.label:"";u=this.getColorFromPreScaledValue(A)}else{h=f.label?f.label:"";u=this.getColorFromPreScaledValue(f.value);c=!u.isInvalid()}}else if("measure"===this._colorDataInfo.internalMode){n=void 0!==a?this._colorDataInfo.wrangled[a].elemValue:r.values[this._colorDataInfo.legendMode.rangeSelectionIndex];s=n;c=void 0!==n;h=this._sequentialMap.getGenericFormatter&&(l=this._sequentialMap.getGenericFormatter())?l.formatValue(n):n;u=this.getColorFromPreScaledValue(n)}c&&(i={label:this.getLegendTitle(),value:h+"",num:s,template:o.createLegendTemplate(h,u)})}else if("dimension"===this._colorDataInfo.internalMode){var m=r.getDimensions();var d=m[m.length-this._colorDataInfo.dimIndex-1];if(!d)return;h=d;var p=U(r,r,this._colorDataInfo.dimIndex);u=this.getColorFromPreScaledValue(p.id);u.isInvalid()||(i={label:this.getLegendTitle(),template:o.createLegendTemplate(h,u)})}}return i},getColorMapping:function e(){return this._legendDataProvider.getColorMapping()},generateScaleBasedMapping:function e(){return this._sequentialMap.generateScaleBasedMapping()},getSelectionIndices:function e(){return this.getDimensionIndex()},getLegendTitle:function e(){return this._colorMode===D||this._colorMode===x?this._sequentialMap.getLegendTitle():this._qualitativeMap.getLegendTitle()},getDimensionIndex:function e(){return this._colorMode===D?[0]:[this._qualitativeMap.getDimensionIndex()]},setData:function e(t,a){if(this.released)return r.reject();var i=this;var n=[];this._colorMode=b;this._data=t;this._colorDataInfo=G();var o=G();var l=r.resolve();var u;var f;var d;var g;var M;if(t.color){u=t.color;var F=t.qHyperCube;var w="";if(!F)return r.resolve().then(Q);w=t.qInfo&&t.qInfo.qType?t.qInfo.qType:a;o.internalMode=p.determineInternalMode(u.auto?C:u.mode||C,this._autoMode,F,u.useBaseColors,w);o.useDimColVal=u.useDimColVal||u.auto&&o.internalMode===y;o.useMeasureGradient=u.useMeasureGradient||u.auto&&o.internalMode===N;g=this._data.qHyperCube.qDimensionInfo.length-1;var L=this._data.qHyperCube.qDataPages[0]||this._data.qHyperCube.qStackedDataPages[0]||{qArea:{qHeight:0},qMatrix:[]};M=t.qHyperCube.qDimensionInfo[g];var P=t.qHyperCube.qMeasureInfo[0];var k=g;var U=g;f=-1;var j;if(o.internalMode===y){f=c.getIndexById(M.qAttrDimInfo,c.IDMAP.COLOR_BY_ALTERNATIVE);d=-1!==f?M.qAttrDimInfo[f]:null;j="qAttrDims";if(h.useFallback(d,u)){f=-1;d=null}}else if(o.internalMode===N){f=c.getIndexById(M.qAttrExprInfo,c.IDMAP.COLOR_BY_ALTERNATIVE);d=-1!==f?M.qAttrExprInfo[f]:null;j="qAttrExps"}o.altMode=this._enableAltMode&&!!d&&g>=0&&f>=-1;var z=!o.altMode&&o.internalMode===N&&!P;o.valid=(o.altMode&&d&&!d.qError||!o.altMode&&!!M)&&!z;if(!o.valid){o.internalMode=V;o.allNaN=true;return r.resolve().then(Q)}o.dimIndex=g;o.attrIndex=f;o.hasOthers=!!t.qHyperCube.qHasOtherValues;o.othersLabels=t.qHyperCube.qDimensionInfo.map(function(e){return e.othersLabel});o.activeDimensionIndex=_.getValue(t,"color.byDimDef.activeDimensionIndex");o.persistentColors=H(u.persistent,o.internalMode,F,L,o.altMode);o.top=L.qArea.qTop;o.attrInfo=d;if(o.altMode)if(o.internalMode===N){o.minMax={min:d.qMin||0,max:d.qMax||10};o.matchingDataMeasure=d.matchMeasure;o.dimSize=false===u.autoMinMax?M.qCardinal:t.qHyperCube.qSize.qcy;t.color.byMeasureDef&&"libraryItem"===t.color.byMeasureDef.type?l=l.then(function(){return Y(d,i._app).then(function(e){o.legendTitle=e})}):t.color.altLabel?o.legendTitle=t.color.altLabel:o.legendTitle=W(d)}else if(o.internalMode===y){o.dimSize=o.persistentColors?d.qCardinal:d.qSize.qcy;t.color.byDimDef&&"libraryItem"===t.color.byDimDef.type?l=l.then(function(){return X(d,i._app).then(function(e){o.legendTitle=e})}):t.color.altLabel?o.legendTitle=t.color.altLabel:o.legendTitle=W(d)}else o.legendTitle=d.label||d.qFallbackTitle;else if(o.internalMode===N){k=g+1;o.minMax=Number.isNaN(+P.qMin)||Number.isNaN(+P.qMax)?null:{min:P.qMin||0,max:P.qMax||10};o.legendTitle=P.qFallbackTitle;o.dimSize=false===u.autoMinMax?M.qCardinal:t.qHyperCube.qSize.qcy}else if(o.internalMode===y){g=R(u,F.qDimensionInfo,this._multiDimScheme,F);k=g;o.dimIndex=g;M=t.qHyperCube.qDimensionInfo[g];o.legendTitle=M.qFallbackTitle;o.dimSize=o.persistentColors?M.qCardinal:t.qHyperCube.qSize.qcy}else o.internalMode===S&&(o.dimSize=false===u.autoMinMax?M.qCardinal:t.qHyperCube.qSize.qcy);if(o.internalMode===N||o.internalMode===y){o.wrangled=s.wrangleData(t.qHyperCube,f,k,!(!o.altMode||!o.valid)&&j,o.internalMode===y,U);o.allNaN=o.altMode&&0===o.wrangled.filter(function(e){return o.internalMode===y?e.elemValue!==A&&!Number.isNaN(+e.elemValue):!Number.isNaN(+e.elemValue)}).length}o.internalMode!==N||o.persistentColors||(o.minMax=O(o.wrangled));if(t.color.auto)this._colorMode=v;else switch(o.internalMode){case N:this._colorMode=D;break;case S:this._colorMode=x;break;case I:this._colorMode=q;break}o.dimensionScheme=t.color.dimensionScheme;o.internalMode!==T&&o.internalMode!==E||(o.dimensionScheme=m.dataPalettes[0].propertyValue);var B;l.then(function(){if(i._colorMode===D||i._colorMode===x)n.push(r.resolve(i._sequentialMap.setData(t,o,i._snapshotChartData)).then(function(){B=i._sequentialMap.getLegendMode();$(B)}));else{i._qualitativeMap.setData(t,o);B=i._qualitativeMap.getLegendMode();$(B)}})}function $(e){var r;r=o.internalMode===T&&1===i._data.qHyperCube.qMeasureInfo.length||o.internalMode===E&&1===i._data.qHyperCube.qDimensionInfo.length?I:e[2];o.legendMode={discrete:"scale"!==e[0],boxType:e[1],colorMode:r,selectionEnabled:!e[3],altMode:o.altMode,rangeSelectionIndex:o.altMode?i._data.qHyperCube.qMeasureInfo.length:0};if(o.altMode&&o.internalMode===y&&o.valid&&"dimension"===o.legendMode.colorMode){o.legendPath="/qHyperCubeDef/qDimensions/"+g+"/qAttributeDimensions/"+f;o.legendPages=[{qTop:0,qLeft:0,qWidth:2,qHeight:3e3}];o.altLocked=d.qLocked}i._legendDataProvider.setData(t)}function Q(){i._colorDataInfo=o;return i._colorDataInfo}return l.then(function(){if(o.internalMode===y&&o.useDimColVal)return i._dimValsMap.setData(u,o,M,i._snapshotChartData).then(function(e){i._specialColorMap.setProperties(o,e);e?o.persistentColors=true:o.useDimColVal=false;return Q()});i._specialColorMap.setProperties(o);return r.all(n).then(Q)})},hasAttributeDimension:function e(){return this._colorDataInfo.altMode&&!!this._colorDataInfo.legendPath},getAttributeDimensionInfo:function e(){return this.hasAttributeDimension()?[this._colorDataInfo.attrInfo]:[]},getColorDataInfo:function e(){return this._colorDataInfo},setAltModeEnabled:function e(t){this._enableAltMode=t},setMeasureFormatters:function e(t){this._measureFormatters=t;this._sequentialMap&&this._sequentialMap.setMeasureFormatters(t)},setGenericFormatter:function e(t){this._sequentialMap&&this._sequentialMap.setGenericFormatter(t)},getValueFormatter:function e(){return this._sequentialMap.getValueFormatter()},setDimensionTree:function e(t){this._dimensionTree=t;this._legendDataProvider&&this._legendDataProvider.setDimensionTree(t)},getLegendDataProvider:function e(){return this._legendDataProvider},setSnapshotChartData:function e(t){this._snapshotChartData=t},getSnapshotChartData:function e(){var t=[];var r=this._dimValsMap.getDimValsData();r&&t.push({key:"dimValsData",data:r});var a=this._sequentialMap&&this._sequentialMap._measureGradient?this._sequentialMap._measureGradient:null;a&&t.push({key:"measureGradient",data:a});return t},release:function e(){this._qualitativeMap.release&&this._qualitativeMap.release();this._sequentialMap.release&&this._sequentialMap.release();this._legendDataProvider.release&&this._legendDataProvider.release();this._dimensionTree=null;this._legendDataProvider=null;this._sequentialMap=null;this._qualitativeMap=null;this.released=true}});Object.defineProperties(M.prototype,{mode:{get:function e(){return this._colorMode}}});Object.defineProperties(M,{AUTO:{value:v,writable:false},PRIMARY:{value:q,writable:false},MEASURE:{value:D,writable:false},EXPRESSION:{value:x,writable:false},QUALITATIVE:{value:b,writable:false},DIMENSION:{value:y,writable:false}});Object.defineProperties(M.prototype,{AUTO:{value:v,writable:false},PRIMARY:{value:q,writable:false},MEASURE:{value:D,writable:false},EXPRESSION:{value:x,writable:false},QUALITATIVE:{value:b,writable:false},DIMENSION:{value:y,writable:false}});return M}.apply(t,a),void 0!==i&&(e.exports=i))}}]);